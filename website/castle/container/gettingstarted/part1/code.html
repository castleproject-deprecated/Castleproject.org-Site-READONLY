<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">









<html>
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1"/>
		<title>Registering components through code :: Castle Project</title>
		<link rel="stylesheet" href="../../../base.css" />
		<link rel="stylesheet" href="../../../front.css" />
		<link rel="stylesheet" href="../../../elem.css" />
		<link rel="stylesheet" href="../../../csharp.css" />
		<link rel="stylesheet" href="../../../TAB_styles.css" />
		<script type="text/javascript" src="../../../mktree.js"></script>
		<script type="text/javascript" src="../../../TAB_Function_Lib.js"></script>
		<script src="http://www.google-analytics.com/urchin.js" type="text/javascript"></script>
	</head>

	<body>
<div id="topheader">
  <div id="maintitle">
	<h1> <a href="../../../index.html" title="Castle Project Home" accesskey="1">Home</a> </h1>
	<h2> <a href="http://www.castlestronghold.com" title="Castle Stronghold: support, consulting and development">Castle Stronghold</a> </h2>
  </div>
  <div id="mainbar">
	<ul id="toplinks">
		<li>&nbsp;</li>
		<li><a style="_width: 70px;" href="../../../index.html">Home</a></li>
		<li><a style="_width: 70px;" href="../../../castle/download.html">Download</a></li>
		<li><a style="_width: 110px;" href="http://api.castleproject.org">API Doc</a></li>
		<li><a style="_width: 50px;" href="http://using.castleproject.org">Using</a></li>
		<li><a style="_width: 60px;" href="../../../community/forum.html">Forum</a></li>
		<li><a style="_width: 120px;" href="../../../jira.html">Jira/Issue tracker</a></li>
		<li><a style="_width: 110px;" href="http://builds.castleproject.org">Builds</a></li>
	</ul>
  </div>
</div>



<div id="coolpage">

	<div id="sidebar" >
		
  <div class="lightmenu">
    <div class="lightmenucontent">
<span class="menutitle">
<a href="./../../../container/gettingstarted/part1/index.html">Introduction</a>
</span>
  <ul>
<li>
<a href="./../../../container/gettingstarted/part1/requirements.html">Requirements</a>
</li>
<li>
<a href="./../../../container/gettingstarted/part1/code.html">Registering components through code</a>
</li>
<li>
<a href="./../../../container/gettingstarted/part1/config.html">Using the configuration file</a>
</li>
<li>
<a href="./../../../container/gettingstarted/part1/more.html">Getting more</a>
</li>
  </ul>
    </div>
  </div>
  <br/>
  <div class="darkmenu">
    <div class="darkmenucontent">
<span class="menutitle">
Navigation
</span>
  <ul>
<li>
<a href="./../../../container/documentation/index.html">MicroKernel/Windsor Documentation</a>
</li>
<li>
<a href="./../../../container/index.html">Back to MicroKernel/Windsor</a>
</li>
<li>
<a href="./../../../index.html">Back to Main Page</a>
</li>
  </ul>
    </div>
  </div>
  <br/>
	<br/>
	
	</div>
		
	<div id="content">
	
		<div class="callout-pic">
		<img src="../../../images/windsor_rawlogo.gif" />

<!-- Begin Table of contents -->
<!-- End Table of contents -->
		</div>

		<h1 class="firstHeading">
		    Registering components through code
		</h1> 
	
<div class="breadcrumbs">
&raquo;
	<a href="./../../../index.html">Home</a> 
&raquo;
	<a href="./../../../container/index.html">MicroKernel/Windsor</a> 
&raquo;
	<a href="./../../../container/gettingstarted/index.html">Getting Started</a> 
&raquo;
	<a href="./../../../container/gettingstarted/part1/index.html">Part 1 - The basics</a> 
&raquo;
<u>Registering components through code</u>
</div>

		<!-- start content -->
<p>
To get things moving, we need to create a Windsor Container
instance and start registering components into it. This allow
the container to act on the components. Let's start by registering
our <tt>Form1</tt> class on the container.
</p>    <pre class="csharpcode">

<span class="kwrd">using</span> Castle.Windsor;

<span class="kwrd">public</span> <span class="kwrd">class</span> App
{
    <span class="kwrd">public</span> <span class="kwrd">static</span> <span class="kwrd">void</span> Main()
    {
        IWindsorContainer container = <span class="kwrd">new</span> WindsorContainer();
        
        <span class="rem">// Register the component</span>
        container.AddComponent(<span class="str">"form.component"</span>, <span class="kwrd">typeof</span>(Form1));
        
        <span class="rem">// Request the component to use it</span>
        Form1 form = (Form1) container[<span class="kwrd">typeof</span>(Form1)];
        
        <span class="rem">// Use the component</span>
        Application.Run(form);
        
        <span class="rem">// Release it</span>
        container.Release(form);
    }
}</pre>
  <p>
You can run the application and certify that it works as expected.
</p><p>
Now let's create a few mock services to mimic a real application.
For example, let's create a <tt>HttpServiceWatcher</tt>. 
In the real world this watcher would make requests from time to time
to a Http server to make sure it is running.
</p><p>
What if the server is not running? 
Well, it should definitely do something. Should it send an email to someone?
Should it start an alarm? Even if it needs to do these two things, where should
this code go?
</p><p>
If your answer is, let's code <tt>HttpServiceWatcher</tt>
in a way that it is capable of sending emails and sound alarms, then you should
read more about Separation of Concerns. As the name imples, the <tt>HttpServiceWatcher</tt>
should <b>only watch the http service status</b>. The logic to send emails
or sound alarms can be put on different implementation of an <tt>IFailureNotifier</tt>
service. 
</p><p>
Our service can look like the following:
</p>    <pre class="csharpcode">

<span class="kwrd">namespace</span> GettingStartedPart1
{
    <span class="kwrd">using</span> System;

    <span class="kwrd">public</span> <span class="kwrd">class</span> HttpServiceWatcher
    {
        <span class="kwrd">public</span> <span class="kwrd">void</span> StartWatching()
        {
            
        }
        
        <span class="kwrd">public</span> <span class="kwrd">void</span> StopWatching()
        {
            
        }
    }
}
</pre>
  <p>
We can then create the <tt>IFailureNotifier</tt> and a few implementations like
<tt>EmailFailureNotifier</tt> and <tt>AlarmFailureNotifier</tt>:
</p>    <pre class="csharpcode">

<span class="kwrd">namespace</span> GettingStartedPart1
{
    <span class="kwrd">using</span> System;

    <span class="kwrd">public</span> <span class="kwrd">interface</span> IFailureNotifier
    {
        <span class="kwrd">void</span> Notify();
    }
}</pre>
      <pre class="csharpcode">

<span class="kwrd">namespace</span> GettingStartedPart1
{
    <span class="kwrd">using</span> System;

    <span class="kwrd">public</span> <span class="kwrd">class</span> EmailFailureNotifier : IFailureNotifier
    {
        <span class="kwrd">public</span> <span class="kwrd">void</span> Notify()
        {
            <span class="rem">// Send email to admins</span>
        }
    }
}</pre>
      <pre class="csharpcode">

<span class="kwrd">namespace</span> GettingStartedPart1
{
    <span class="kwrd">using</span> System;

    <span class="kwrd">public</span> <span class="kwrd">class</span> AlarmFailureNotifier : IFailureNotifier
    {
        <span class="kwrd">public</span> <span class="kwrd">void</span> Notify()
        {
            <span class="rem">// Turn on alarm</span>
        }
    }
}</pre>
  <p>
But how or <tt>HttpServiceWatcher</tt> can gain access to a notifier?
We can use a constructor or a property, depends on the semantics. Ask yourself these
questions:
<ul><li>Does it make sense to have a watcher without a notifier?</li><li>If a failure is detected, and no notifier exists, what should the watcher do?</li></ul></p><p>
IMHO the watcher needs a notifier (<tt>HttpServiceWatcher</tt><b>depends on</b> 
an <tt>IFailureNotifier</tt> implementation). Let's make this decision clear to
the container:
</p>    <pre class="csharpcode">

<span class="kwrd">public</span> <span class="kwrd">class</span> HttpServiceWatcher
{
    <span class="kwrd">private</span> IFailureNotifier notifier;
    
    <span class="kwrd">public</span> HttpServiceWatcher(IFailureNotifier notifier)
    {
        <span class="kwrd">this</span>.notifier = notifier;
    }

    <span class="kwrd">public</span> <span class="kwrd">void</span> StartWatching()
    {
        <span class="rem">// should start a thread to ping the service</span>
        
        <span class="rem">// if (pingresult == Failed)</span>
        <span class="rem">// {</span>
        
        notifier.Notify();
        
        <span class="rem">// }</span>
    }
    
    <span class="kwrd">public</span> <span class="kwrd">void</span> StopWatching()
    {
        <span class="rem">// stop thread</span>
    }
}</pre>
  <p>
Now the Windsor Container (in fact the MicroKernel) knows that
in order to create an <tt>HttpServiceWatcher</tt> instance, it 
needs an implementation of <tt>IFailureNotifier</tt> to supply.
</p><p>Let's change our <tt>App</tt> class to configure the components</p>:

    <pre class="csharpcode">

<span class="kwrd">public</span> <span class="kwrd">static</span> <span class="kwrd">void</span> Main()
{
    IWindsorContainer container = <span class="kwrd">new</span> WindsorContainer();
    
    <span class="rem">// Register the components</span>
    container.AddComponent(<span class="str">"httpservicewatcher"</span>, <span class="kwrd">typeof</span>(HttpServiceWatcher));
    container.AddComponent(<span class="str">"email.notifier"</span>, <span class="kwrd">typeof</span>(IFailureNotifier), <span class="kwrd">typeof</span>(EmailFailureNotifier));
    container.AddComponent(<span class="str">"alarm.notifier"</span>, <span class="kwrd">typeof</span>(IFailureNotifier), <span class="kwrd">typeof</span>(AlarmFailureNotifier));
    container.AddComponent(<span class="str">"form.component"</span>, <span class="kwrd">typeof</span>(Form1));
    
    <span class="rem">// Request the component to use it</span>
    Form1 form = (Form1) container[<span class="kwrd">typeof</span>(Form1)];

    ...
</pre>
  <p>
We should also make the <tt>Form1</tt> request the <tt>HttpServiceWatcher</tt>.
Now there is a trick here: if we change the constructor generated by 
Visual Studio designer, making a non-parameterless constructor, the 
designer will complain. So let's just create another constructor:
</p>    <pre class="csharpcode">

<span class="kwrd">public</span> <span class="kwrd">class</span> Form1 : System.Windows.Forms.Form
{
    <span class="kwrd">private</span> <span class="kwrd">readonly</span> HttpServiceWatcher serviceWatcher;
    <span class="kwrd">private</span> System.ComponentModel.Container components = <span class="kwrd">null</span>;

    <span class="kwrd">public</span> Form1()
    {
        InitializeComponent();
    }
    
    <span class="kwrd">public</span> Form1(HttpServiceWatcher serviceWatcher) : <span class="kwrd">this</span>()
    {
        <span class="kwrd">this</span>.serviceWatcher = serviceWatcher;
    }

    ...
</pre>
  <p>
Now you are invited to run the application, debug it and see how the
"wiring" process happens. Add two buttons to the form so you can
call <tt>serviceWatcher.StartWatching()</tt> and <tt>serviceWatcher.StopWatching()</tt>.
</p><p>
Proceed with <a href="config.html" >Using the configuration file</a>.
</p>		<!-- end content -->
		
	<div id="footer">
<script type="text/javascript"><!--
google_ad_client = "pub-2091974950947714";
/* 728x90, created 2/13/08 */
google_ad_slot = "5378217716";
google_ad_width = 728;
google_ad_height = 90;
//-->
</script>
<script type="text/javascript"
src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>

	Found an error? Something inaccurate? 
	<a href="../../../community/getinvolved.html">Help us improve the documentation</a> <br/>
	Generated by <a href="../../../others/anakia/index.html">Castle Anakia</a>. 
	
	<p>&nbsp;</p>
	
	<p>
	Sponsored by <img src="../../../images/logothumb.gif" /> <a href="http://www.castlestronghold.com">Castle Stronghold</a>.
	</p>
	
	</div>

	<!-- Search Google -->
<center>
<FORM method=GET action="http://www.google.com/custom">
<TABLE bgcolor="#FFFFFF" cellspacing="4" border="0" style="border: solid 1px gray;" align="center">
<tr valign=top><td>
<A HREF="http://www.google.com/search">
<IMG SRC="http://www.google.com/logos/Logo_40wht.gif" border=0 ALT=Google align=middle></A>
</td>
<td>
<INPUT TYPE=text name=q size=31 maxlength=255 value="">
<INPUT type=submit name=sa VALUE="Google Search">
<INPUT type=hidden name=cof VALUE="S:http://www.castlestronghold.com;GL:1;VLC:#373737;AH:center;LH:63;LC:#0A50A1;GFNT:#5B5B5B;L:http://www.castleproject.org/images/castle-logo.gif;ALC:#0A50A1;BIMG:http://www.castleproject.org/images/bg.png;LW:280;T:#5B5B5B;AWFID:3d565acacdd9f388;">
<input type=hidden name=domains value="castleproject.org"><br><input type=radio name=sitesearch value=""> Search WWW <input type=radio name=sitesearch value="castleproject.org" checked> Search castleproject.org
</td></tr></TABLE>
</FORM>
<!-- Search Google -->
</center>
	&nbsp;
	<br/>

		</div> <!-- end of content -->
  </div><!-- end of page -->
  


	<script type="text/javascript">_uacct = "UA-1190612-1";urchinTracker();</script>
	</body>
</html>
