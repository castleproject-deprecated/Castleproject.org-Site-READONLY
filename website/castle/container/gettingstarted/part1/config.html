<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">









<html>
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1"/>
		<title>Using the configuration file :: Castle Project</title>
		<link rel="stylesheet" href="../../../base.css" />
		<link rel="stylesheet" href="../../../front.css" />
		<link rel="stylesheet" href="../../../elem.css" />
		<link rel="stylesheet" href="../../../csharp.css" />
		<link rel="stylesheet" href="../../../TAB_styles.css" />
		<script type="text/javascript" src="../../../mktree.js"></script>
		<script type="text/javascript" src="../../../TAB_Function_Lib.js"></script>
		<script src="http://www.google-analytics.com/urchin.js" type="text/javascript"></script>
	</head>

	<body>
<div id="topheader">
  <div id="maintitle">
	<h1> <a href="../../../index.html" title="Castle Project Home" accesskey="1">Home</a> </h1>
	<h2> <a href="http://www.castlestronghold.com" title="Castle Stronghold: support, consulting and development">Castle Stronghold</a> </h2>
  </div>
  <div id="mainbar">
	<ul id="toplinks">
		<li>&nbsp;</li>
		<li><a style="_width: 70px;" href="../../../index.html">Home</a></li>
		<li><a style="_width: 70px;" href="../../../castle/projects.html">Projects</a></li>
		<li><a style="_width: 70px;" href="../../../castle/download.html">Downloads</a></li>
		<li><a style="_width: 110px;" href="http://api.castleproject.org">API Doc</a></li>
		<li><a style="_width: 50px;" href="http://using.castleproject.org">Using</a></li>
		<li><a style="_width: 60px;" href="../../../community/mailinglists.html">Mailing Lists</a></li>
		<li><a style="_width: 120px;" href="../../../issuetracker.html">Issue Tracker</a></li>
		<li><a style="_width: 110px;" href="http://builds.castleproject.org">Builds</a></li>
	</ul>
  </div>
</div>



<div id="coolpage">

	<div id="sidebar" >
		
  <div class="lightmenu">
    <div class="lightmenucontent">
<span class="menutitle">
<a href="./../../../container/gettingstarted/part1/index.html">Introduction</a>
</span>
  <ul>
<li>
<a href="./../../../container/gettingstarted/part1/requirements.html">Requirements</a>
</li>
<li>
<a href="./../../../container/gettingstarted/part1/code.html">Registering components through code</a>
</li>
<li>
<a href="./../../../container/gettingstarted/part1/config.html">Using the configuration file</a>
</li>
<li>
<a href="./../../../container/gettingstarted/part1/more.html">Getting more</a>
</li>
  </ul>
    </div>
  </div>
  <br/>
  <div class="darkmenu">
    <div class="darkmenucontent">
<span class="menutitle">
Navigation
</span>
  <ul>
<li>
<a href="./../../../container/documentation/index.html">MicroKernel/Windsor Documentation</a>
</li>
<li>
<a href="./../../../container/index.html">Back to MicroKernel/Windsor</a>
</li>
<li>
<a href="./../../../index.html">Back to Main Page</a>
</li>
  </ul>
    </div>
  </div>
  <br/>
	<br/>
	
	</div>
		
	<div id="content">
	
		<div class="callout-pic">
		<img src="../../../images/windsor_rawlogo.gif" />

<!-- Begin Table of contents -->
<div id="toc">
<h2>Table of contents</h2>
<ul>
<li class='toclevel-1'><span class="tocnumber">1</span> <span class="toctext">Externalizing the container configuration</span>
</li>
<li class='toclevel-1'><span class="tocnumber">2</span> <span class="toctext">Passing configuration parameters</span>
</li>
<li class='toclevel-1'><span class="tocnumber">3</span> <span class="toctext">Choosing the notifier</span>
</li>
<li class='toclevel-1'><span class="tocnumber">4</span> <span class="toctext">Passing a list of notifiers to HttpServiceWatcher</span>
</li>
</ul>
</div>
<!-- End Table of contents -->
		</div>

		<h1 class="firstHeading">
		    Using the configuration file
		</h1> 
	
<div class="breadcrumbs">
&raquo;
	<a href="./../../../index.html">Home</a> 
&raquo;
	<a href="./../../../container/index.html">MicroKernel/Windsor</a> 
&raquo;
	<a href="./../../../container/gettingstarted/index.html">Getting Started</a> 
&raquo;
	<a href="./../../../container/gettingstarted/part1/index.html">Part 1 - The basics</a> 
&raquo;
<u>Using the configuration file</u>
</div>

		<!-- start content -->
<p>
What we have developed so far might have sparked a few questions:
<ul><li>Which <tt>IFailureNotifier</tt> implementation is the <tt>HttpServiceWatcher</tt> getting? How can I change that?</li><li>What if I want to give <tt>HttpServiceWatcher</tt> a list of <tt>IFailureNotifier</tt> instead?</li><li>How can I configure <tt>HttpServiceWatcher</tt> to receive say, an URL?</li></ul></p><p>
Those are good questions. By default the container will supply 
the first service registered. So the <tt>HttpServiceWatcher</tt> is getting
an <tt>EmailFailureNotifier</tt> instance. We can change that using a <i>service override</i>.
</p><p>
You can pass a list of notifiers too, but you need to inform the container about
what instances do you want to pass. Suppose you had ten implementations of 
<tt>IFailureNotifier</tt>. You must tell which ones should be passed. More on that shortly.
</p><p>
Finally, yes, you can supply an URL to <tt>HttpServiceWatcher</tt>
and why not a list of emails to <tt>EmailFailureNotifier</tt>? We will see how to make all
those things.
</p>  <h1>Externalizing the container configuration</h1>
<p>So far we have used code to configure our container. Let's make
	this configuration external to the code, so we have more flexibility 
	and we can make changes without recompiling the application.
	</p><p>
	The configuration is very minimum and, by default, is done in Xml.
	We can have a standalone xml file or use the configuration associated
	with the AppDomain. Let's use the latter. 
	</p><p>
	Add an <tt>App.config</tt> file to your Visual Studio project:
	</p>    <pre class="csharpcode">
    
<span class="kwrd">&lt;?</span><span class="html">xml</span> <span class="attr">version</span><span class="kwrd">="1.0"</span> <span class="attr">encoding</span><span class="kwrd">="utf-8"</span> ?<span class="kwrd">&gt;</span>
<span class="kwrd">&lt;</span><span class="html">configuration</span><span class="kwrd">&gt;</span>

<span class="kwrd">&lt;/</span><span class="html">configuration</span><span class="kwrd">&gt;</span>
</pre>
  <p>
	Visual Studio will take care of copying and renaming the file 
	to your executable assembly name, for example: <tt>GettingStartedPart1.exe.config</tt></p><p>
	Now add a section to configure Windsor Container:
	</p>    <pre class="csharpcode">
    
<span class="kwrd">&lt;?</span><span class="html">xml</span> <span class="attr">version</span><span class="kwrd">="1.0"</span> <span class="attr">encoding</span><span class="kwrd">="utf-8"</span> ?<span class="kwrd">&gt;</span>
<span class="kwrd">&lt;</span><span class="html">configuration</span><span class="kwrd">&gt;</span>

    <span class="kwrd">&lt;</span><span class="html">configSections</span><span class="kwrd">&gt;</span>
        <span class="kwrd">&lt;</span><span class="html">section</span> 
            <span class="attr">name</span><span class="kwrd">="castle"</span>
            <span class="attr">type</span><span class="kwrd">="Castle.Windsor.Configuration.AppDomain.CastleSectionHandler, Castle.Windsor"</span> <span class="kwrd">/&gt;</span>
    <span class="kwrd">&lt;/</span><span class="html">configSections</span><span class="kwrd">&gt;</span>

    <span class="kwrd">&lt;</span><span class="html">castle</span><span class="kwrd">&gt;</span>

        <span class="kwrd">&lt;</span><span class="html">components</span><span class="kwrd">&gt;</span>

        <span class="kwrd">&lt;/</span><span class="html">components</span><span class="kwrd">&gt;</span>

    <span class="kwrd">&lt;/</span><span class="html">castle</span><span class="kwrd">&gt;</span>
    
<span class="kwrd">&lt;/</span><span class="html">configuration</span><span class="kwrd">&gt;</span>
</pre>
  <p>
	We can now move the configuration from the <tt>App.cs</tt>
	to the configuration, on the "castle" section. It will look like the following:
	</p>    <pre class="csharpcode">
    
<span class="kwrd">&lt;</span><span class="html">castle</span><span class="kwrd">&gt;</span>

    <span class="kwrd">&lt;</span><span class="html">components</span><span class="kwrd">&gt;</span>
        
        <span class="kwrd">&lt;</span><span class="html">component</span> 
            <span class="attr">id</span><span class="kwrd">="httpservicewatcher"</span>
            <span class="attr">type</span><span class="kwrd">="GettingStartedPart1.HttpServiceWatcher, GettingStartedPart1"</span> <span class="kwrd">/&gt;</span>

        <span class="kwrd">&lt;</span><span class="html">component</span> 
            <span class="attr">id</span><span class="kwrd">="email.notifier"</span>
            <span class="attr">service</span><span class="kwrd">="GettingStartedPart1.IFailureNotifier, GettingStartedPart1"</span>
            <span class="attr">type</span><span class="kwrd">="GettingStartedPart1.EmailFailureNotifier, GettingStartedPart1"</span> <span class="kwrd">/&gt;</span>

        <span class="kwrd">&lt;</span><span class="html">component</span> 
            <span class="attr">id</span><span class="kwrd">="alarm.notifier"</span>
            <span class="attr">service</span><span class="kwrd">="GettingStartedPart1.IFailureNotifier, GettingStartedPart1"</span>
            <span class="attr">type</span><span class="kwrd">="GettingStartedPart1.AlarmFailureNotifier, GettingStartedPart1"</span> <span class="kwrd">/&gt;</span>

        <span class="kwrd">&lt;</span><span class="html">component</span> 
            <span class="attr">id</span><span class="kwrd">="form.component"</span>
            <span class="attr">type</span><span class="kwrd">="GettingStartedPart1.Form1, GettingStartedPart1"</span> <span class="kwrd">/&gt;</span>

    <span class="kwrd">&lt;/</span><span class="html">components</span><span class="kwrd">&gt;</span>

<span class="kwrd">&lt;/</span><span class="html">castle</span><span class="kwrd">&gt;</span>
</pre>
  <p>
	Finally, we need to create the Windsor Container passing
	a configuration interpreter and a resource:
	</p>    <pre class="csharpcode">

<span class="kwrd">using</span> Castle.Core.Resource;
<span class="kwrd">using</span> Castle.Windsor;
<span class="kwrd">using</span> Castle.Windsor.Configuration.Interpreters;

<span class="kwrd">public</span> <span class="kwrd">class</span> App
{
    <span class="kwrd">public</span> <span class="kwrd">static</span> <span class="kwrd">void</span> Main()
    {
        IWindsorContainer container = 
            <span class="kwrd">new</span> WindsorContainer(
                <span class="kwrd">new</span> XmlInterpreter(<span class="kwrd">new</span> ConfigResource(<span class="str">"castle"</span>)));
        
        <span class="rem">// Request the component to use it</span>
        Form1 form = (Form1) container[<span class="kwrd">typeof</span>(Form1)];
        
        <span class="rem">// Use the component</span>
        Application.Run(form);
        
        <span class="rem">// Release it</span>
        container.Release(form);
    }
}</pre>
  <p>
	Test your work and everything should work as expected.
	</p>  <h1>Passing configuration parameters</h1>
<p>
	Let's improve our <tt>HttpServiceWatcher</tt> 
	to receive an URL that it should use to make request on.
	First, is this URL a necessary  or optional parameter?
	Let's assume it is optional, so we should use 	a property:
	</p>    <pre class="csharpcode">

<span class="kwrd">public</span> <span class="kwrd">class</span> HttpServiceWatcher
{
    <span class="kwrd">private</span> IFailureNotifier notifier;
    <span class="kwrd">private</span> <span class="kwrd">string</span> url = <span class="str">"default url"</span>;
    
    <span class="kwrd">public</span> HttpServiceWatcher(IFailureNotifier notifier)
    {
        <span class="kwrd">this</span>.notifier = notifier;
    }

    <span class="kwrd">public</span> <span class="kwrd">string</span> Url
    {
        get { <span class="kwrd">return</span> url; }
        set { url = <span class="kwrd">value</span>; }
    }

    ...
</pre>
  <p>
	How to configure this parameter with the configuration?
	Simple: use the <tt>parameters</tt> node:
	</p>    <pre class="csharpcode">
    
<span class="kwrd">&lt;</span><span class="html">component</span> 
    <span class="attr">id</span><span class="kwrd">="httpservicewatcher"</span>
    <span class="attr">type</span><span class="kwrd">="GettingStartedPart1.HttpServiceWatcher, GettingStartedPart1"</span><span class="kwrd">&gt;</span>
    
    <span class="kwrd">&lt;</span><span class="html">parameters</span><span class="kwrd">&gt;</span>
        <span class="kwrd">&lt;</span><span class="html">Url</span><span class="kwrd">&gt;</span>different url<span class="kwrd">&lt;/</span><span class="html">Url</span><span class="kwrd">&gt;</span>
    <span class="kwrd">&lt;/</span><span class="html">parameters</span><span class="kwrd">&gt;</span>
    
<span class="kwrd">&lt;/</span><span class="html">component</span><span class="kwrd">&gt;</span>
</pre>
  <p>
	Each node enclosed by the <tt>parameters</tt> node
	should be named after a property or a constructor argument.
	</p>  <h1>Choosing the notifier</h1>
<p>
	As stated before, there are two notifiers and 
	the <tt>HttpServiceWatcher</tt> is requesting one. 
	Which one will it get? By default, the first one registered, which is 
	the <tt>EmailFailureNotifier</tt>. But suppose you want to change that,
	how would you do it?
	</p><p>
	We need to make a service override. What does that mean?
	A service override a configuration entry that changes the 
	MicroKernel behavior when resolving dependency.
	In the end, we need to change the configuration 
	passing a different service to the constructor argument.
	</p>    <pre class="csharpcode">

<span class="kwrd">public</span> HttpServiceWatcher(IFailureNotifier notifier)
{
    <span class="kwrd">this</span>.notifier = notifier;
}</pre>
      <pre class="csharpcode">
    
<span class="kwrd">&lt;</span><span class="html">component</span> 
    <span class="attr">id</span><span class="kwrd">="httpservicewatcher"</span>
    <span class="attr">type</span><span class="kwrd">="GettingStartedPart1.HttpServiceWatcher, GettingStartedPart1"</span><span class="kwrd">&gt;</span>
    
    <span class="kwrd">&lt;</span><span class="html">parameters</span><span class="kwrd">&gt;</span>
        <span class="kwrd">&lt;</span><span class="html">notifier</span><span class="kwrd">&gt;</span>${alarm.notifier}<span class="kwrd">&lt;/</span><span class="html">notifier</span><span class="kwrd">&gt;</span>
        <span class="kwrd">&lt;</span><span class="html">Url</span><span class="kwrd">&gt;</span>different url<span class="kwrd">&lt;/</span><span class="html">Url</span><span class="kwrd">&gt;</span>
    <span class="kwrd">&lt;/</span><span class="html">parameters</span><span class="kwrd">&gt;</span>
    
<span class="kwrd">&lt;/</span><span class="html">component</span><span class="kwrd">&gt;</span>
</pre>
  <p>
	The <tt>${}</tt> notation is called <i>service lookup</i>.
	</p>  <h1>Passing a list of notifiers to HttpServiceWatcher</h1>
<p>
	Suppose that you are not satisfied with the fact
	that the <tt>HttpServiceWatcher</tt> is receiving just one notifier instance.
	Well, let's make it receive an array of notifiers:
	</p>    <pre class="csharpcode">

<span class="kwrd">public</span> <span class="kwrd">class</span> HttpServiceWatcher
{
    <span class="kwrd">private</span> IFailureNotifier[] notifiers;
    <span class="kwrd">private</span> <span class="kwrd">string</span> url = <span class="str">"default url"</span>;
    
    <span class="kwrd">public</span> HttpServiceWatcher(IFailureNotifier[] notifiers)
    {
        <span class="kwrd">this</span>.notifiers = notifiers;
    }

    ...
    </pre>
  <p>
	On our configuration, we need to make a few changes:
	</p>    <pre class="csharpcode">
    
<span class="kwrd">&lt;</span><span class="html">component</span> 
    <span class="attr">id</span><span class="kwrd">="httpservicewatcher"</span>
    <span class="attr">type</span><span class="kwrd">="GettingStartedPart1.HttpServiceWatcher, GettingStartedPart1"</span><span class="kwrd">&gt;</span>
    
    <span class="kwrd">&lt;</span><span class="html">parameters</span><span class="kwrd">&gt;</span>
        <span class="kwrd">&lt;</span><span class="html">notifiers</span><span class="kwrd">&gt;</span>
            <span class="kwrd">&lt;</span><span class="html">array</span><span class="kwrd">&gt;</span>
                <span class="kwrd">&lt;</span><span class="html">item</span><span class="kwrd">&gt;</span>${email.notifier}<span class="kwrd">&lt;/</span><span class="html">item</span><span class="kwrd">&gt;</span>
                <span class="kwrd">&lt;</span><span class="html">item</span><span class="kwrd">&gt;</span>${alarm.notifier}<span class="kwrd">&lt;/</span><span class="html">item</span><span class="kwrd">&gt;</span>
            <span class="kwrd">&lt;/</span><span class="html">array</span><span class="kwrd">&gt;</span>
        <span class="kwrd">&lt;/</span><span class="html">notifiers</span><span class="kwrd">&gt;</span>
        <span class="kwrd">&lt;</span><span class="html">Url</span><span class="kwrd">&gt;</span>different url<span class="kwrd">&lt;/</span><span class="html">Url</span><span class="kwrd">&gt;</span>
    <span class="kwrd">&lt;/</span><span class="html">parameters</span><span class="kwrd">&gt;</span>
    
<span class="kwrd">&lt;/</span><span class="html">component</span><span class="kwrd">&gt;</span>
</pre>
  <p>
	Proceed with <a href="more.html" >Getting More</a>.
	</p>		<!-- end content -->
		
	<div id="footer">
<script type="text/javascript"><!--
google_ad_client = "pub-2091974950947714";
/* 728x90, created 2/13/08 */
google_ad_slot = "5378217716";
google_ad_width = 728;
google_ad_height = 90;
//-->
</script>
<script type="text/javascript"
src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
	
	<br/>
	Found an error? Something inaccurate? 
	<a href="../../../community/getinvolved.html">Help us improve the documentation</a> <br/>
	Generated by <a href="../../../others/anakia/index.html">Castle Anakia</a>. 
	
	<p>&nbsp;</p>
	
	<p>
	Sponsored by <img src="../../../images/logothumb.gif" /> <a href="http://www.castlestronghold.com">Castle Stronghold</a>.
	</p>
	
	</div>

	<!-- Search Google -->
<center>
<FORM method=GET action="http://www.google.com/custom">
<TABLE bgcolor="#FFFFFF" cellspacing="4" border="0" style="border: solid 1px gray;" align="center">
<tr valign=top><td>
<A HREF="http://www.google.com/search">
<IMG SRC="http://www.google.com/logos/Logo_40wht.gif" border=0 ALT=Google align=middle></A>
</td>
<td>
<INPUT TYPE=text name=q size=31 maxlength=255 value="">
<INPUT type=submit name=sa VALUE="Google Search">
<INPUT type=hidden name=cof VALUE="S:http://www.castlestronghold.com;GL:1;VLC:#373737;AH:center;LH:63;LC:#0A50A1;GFNT:#5B5B5B;L:http://www.castleproject.org/images/castle-logo.gif;ALC:#0A50A1;BIMG:http://www.castleproject.org/images/bg.png;LW:280;T:#5B5B5B;AWFID:3d565acacdd9f388;">
<input type=hidden name=domains value="castleproject.org"><br><input type=radio name=sitesearch value=""> Search WWW <input type=radio name=sitesearch value="castleproject.org" checked> Search castleproject.org
</td></tr></TABLE>
</FORM>
<!-- Search Google -->
</center>
	&nbsp;
	<br/>

		</div> <!-- end of content -->
  </div><!-- end of page -->
  


	<script type="text/javascript">_uacct = "UA-1190612-1";urchinTracker();</script>
	</body>
</html>
