<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">









<html>
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1"/>
		<title>Primary key mapping :: Castle Project</title>
		<link rel="stylesheet" href="../../../../base.css" />
		<link rel="stylesheet" href="../../../../front.css" />
		<link rel="stylesheet" href="../../../../elem.css" />
		<link rel="stylesheet" href="../../../../csharp.css" />
		<link rel="stylesheet" href="../../../../TAB_styles.css" />
		<script type="text/javascript" src="../../../../mktree.js"></script>
		<script type="text/javascript" src="../../../../TAB_Function_Lib.js"></script>
		<script src="http://www.google-analytics.com/urchin.js" type="text/javascript"></script>
	</head>

	<body>
<div id="topheader">
  <div id="maintitle">
	<h1> <a href="../../../../index.html" title="Castle Project Home" accesskey="1">Home</a> </h1>
	<h2> <a href="http://www.castlestronghold.com" title="Castle Stronghold: support, consulting and development">Castle Stronghold</a> </h2>
  </div>
  <div id="mainbar">
	<ul id="toplinks">
		<li>&nbsp;</li>
		<li><a style="_width: 70px;" href="../../../../index.html">Home</a></li>
		<li><a style="_width: 70px;" href="../../../../castle/download.html">Download</a></li>
		<li><a style="_width: 110px;" href="http://api.castleproject.org">API Doc</a></li>
		<li><a style="_width: 50px;" href="http://using.castleproject.org">Using</a></li>
		<li><a style="_width: 60px;" href="../../../../community/forum.html">Forum</a></li>
		<li><a style="_width: 120px;" href="../../../../issuetracker.html">Issue Tracker</a></li>
		<li><a style="_width: 110px;" href="http://builds.castleproject.org">Builds</a></li>
	</ul>
  </div>
</div>



<div id="coolpage">

	<div id="sidebar" >
		
  <div class="lightmenu">
    <div class="lightmenucontent">
<span class="menutitle">
<a href="./../../../../activerecord/index.html">ActiveRecord</a>
</span>
  <ul>
<li>
<a href="./../../../../activerecord/gettingstarted/index.html">Getting started</a>
</li>
<li>
<a href="./../../../../activerecord/faq.html">FAQ</a>
</li>
<li>
<a href="./../../../../activerecord/recipes/index.html">Recipes</a>
</li>
<li>
<a href="./../../../../activerecord/externalarticles.html">External Articles</a>
</li>
  </ul>
    </div>
  </div>
  <br/>
  <div class="lightmenu">
    <div class="lightmenucontent">
<span class="menutitle">
<a href="./../../../../activerecord/documentation/trunk/index.html">Documentation</a>
</span>
  <ul>
<li>
<a href="./../../../../activerecord/documentation/trunk/releasenotes/index.html">Release notes</a>
</li>
<li>
<a href="./../../../../activerecord/documentation/trunk/manual/index.html">Reference Manual</a>
</li>
<li>
<a href="./../../../../activerecord/documentation/trunk/usersguide/index.html">User's Guide</a>
</li>
<li>
<a href="./../../../../activerecord/documentation/trunk/advanced/index.html">Advanced usage</a>
</li>
  </ul>
    </div>
  </div>
  <br/>
  <div class="darkmenu">
    <div class="darkmenucontent">
<span class="menutitle">
Navigation
</span>
  <ul>
<li>
<a href="./../../../../index.html">Back to Main Page</a>
</li>
  </ul>
    </div>
  </div>
  <br/>
	<br/>
	
	</div>
		
	<div id="content">
	
		<div class="callout-pic">

<!-- Begin Table of contents -->
<div id="toc">
<h2>Table of contents</h2>
<ul>
<li class='toclevel-1'><a href="#SinglePK"><span class="tocnumber">1</span> <span class="toctext">Single Primary Key</span></a>
<ul>
	<li class='toclevel-1'><a href="#diffstrategies"><span class="tocnumber">1.1</span> <span class="toctext">Key Generation strategies</span></a>
</li>
	<li class='toclevel-1'><a href="#identity"><span class="tocnumber">1.2</span> <span class="toctext">The Identity Problem</span></a>
</li>
	<li class='toclevel-1'><a href="#further"><span class="tocnumber">1.3</span> <span class="toctext">Further Information</span></a>
</li>
</ul>
</li>
<li class='toclevel-1'><a href="#CompositePK"><span class="tocnumber">2</span> <span class="toctext">Composite Primary Keys</span></a>
<ul>
	<li class='toclevel-1'><a href="#implications"><span class="tocnumber">2.1</span> <span class="toctext">Implications of using composite keys</span></a>
</li>
	<li class='toclevel-1'><a href="#relations"><span class="tocnumber">2.2</span> <span class="toctext">Relations with composite keys</span></a>
</li>
</ul>
</li>
</ul>
</div>
<!-- End Table of contents -->
		</div>

		<h1 class="firstHeading">
		    Primary key mapping
		</h1> 
	
<div class="breadcrumbs">
&raquo;
	<a href="./../../../../index.html">Home</a> 
&raquo;
	<a href="./../../../../activerecord/index.html">ActiveRecord</a> 
&raquo;
	<a href="./../../../../activerecord/documentation/index.html">Documentation</a> 
&raquo;
	<a href="./../../../../activerecord/documentation/trunk/index.html">ActiveRecord trunk Documentation</a> 
&raquo;
	<a href="./../../../../activerecord/documentation/trunk/usersguide/index.html">User's Guide</a> 
&raquo;
<u>Primary key mapping</u>
</div>

		<!-- start content -->
<p>
Regular <i>ActiveRecord types</i> must have a primary key, a key that uniquely indentifies any row
in a table. Single surrogate keys are favouvered over composite keys, but both are supported. 
When having control over the database schema, adding a surrogate primary key to the tables is the
recommended way of implementing primary keys.
</p><a name="SinglePK"></a>
  <h1>Single Primary Key</h1>
<p>
	A single primary key is a column used as a row identifier. If it has no business meaning and
	can be choosen freely among unused values, the key is called a <strong>surrogate primary key.
	</strong> Primary keys can be assigned by the using code, auto generated by the database or 
	by ActiveRecord using	one of the strategies to generated non duplicate values. 
	</p><p>
	To declare a primary key in a class a property to hold it must be created and decorated with 
	the <tt>PrimaryKeyAttribute</tt>.	This attribute holds information for mapping the primary
	key column. Most importantly, it determines the generation strategy which defaults to 
	native, using an auto generation method supported by the used database. 
	The following table script shows a simple entity:
	</p>    <pre class="csharpcode">

<span class="kwrd">CREATE</span> <span class="kwrd">TABLE</span> Entity (
    [id] [<span class="kwrd">int</span>] <span class="kwrd">IDENTITY</span> (1, 1) <span class="kwrd">NOT</span> <span class="kwrd">NULL</span>
    <span class="rem">-- payload ommitted for clarity</span>
) <span class="kwrd">ON</span> [<span class="kwrd">PRIMARY</span>]
</pre>
  <p>
	This table would be easily mapped to an ActiveRecord class:
	</p>    <pre class="csharpcode">

<span class="kwrd">using</span> Castle.ActiveRecord;

[ActiveRecord]
<span class="kwrd">public</span> <span class="kwrd">class</span> Entity : ActiveRecordBase&lt;Entity&gt;
{
    <span class="kwrd">private</span> <span class="kwrd">int</span> id;
    
    [PrimaryKey(PrimaryKeyType.Native)]
    <span class="kwrd">public</span> <span class="kwrd">int</span> Id
    {
        get { <span class="kwrd">return</span> id; }
        set { id = <span class="kwrd">value</span>; }
    }
    
    <span class="rem">// payload ommitted for clarity</span>
}</pre>
  <p>
	For this case, the <tt>PrimaryKeyType</tt> could be omitted as it will default
	to <tt>Native</tt> anyway. ActiveRecord will correctly <b>assume</b>
	that the column name is <tt>Id</tt>.	If the column had a different name, for example 
	<tt>EntityId</tt>, it must be explicitly specified:
	</p>    <pre class="csharpcode">

    <span class="kwrd">private</span> <span class="kwrd">int</span> id;
    
    [PrimaryKey(PrimaryKeyType.Native, <span class="str">"EntityId"</span>)]
    <span class="kwrd">public</span> <span class="kwrd">int</span> Id
    {
        get { <span class="kwrd">return</span> id; }
        set { id = <span class="kwrd">value</span>; }
    }</pre>
  <p>
	A setter is not needed for the primary key, but	ActiveRecord needs to set the value somehow.
	For example the key can be directly set by using the backing field. This requires that the
	<tt>Access</tt> is specified:
	</p>    <pre class="csharpcode">

    <span class="kwrd">private</span> <span class="kwrd">int</span> id;
    
    [PrimaryKey(Access=PropertyAccess.FieldCamelcase)]
    <span class="kwrd">public</span> <span class="kwrd">int</span> Id
    {
        get { <span class="kwrd">return</span> id; }
    }</pre>
  <a name="diffstrategies"></a>
  <h2>Key Generation strategies</h2>
<p>
		ActiveRecord supports all strategies implemented by NHibernate for creating primary keys.
		The possible strategies are listed below with a short explanation.
		</p><table class="commontable" ><tr><th>Name</th><th>Enum Value</th><th>Description</th></tr><tr><td>Identity</td><td><tt>PrimaryKeyType.Identity</tt></td><td>
				Uses an identity column if available. Objects will be instantly inserted when saved.
				</td></tr><tr><td>Sequence</td><td><tt>PrimaryKeyType.Sequence</tt></td><td>
				Uses sequences where supported by the database. Two database calls are necessary for saving an object.
				The sequence name can be specified with the <tt>sequence</tt>-parameter or the <tt>SequenceName</tt>-
				property.
				</td></tr><tr><td>Hi/Lo</td><td><tt>PrimaryKeyType.HiLo</tt></td><td>
				Uses a Hi/Lo algorithm. Hi values are stored in a special database table. A hi value is fetched once and
				incremented locally. <tt>table</tt>, <tt>column</tt> and <tt>max_lo</tt> can be specified as parameters,
				with <tt>max_lo</tt> specifying the number of values locally incremented before fetching a new high value.
				</td></tr><tr><td>Sequence Hi/Lo</td><td><tt>PrimaryKeyType.SeqHiLo</tt></td><td>
				Uses a Hi/Lo algorithm. The hi values are fetched from an Oracle-style sequence and
				incremented locally. Parameters are <tt>sequence</tt> and <tt>max_lo</tt>.
				</td></tr><tr><td>UUID (hex representation)</td><td><tt>PrimaryKeyType.UuidHex</tt></td><td>
				This strategy uses a guid and converts it into a hex representation, creating a readable string, customized
				by format and separator specification. This allows to use guids on databases that do not support GUIDs.
				<tt>format</tt> and <tt>separator</tt> must be specified as parameters.
				</td></tr><tr><td>UUID (compact representation)</td><td><tt>PrimaryKeyType.UuidString</tt></td><td>
				This strategy uses a guid and converts it into a byte-array, casting it into a string. It is written to
				the database as a <tt>CHAR(16)</tt>, using up less space than <tt>UuidHex</tt>, but creating unprintable
				representations.
				</td></tr><tr><td>GUID</td><td><tt>PrimaryKeyType.Guid</tt></td><td>
				Uses GUIDs where supported by the database. 
				</td></tr><tr><td>Combined GUID</td><td><tt>PrimaryKeyType.GuidComb</tt></td><td>
				Uses GUIDs where supported by the database. The GUIDs are created by taking system time into account. The
				risk for a key collision is therefore slightly higher, though still neglectable. The resulting GUIDs are
				already sorted after creation, increasing database performance. 
				</td></tr><tr><td>Increment</td><td><tt>PrimaryKeyType.Increment</tt></td><td>
				Increments values locally. This is neither safe in clusters nor in applications with multiple clients.
				</td></tr><tr><td>User Assigned</td><td><tt>PrimaryKeyType.Assigned</tt></td><td>
				The key has a business meaning and is not generated but must be assigned by the user before
				<tt>Create()</tt> or <tt>Update()</tt> is called.
				</td></tr></table><p>
		Some strategies require more parameters, which can be specified by using the <tt>Params</tt> property.
		The parameters needed are specified as <tt>name=value</tt>-pairs separated by commas as shown in the
		following example:
		</p>    <pre class="csharpcode">

    <span class="kwrd">private</span> String id;
    
    [PrimaryKey(PrimaryKeyType.UuidHex, Params=<span class="str">"format=D,seperator=-"</span>)]
    <span class="kwrd">public</span> String Id
    {
        get { <span class="kwrd">return</span> id; }
        set { id = <span class="kwrd">value</span>; }
    }</pre>
  <a name="identity"></a>
  <h2>The Identity Problem</h2>
<p>
		Despite being the default generator, using <tt>IDENTITY</tt> keys is discouraged. The reason for this
		is an exception to the regular lifecycle when identity keys are used.
		</p><p>
		When an entity is saved, a primary key must be assigned. However, the only possibility to determine a key
		using a database assigned identity value is inserting a row into a table. As a consequence, the entity
		is instantly saved to the database outside of any coordinated database flush. 
		</p><p>
		This is not perceived in the code unless a <tt>SessionScope</tt> is used which is mandatory for lazy
		loading and a common pattern in web applications. Since the scope can be defined far away from the
		code that actually performs the call to <tt>Save()</tt>, this code behaves differently based on the
		context it is executed in. This is a maintenance nightmare which should be avoided by using other
		key generation strategies.
		</p><a name="further"></a>
  <h2>Further Information</h2>
<p>
	Please refer to the Reference Manual's 
	<a href="../manual/attributes.html" >Attributes</a> article for further information.
	</p><a name="CompositePK"></a>
  <h1>Composite Primary Keys</h1>
<p>
	composite keys, also known as natural keys, consist of a set of column that 
	define the identifier of a row. 
	</p>  <div class="note">
<div class="notetopbg">
<div class="noteborderleft">
<div class="noteborderright">
<div class="notetopleft">
<div class="notetopright">
<div class="notebottomleft">
<div class="notebottomright">
<div class="boxtitle">Quick Note</div>
<div class="innercontent">
<p>
	Composite keys are highly discouraged and should not be used unless there is no other alternative.
	</p>
</div></div></div></div></div></div></div></div></div>
<p>
	To use composite keys with ActiveRecord two things are necessary:
	
	<ol><li>
	Creating a class to hold the properties and fields for 
	the columns that make up the key.
	<ul style="padding-top: 10px; padding-left: 13px;" ><li style="list-style: square; list-style-type: square;" >
	The class must be <tt>Serializable</tt></li><li style="list-style: square; list-style-type: square;" ><tt>Equals</tt> and <tt>GetHashCode</tt> must be overridden</li></ul></li><li>
	Declaring the property on the <i>ActiveRecord type</i>, using the <tt>CompositeKeyAttribute</tt>.
	</li></ol></p><p>
	This is shown for the following table script:
	</p>    <pre class="csharpcode">

<span class="kwrd">CREATE</span> <span class="kwrd">TABLE</span> Users (
    [OrgID] [<span class="kwrd">int</span>] <span class="kwrd">NOT</span> <span class="kwrd">NULL</span>,
    [UserID] [<span class="kwrd">int</span>] <span class="kwrd">NOT</span> <span class="kwrd">NULL</span>,
    [Name] [<span class="kwrd">varchar</span>] (50) <span class="kwrd">NULL</span>,
    [Address] [<span class="kwrd">varchar</span>] (50) <span class="kwrd">NULL</span>,
    [City] [<span class="kwrd">varchar</span>] (50) <span class="kwrd">NULL</span>,
    [<span class="kwrd">State</span>] [<span class="kwrd">varchar</span>] (50) <span class="kwrd">NULL</span>
) <span class="kwrd">ON</span> [<span class="kwrd">PRIMARY</span>]
</pre>
  <p>
	The following is the definition of the composite key class <tt>ProductSupplierKey</tt>
	and next is the <i>ActiveRecord type</i>:
	</p>    <pre class="csharpcode">

<span class="kwrd">using</span> Castle.ActiveRecord;

[Serializable]
<span class="kwrd">public</span> <span class="kwrd">class</span> UserKey
{
    <span class="kwrd">private</span> <span class="kwrd">int</span> orgID;
    <span class="kwrd">private</span> <span class="kwrd">int</span> userID;
    
    [KeyProperty]
    <span class="kwrd">public</span> <span class="kwrd">int</span> OrgID
    {
        get { <span class="kwrd">return</span> orgID; }
        set { orgID = <span class="kwrd">value</span>; }
    }

    [KeyProperty]
    <span class="kwrd">public</span> <span class="kwrd">int</span> UserID
    {
        get { <span class="kwrd">return</span> userID; }
        set { userID = <span class="kwrd">value</span>; }
    }
    
    <span class="kwrd">public</span> <span class="kwrd">override</span> <span class="kwrd">int</span> GetHashCode()
    {
        <span class="kwrd">return</span> orgID ^ userID;
    }

    <span class="kwrd">public</span> <span class="kwrd">override</span> <span class="kwrd">bool</span> Equals(<span class="kwrd">object</span> obj)
    {
        <span class="kwrd">if</span> (<span class="kwrd">this</span> == obj)
        {
            <span class="kwrd">return</span> <span class="kwrd">true</span>;
        }
        UserKey key = obj <span class="kwrd">as</span> UserKey;
        <span class="kwrd">if</span> (key == <span class="kwrd">null</span>)
        {
            <span class="kwrd">return</span> <span class="kwrd">false</span>;
        }
        <span class="kwrd">if</span> (orgID != key.orgID || userID != key.userID)
        {
            <span class="kwrd">return</span> <span class="kwrd">false</span>;
        }
        <span class="kwrd">return</span> <span class="kwrd">true</span>;
    }
}

[ActiveRecord(<span class="str">"Users"</span>)]
<span class="kwrd">public</span> <span class="kwrd">class</span> User : ActiveRecordBase
{
    <span class="kwrd">private</span> UserKey key;
    
    [CompositeKey]
    <span class="kwrd">public</span> UserKey Key
    {
        get { <span class="kwrd">return</span> key; }
        set { key = <span class="kwrd">value</span>; }
    }
}</pre>
    <div class="warning">
<div class="warningtopbg">
<div class="warningborderleft">
<div class="warningborderright">
<div class="warningtopleft">
<div class="warningtopright">
<div class="warningbottomleft">
<div class="warningbottomright">
	<div class="boxtitle">Warning</div>
<div class="innercontent">
<p>
			There are <b>implications</b> on using composite keys discussed below. As was mentioned 
			above, Composite keys are
			discouraged. However, if they must be used, additional complexity in how the model is 
			mapped to the database must be addressed.
		</p>
</div></div></div></div></div></div></div></div></div>
<a name="implications"></a>
  <h2>Implications of using composite keys</h2>
<p>
			An assigned identifier (like all CompositeKeys and assigned single PrimaryKeys) cannot
			be used to determine whether an instance is detached or transient - since its
			value is assigned by the application, it is <i>never</i> null. Therefore,
			one of the strategies below must be used or NHibernate will misbehave around the way it
			persists the instance to the database.
		</p><p>
		
			To ensure that the data is persisted properly, two methods for managing persistence are 
			available:
		</p><ol><li>
				Using the <tt>VersionAttribute</tt> to set the <tt>UnsavedValue</tt>. Normally, 
				the <tt>UnsavedValue</tt> is used with the <tt>PrimaryKeyAttribute</tt>, where
				the <tt>UnsavedValue</tt> is checked by NHibernate to determine the state of the
				instance: if the field or property is equal to the <tt>UnsavedValue</tt>, then 
				the object has not yet been persisted. However, because the field or property marked
				with the <tt>CompositeKeyAttribute</tt> cannot have an <tt>UnsavedValue</tt> that 
				is understood by NHibernate, another field or property must be used - the one that
				was marked by the <tt>VersionAttribute</tt>. This allows the use of the 
				<tt>Save</tt> method. 
			</li><li><i>Not</i> using the <tt>Save</tt> method. <tt>Create</tt> and
				<tt>Update</tt> can be used to force NHibernate to correctly persisting the objects.
			</li></ol><a name="relations"></a>
  <h2>Relations with composite keys</h2>
<p>
				Because a composite key is by nature multi-field, there are additional requirements
				when building the relations between objects that include these keys. The largest part
				of those requirements is that the <tt>HasMany</tt>, <tt>BelongsTo</tt> and
				<tt>HasAndBelongsToMany</tt> attributes will use different properties to determine the
				<tt>Column</tt>s, <tt>ColumnKey</tt>s and <tt>ColumnKeyRef</tt>s.
			</p><p>
				To continue the example used above, the User class will be redefined and
				<tt>Org</tt> and <tt>Group</tt> classes added including their relationships.</p><p>	
				First, some DDL is necessary to create the <tt>Org</tt> 
				and <tt>Group</tt> tables, as well as 
				the association table for the many-to-many 
				relationship between <tt>Users</tt> and <tt>Groups</tt>.
			</p>    <pre class="csharpcode">

<span class="kwrd">CREATE</span> <span class="kwrd">TABLE</span> Orgs (
    [ID] [<span class="kwrd">int</span>] <span class="kwrd">NOT</span> <span class="kwrd">NULL</span>,
    [Name] [<span class="kwrd">varchar</span>] (50) <span class="kwrd">NULL</span>
) <span class="kwrd">ON</span> [<span class="kwrd">PRIMARY</span>]

<span class="kwrd">CREATE</span> <span class="kwrd">TABLE</span> Groups (
    [ID] [<span class="kwrd">int</span>] <span class="kwrd">NOT</span> <span class="kwrd">NULL</span>,
    [Name] [<span class="kwrd">varchar</span>] (50) <span class="kwrd">NULL</span>
) <span class="kwrd">ON</span> [<span class="kwrd">PRIMARY</span>]

<span class="kwrd">CREATE</span> <span class="kwrd">TABLE</span> UserGroups (
    [OrgID] [<span class="kwrd">int</span>] <span class="kwrd">NOT</span> <span class="kwrd">NULL</span>,
    [UserID] [<span class="kwrd">int</span>] <span class="kwrd">NOT</span> <span class="kwrd">NULL</span>,
    [GroupID] [<span class="kwrd">int</span>] <span class="kwrd">NOT</span> <span class="kwrd">NULL</span>
) <span class="kwrd">ON</span> [<span class="kwrd">PRIMARY</span>]</pre>
  <p>
				Next, the <tt>User</tt> class will be redefined, 
				adding the appropriate markup to maintain
				the mapping relationships.
			</p>    <pre class="csharpcode">

<span class="kwrd">using</span> Castle.ActiveRecord;

ActiveRecord(<span class="str">"Users"</span>)]
<span class="kwrd">public</span> <span class="kwrd">class</span> User : ActiveRecordBase
{
    <span class="kwrd">private</span> UserKey key;
    <span class="kwrd">private</span> ISet groups;
    <span class="kwrd">private</span> Org org;

    <span class="kwrd">public</span> User()
    {
        groups = <span class="kwrd">new</span> HybridSet();
    }

    <span class="kwrd">public</span> User(UserKey userKey) : <span class="kwrd">this</span>()
    {
        key = userKey;
    }

    [CompositeKey]
    <span class="kwrd">public</span> UserKey Key
    {
        get { <span class="kwrd">return</span> key; }
        set { key = <span class="kwrd">value</span>; }
    }

    [HasAndBelongsToMany(<span class="kwrd">typeof</span>(Group),
        Table=<span class="str">"UserGroups"</span>,
        ColumnRef=<span class="str">"GroupID"</span>,
        CompositeKeyColumnKeys=<span class="kwrd">new</span> <span class="kwrd">string</span>[]{<span class="str">"OrgID"</span>,<span class="str">"UserID"</span>},
        Lazy=<span class="kwrd">true</span>,
        Cascade=ManyRelationCascadeEnum.SaveUpdate)
    <span class="kwrd">public</span> ISet Groups
    {
        get { <span class="kwrd">return</span> groups; }
    }

    [BelongsTo(<span class="str">"OrgID"</span>, Insert=<span class="kwrd">false</span>, Update=<span class="kwrd">false</span>)
    <span class="kwrd">public</span> Org Org
    {
        get { <span class="kwrd">return</span> org; }
        set { org = <span class="kwrd">value</span>; }
    }
}</pre>
  <p>
				Note the <tt>CompositeKeyColumnKeys</tt> array, these are the fields that make up the
				foreign composite key in the association table.
			</p><p>
				Another interesting item when dealing with composite keys is building a
				relationship using only a single field of the composite key as the foreign key in a
				traditional one-to-many or many-to-one relationship. The "one" side of that
				mapping in the definition of the "Org" property has set 
				<tt>Insert</tt>/<tt>Update</tt> to <tt>false</tt>. This is
				<b>not</b> optional. It prevents the other side of the relation from attempting to
				insert or update a portion of the composite key (in this case, the "OrgID" field).
			</p><p>
				Next step is defining the other two classes, 
				illustrating the other side of the relationships.
			</p>    <pre class="csharpcode">

[ActiveRecord(<span class="str">"Orgs"</span>)
<span class="kwrd">public</span> <span class="kwrd">class</span> Org : ActiveRecordBase
{
    <span class="kwrd">private</span> <span class="kwrd">int</span> id;
    <span class="kwrd">private</span> ISet users;

    <span class="kwrd">public</span> Org()
    {
        users = <span class="kwrd">new</span> HybridSet();
    }

    [PrimaryKey(PrimaryKeyType.Native)]
    <span class="kwrd">public</span> <span class="kwrd">int</span> ID
    {
        get { <span class="kwrd">return</span> id; }
        set { id = <span class="kwrd">value</span>; }
    }

    [HasMany(<span class="kwrd">typeof</span>(User), Lazy=<span class="kwrd">true</span>)
    <span class="kwrd">public</span> ISet Users
    {
        get { <span class="kwrd">return</span> users; }
    }
}

[ActiveRecord(<span class="str">"Groups"</span>)]
<span class="kwrd">public</span> <span class="kwrd">class</span> Group : ActiveRecordBase
{
    <span class="kwrd">private</span> <span class="kwrd">int</span> id;
    <span class="kwrd">private</span> ISet users;

    <span class="kwrd">public</span> Group()
    {
        users = <span class="kwrd">new</span> HybridSet();
    }

    [PrimaryKey(PrimaryKeyType.Native)]
    <span class="kwrd">public</span> <span class="kwrd">int</span> ID
    {
        get { <span class="kwrd">return</span> id; }
        set { id = <span class="kwrd">value</span>; }
    }

    [HasAndBelongsToMany(<span class="kwrd">typeof</span>(User),
        Table=<span class="str">"UserGroups"</span>,
        CompositeKeyColumnRefs=<span class="kwrd">new</span> <span class="kwrd">string</span>[]{<span class="str">"OrgID"</span>,<span class="str">"UserID"</span>},
        ColumnKey=<span class="str">"GroupID"</span>,
        Lazy=<span class="kwrd">true</span>,
        Inverse=<span class="kwrd">true</span>,
        Cascade=ManyRelationCascadeEnum.SaveUpdate)
    <span class="kwrd">public</span> ISet Users
    {
        get { <span class="kwrd">return</span> users; }
    }
}</pre>
  <p>
		On the side of the relationship <b>without</b> the composite key, an array of
		column refs is used, while on the side of the relationship <b>with</b> the composite key,
		it is an array of column keys.
	</p>		<!-- end content -->
		
	<div id="footer">
<script type="text/javascript"><!--
google_ad_client = "pub-2091974950947714";
/* 728x90, created 2/13/08 */
google_ad_slot = "5378217716";
google_ad_width = 728;
google_ad_height = 90;
//-->
</script>
<script type="text/javascript"
src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
	
	<br/>
	Found an error? Something inaccurate? 
	<a href="../../../../community/getinvolved.html">Help us improve the documentation</a> <br/>
	Generated by <a href="../../../../others/anakia/index.html">Castle Anakia</a>. 
	
	<p>&nbsp;</p>
	
	<p>
	Sponsored by <img src="../../../../images/logothumb.gif" /> <a href="http://www.castlestronghold.com">Castle Stronghold</a>.
	</p>
	
	</div>

	<!-- Search Google -->
<center>
<FORM method=GET action="http://www.google.com/custom">
<TABLE bgcolor="#FFFFFF" cellspacing="4" border="0" style="border: solid 1px gray;" align="center">
<tr valign=top><td>
<A HREF="http://www.google.com/search">
<IMG SRC="http://www.google.com/logos/Logo_40wht.gif" border=0 ALT=Google align=middle></A>
</td>
<td>
<INPUT TYPE=text name=q size=31 maxlength=255 value="">
<INPUT type=submit name=sa VALUE="Google Search">
<INPUT type=hidden name=cof VALUE="S:http://www.castlestronghold.com;GL:1;VLC:#373737;AH:center;LH:63;LC:#0A50A1;GFNT:#5B5B5B;L:http://www.castleproject.org/images/castle-logo.gif;ALC:#0A50A1;BIMG:http://www.castleproject.org/images/bg.png;LW:280;T:#5B5B5B;AWFID:3d565acacdd9f388;">
<input type=hidden name=domains value="castleproject.org"><br><input type=radio name=sitesearch value=""> Search WWW <input type=radio name=sitesearch value="castleproject.org" checked> Search castleproject.org
</td></tr></TABLE>
</FORM>
<!-- Search Google -->
</center>
	&nbsp;
	<br/>

		</div> <!-- end of content -->
  </div><!-- end of page -->
  


	<script type="text/javascript">_uacct = "UA-1190612-1";urchinTracker();</script>
	</body>
</html>
