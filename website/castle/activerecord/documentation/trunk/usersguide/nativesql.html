<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">









<html>
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1"/>
		<title>Native SQL Queries :: Castle Project</title>
		<link rel="stylesheet" href="../../../../base.css" />
		<link rel="stylesheet" href="../../../../front.css" />
		<link rel="stylesheet" href="../../../../elem.css" />
		<link rel="stylesheet" href="../../../../csharp.css" />
		<link rel="stylesheet" href="../../../../TAB_styles.css" />
		<script type="text/javascript" src="../../../../mktree.js"></script>
		<script type="text/javascript" src="../../../../TAB_Function_Lib.js"></script>
		<script src="http://www.google-analytics.com/urchin.js" type="text/javascript"></script>
	</head>

	<body>
<div id="topheader">
  <div id="maintitle">
	<h1> <a href="../../../../index.html" title="Castle Project Home" accesskey="1">Home</a> </h1>
	<h2> <a href="http://www.castlestronghold.com" title="Castle Stronghold: support, consulting and development">Castle Stronghold</a> </h2>
  </div>
  <div id="mainbar">
	<ul id="toplinks">
		<li>&nbsp;</li>
		<li><a style="_width: 70px;" href="../../../../index.html">Home</a></li>
		<li><a style="_width: 70px;" href="../../../../castle/download.html">Download</a></li>
		<li><a style="_width: 50px;" href="http://wiki.castleproject.org">Wiki</a></li>
		<li><a style="_width: 60px;" href="../../../../community/forum.html">Forum</a></li>
		<li><a style="_width: 120px;" href="../../../../jira.html">Issue Tracker</a></li>
		<li><a style="_width: 110px;" href="../../../../irc.html">IRC Channel</a></li>
		<li><a style="_width: 110px;" href="http://builds.castleproject.org">Build Server</a></li>
	</ul>
  </div>
</div>



<div id="coolpage">

	<div id="sidebar" >
		
  <div class="lightmenu">
    <div class="lightmenucontent">
<span class="menutitle">
<a href="./../../../../activerecord/index.html">ActiveRecord</a>
</span>
  <ul>
<li>
<a href="./../../../../activerecord/gettingstarted/index.html">Getting started</a>
</li>
<li>
<a href="./../../../../activerecord/faq.html">FAQ</a>
</li>
<li>
<a href="./../../../../activerecord/recipes/index.html">Recipes</a>
</li>
<li>
<a href="./../../../../activerecord/externalarticles.html">External Articles</a>
</li>
  </ul>
    </div>
  </div>
  <br/>
  <div class="lightmenu">
    <div class="lightmenucontent">
<span class="menutitle">
<a href="./../../../../activerecord/documentation/trunk/index.html">Documentation</a>
</span>
  <ul>
<li>
<a href="./../../../../activerecord/documentation/trunk/releasenotes/index.html">Release notes</a>
</li>
<li>
<a href="./../../../../activerecord/documentation/trunk/manual/index.html">Reference Manual</a>
</li>
<li>
<a href="./../../../../activerecord/documentation/trunk/usersguide/index.html">User's Guide</a>
</li>
<li>
<a href="./../../../../activerecord/documentation/trunk/advanced/index.html">Advanced usage</a>
</li>
  </ul>
    </div>
  </div>
  <br/>
  <div class="darkmenu">
    <div class="darkmenucontent">
<span class="menutitle">
Navigation
</span>
  <ul>
<li>
<a href="./../../../../index.html">Back to Main Page</a>
</li>
  </ul>
    </div>
  </div>
  <br/>
	<br/>
	
	</div>
		
	<div id="content">
	
		<div class="callout-pic">

<!-- Begin Table of contents -->
<!-- End Table of contents -->
		</div>

		<h1 class="firstHeading">
		    Native SQL Queries
		</h1> 
	
<div class="breadcrumbs">
&raquo;
	<a href="./../../../../index.html">Home</a> 
&raquo;
	<a href="./../../../../activerecord/index.html">ActiveRecord</a> 
&raquo;
	<a href="./../../../../activerecord/documentation/index.html">Documentation</a> 
&raquo;
	<a href="./../../../../activerecord/documentation/trunk/index.html">ActiveRecord trunk Documentation</a> 
&raquo;
	<a href="./../../../../activerecord/documentation/trunk/usersguide/index.html">User's Guide</a> 
&raquo;
<u>Native SQL Queries</u>
</div>

		<!-- start content -->
<p>
There is a couple of scenarios in which HQL doesn't provide for all features you need. 
For example if you want to intersec three or more tables adding them to the "from" clause.
Sometimes HQL complies with your requirements (most of them) but you want to get a fine 
grained sql statement control.
</p><p>
Teaching Native SQL Queries is out of the scope of this article. You should 
consult the <a href="http://www.hibernate.org/hib_docs/nhibernate/html/querysql.html" >NHibernate 
documentation on Native SQL Queries</a>.
</p><a name="CreateSQLQuery"></a>
  <h1>CreateSQLQuery</h1>
<p><tt>CreateSQLQuery</tt> is used 
	in cases where the query would be a native SQL query.
	</p><p>
	Here are an example that involves two models, one 
	to store words and another to store synonyms.
	</p>    <pre class="csharpcode">

<span class="kwrd">using</span> Castle.ActiveRecord.Queries;
<span class="kwrd">using</span> Castle.ActiveRecord;
<span class="kwrd">using</span> Castle.ActiveRecord.Framework;
<span class="kwrd">using</span> System.Collections;
<span class="kwrd">using</span> Iesi.Collections;
<span class="kwrd">using</span> NHibernate.Expression;
<span class="kwrd">using</span> NHibernate;

[ActiveRecord]
<span class="kwrd">public</span> <span class="kwrd">class</span> Word : ActiveRecordBase
{
    <span class="kwrd">private</span> <span class="kwrd">int</span> _id;
    <span class="kwrd">private</span> <span class="kwrd">string</span> _key;

    <span class="kwrd">public</span> Word() {}

    [PrimaryKey]
    <span class="kwrd">public</span> <span class="kwrd">int</span> Id
    {
        get { <span class="kwrd">return</span> _id; }
        set { _id = <span class="kwrd">value</span>; }
    }

    [Property]
    <span class="kwrd">public</span> <span class="kwrd">string</span> Key
    {
        get { <span class="kwrd">return</span> _key; }
        set { _key = <span class="kwrd">value</span>; }
    }

    <span class="kwrd">public</span> IList FindSynonyms()
    {
        ISessionFactoryHolder sessionHolder = ActiveRecordMediator.GetSessionFactoryHolder();
        ISession session = sessionHolder.CreateSession(<span class="kwrd">typeof</span>(Synonym));

        <span class="kwrd">try</span>
        {
            <span class="kwrd">string</span> query = <span class="str">"select synonym.key from  word, synonym "</span>;
            query += <span class="str">"where and synonym.word = word.id and word.key = '"</span> + Key +<span class="str">"'"</span>;
            IQuery sqlQuery = session.CreateSQLQuery(query, <span class="str">"Synonym"</span>, <span class="kwrd">typeof</span>(Synonym));
            sqlQuery.SetMaxResults(10);
            <span class="kwrd">return</span> sqlQuery.List();
        }
        <span class="kwrd">finally</span>
        {
            sessionHolder.ReleaseSession(session);
        }
    }
}
</pre>
  <p>
	Here you have a more complex query. There is a Menu model to store menu items, there is a MenuItemTranslation model to store items translations and the last model is the Language one, to store languages.
	</p>    <pre class="csharpcode">

<span class="kwrd">public</span> <span class="kwrd">string</span> FindTranslation(<span class="kwrd">string</span> lang)
{
    <span class="kwrd">if</span> ((lang == <span class="kwrd">null</span>) || (lang.Length == 0)) <span class="kwrd">return</span> Description;
    
    ISessionFactoryHolder sessionHolder = ActiveRecordMediator.GetSessionFactoryHolder();
    ISession session = sessionHolder.CreateSession(<span class="kwrd">typeof</span>(MenuItemTranslation));
    
    <span class="kwrd">try</span>
    {
        <span class="kwrd">string</span> query = <span class="str">"select menuitemtranslation.translation from  menu, language, menuitemtranslation "</span>;
        query += <span class="str">"where menuitemtranslation.menu = "</span> + Id;
        query += <span class="str">" and menuitemtranslation.lang = language.id and language.englishname = '"</span> + lang +<span class="str">"'"</span>;
        IQuery sqlQuery = session.CreateSQLQuery(query, <span class="str">"menuitemtranslation"</span>, <span class="kwrd">typeof</span>(MenuItemTranslation));
        sqlQuery.SetMaxResults(1);
        IList translations = sqlQuery.List();
        
        <span class="kwrd">if</span> ((translations != <span class="kwrd">null</span>) &amp;&amp; (translations.Count &gt; 0))
        {
            <span class="kwrd">return</span> ((MenuItemTranslation)translations[0]).Translation;
        }
        <span class="kwrd">else</span>
        {
            <span class="kwrd">return</span> Description; 
        }
    }
    <span class="kwrd">finally</span>
    {
        sessionHolder.ReleaseSession(session);
    }
}
</pre>
  		<!-- end content -->
		
	<div id="footer">
	Found an error? Something inaccurate? 
	<a href="../../../../community/getinvolved.html">Help us improve the documentation</a> <br/>
	Generated by <a href="../../../../others/anakia/index.html">Castle Anakia</a>. 
	
	<p>&nbsp;</p>
	
	<p>
	Sponsored by <img src="../../../../images/logothumb.gif" /> <a href="http://www.castlestronghold.com">Castle Stronghold</a>.
	</p>
	
	</div>

	<!-- Search Google -->
<center>
<FORM method=GET action="http://www.google.com/custom">
<TABLE bgcolor="#FFFFFF" cellspacing="4" border="0" style="border: solid 1px gray;" align="center">
<tr valign=top><td>
<A HREF="http://www.google.com/search">
<IMG SRC="http://www.google.com/logos/Logo_40wht.gif" border=0 ALT=Google align=middle></A>
</td>
<td>
<INPUT TYPE=text name=q size=31 maxlength=255 value="">
<INPUT type=submit name=sa VALUE="Google Search">
<INPUT type=hidden name=cof VALUE="S:http://www.castlestronghold.com;GL:1;VLC:#373737;AH:center;LH:63;LC:#0A50A1;GFNT:#5B5B5B;L:http://www.castleproject.org/images/castle-logo.gif;ALC:#0A50A1;BIMG:http://www.castleproject.org/images/bg.png;LW:280;T:#5B5B5B;AWFID:3d565acacdd9f388;">
<input type=hidden name=domains value="castleproject.org"><br><input type=radio name=sitesearch value=""> Search WWW <input type=radio name=sitesearch value="castleproject.org" checked> Search castleproject.org
</td></tr></TABLE>
</FORM>
<!-- Search Google -->
</center>
	&nbsp;
	<br/>

		</div> <!-- end of content -->
  </div><!-- end of page -->
  


	<script type="text/javascript">_uacct = "UA-1190612-1";urchinTracker();</script>
	</body>
</html>
