<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">









<html>
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1"/>
		<title>Initializing the Framework  :: Castle Project</title>
		<link rel="stylesheet" href="../../base.css" />
		<link rel="stylesheet" href="../../front.css" />
		<link rel="stylesheet" href="../../elem.css" />
		<link rel="stylesheet" href="../../csharp.css" />
		<link rel="stylesheet" href="../../TAB_styles.css" />
		<script type="text/javascript" src="../../mktree.js"></script>
		<script type="text/javascript" src="../../TAB_Function_Lib.js"></script>
		<script src="http://www.google-analytics.com/urchin.js" type="text/javascript"></script>
	</head>

	<body>
<div id="topheader">
  <div id="maintitle">
	<h1> <a href="../../index.html" title="Castle Project Home" accesskey="1">Home</a> </h1>
	<h2> <a href="http://www.castlestronghold.com" title="Castle Stronghold: support, consulting and development">Castle Stronghold</a> </h2>
  </div>
  <div id="mainbar">
	<ul id="toplinks">
		<li>&nbsp;</li>
		<li><a style="_width: 70px;" href="../../index.html">Home</a></li>
		<li><a style="_width: 70px;" href="../../castle/projects.html">Projects</a></li>
		<li><a style="_width: 70px;" href="../../castle/download.html">Downloads</a></li>
		<li><a style="_width: 110px;" href="http://api.castleproject.org">API Doc</a></li>
		<li><a style="_width: 50px;" href="http://using.castleproject.org">Using</a></li>
		<li><a style="_width: 60px;" href="../../community/mailinglists.html">Mailing Lists</a></li>
		<li><a style="_width: 120px;" href="../../issuetracker.html">Issue Tracker</a></li>
		<li><a style="_width: 110px;" href="http://builds.castleproject.org">Builds</a></li>
	</ul>
  </div>
</div>



<div id="coolpage">

	<div id="sidebar" >
		
  <div class="lightmenu">
    <div class="lightmenucontent">
<span class="menutitle">
<a href="./../../activerecord/gettingstarted/index.html">Introduction</a>
</span>
  <ul>
<li>
<a href="./../../activerecord/gettingstarted/requirements.html">Requirements</a>
</li>
<li>
<a href="./../../activerecord/gettingstarted/creatingdb.html">Creating the database and tables</a>
</li>
<li>
<a href="./../../activerecord/gettingstarted/classes.html">Creating the classes</a>
</li>
<li>
<a href="./../../activerecord/gettingstarted/relations.html">Adding the relationships</a>
</li>
<li>
<a href="./../../activerecord/gettingstarted/initandtest.html">Initializing the framework</a>
</li>
<li>
<a href="./../../activerecord/gettingstarted/usingit.html">Using the classes</a>
</li>
<li>
<a href="./../../activerecord/gettingstarted/more.html">Getting more</a>
</li>
  </ul>
    </div>
  </div>
  <br/>
  <div class="darkmenu">
    <div class="darkmenucontent">
<span class="menutitle">
Navigation
</span>
  <ul>
<li>
<a href="./../../activerecord/documentation/index.html">ActiveRecord Documentation</a>
</li>
<li>
<a href="./../../activerecord/index.html">Back to ActiveRecord</a>
</li>
<li>
<a href="./../../index.html">Back to Main Page</a>
</li>
  </ul>
    </div>
  </div>
  <br/>
	<br/>
	
	</div>
		
	<div id="content">
	
		<div class="callout-pic">
		<img src="../../images/ar_rawlogo.gif" />

<!-- Begin Table of contents -->
<div id="toc">
<h2>Table of contents</h2>
<ul>
<li class='toclevel-1'><span class="tocnumber">1</span> <span class="toctext">Configuring ActiveRecord</span>
</li>
<li class='toclevel-1'><span class="tocnumber">2</span> <span class="toctext">Initializing ActiveRecord</span>
</li>
<li class='toclevel-1'><span class="tocnumber">3</span> <span class="toctext">Creating the tables</span>
</li>
</ul>
</div>
<!-- End Table of contents -->
		</div>

		<h1 class="firstHeading">
		    Initializing the Framework 
		</h1> 
	
<div class="breadcrumbs">
&raquo;
	<a href="./../../index.html">Home</a> 
&raquo;
	<a href="./../../activerecord/index.html">ActiveRecord</a> 
&raquo;
	<a href="./../../activerecord/gettingstarted/index.html">Getting started with ActiveRecord</a> 
&raquo;
<u>Initializing the Framework </u>
</div>

		<!-- start content -->
<p>
Castle ActiveRecord must be initialized before you use any class.
This should be done only once and preferably at application start up.
In our case, as our example is a WinForms application, we would initialize
ActiveRecord before show any form.
</p><p>
ActiveRecord also needs a small configuration to tell it which 
database you are using and how to speak to it. In fact this is NHibernate configuration
that ActiveRecord pass on when it initializes NHibernate.
So it is time to decide where you want to keep this configuration. 
</p>  <h1>Configuring ActiveRecord</h1>
<p>
	We have some option on how to configure ActiveRecord and where
	to keep the configuration. Those are detailed explained on the documentation.
	For simplicity's sake we would use a simple standalone xml file:
	</p>    <pre class="csharpcode">

<span class="kwrd">&lt;?</span><span class="html">xml</span> <span class="attr">version</span><span class="kwrd">="1.0"</span> <span class="attr">encoding</span><span class="kwrd">="utf-8"</span> ?<span class="kwrd">&gt;</span> 

<span class="kwrd">&lt;</span><span class="html">activerecord</span><span class="kwrd">&gt;</span>

  <span class="kwrd">&lt;</span><span class="html">config</span><span class="kwrd">&gt;</span>
    <span class="kwrd">&lt;</span><span class="html">add</span> 
        <span class="attr">key</span><span class="kwrd">="connection.driver_class"</span>        
        <span class="attr">value</span><span class="kwrd">="NHibernate.Driver.SqlClientDriver"</span> <span class="kwrd">/&gt;</span>
    <span class="kwrd">&lt;</span><span class="html">add</span> 
        <span class="attr">key</span><span class="kwrd">="dialect"</span>                        
        <span class="attr">value</span><span class="kwrd">="NHibernate.Dialect.MsSql2005Dialect"</span> <span class="kwrd">/&gt;</span>
    <span class="kwrd">&lt;</span><span class="html">add</span> 
        <span class="attr">key</span><span class="kwrd">="connection.provider"</span>            
        <span class="attr">value</span><span class="kwrd">="NHibernate.Connection.DriverConnectionProvider"</span> <span class="kwrd">/&gt;</span>
    <span class="kwrd">&lt;</span><span class="html">add</span> 
        <span class="attr">key</span><span class="kwrd">="connection.connection_string"</span>    
        <span class="attr">value</span><span class="kwrd">="Data Source=.;Initial Catalog=test;Integrated Security=SSPI"</span> <span class="kwrd">/&gt;</span>
  <span class="kwrd">&lt;/</span><span class="html">config</span><span class="kwrd">&gt;</span>
  
<span class="kwrd">&lt;/</span><span class="html">activerecord</span><span class="kwrd">&gt;</span></pre>
    <div class="note">
<div class="notetopbg">
<div class="noteborderleft">
<div class="noteborderright">
<div class="notetopleft">
<div class="notetopright">
<div class="notebottomleft">
<div class="notebottomright">
<div class="boxtitle">Quick Note</div>
<div class="innercontent">
<p>
	The configuration above uses MS SQL Server 2005. If you are using a different
	database you need to change the dialect and driver. Please refer to the
<a href="../documentation/trunk/manual/xmlconfigref.html#Examples">Xml Configuration Reference</a> 
	document for more information.
	</p>
</div></div></div></div></div></div></div></div></div>
<p>
	Now save the file (on the folder to where the assembly is generated)
	with the content above as <tt>appconfig.xml</tt>. The following code
	creates a <tt>XmlConfigurationSource</tt> that loads the configuration above:
	</p>    <pre class="csharpcode">

<span class="kwrd">namespace</span> BlogSample
{
    <span class="kwrd">using</span> System.Windows.Forms;

    <span class="kwrd">using</span> BlogSample.UI;

    <span class="kwrd">using</span> Castle.ActiveRecord;
    <span class="kwrd">using</span> Castle.ActiveRecord.Framework.Config;

    <span class="kwrd">public</span> <span class="kwrd">class</span> App
    {
        <span class="kwrd">public</span> <span class="kwrd">static</span> <span class="kwrd">void</span> Main()
        {
            XmlConfigurationSource source = <span class="kwrd">new</span> XmlConfigurationSource(<span class="str">"appconfig.xml"</span>);
        }
    }
}</pre>
    <h1>Initializing ActiveRecord</h1>
<p>
	Finally we will initialize ActiveRecord passing the configuration loaded.
	We also need to specify the types ActiveRecord should inspect. We
	can do this by specifying an assembly, an array of assemblies
	or an array of types. For simplicity's sake, let's use an array of types:
	</p>    <pre class="csharpcode">

<span class="kwrd">namespace</span> BlogSample
{
    <span class="kwrd">using</span> System.Windows.Forms;

    <span class="kwrd">using</span> BlogSample.UI;

    <span class="kwrd">using</span> Castle.ActiveRecord;
    <span class="kwrd">using</span> Castle.ActiveRecord.Framework.Config;

    <span class="kwrd">public</span> <span class="kwrd">class</span> App
    {
        <span class="kwrd">public</span> <span class="kwrd">static</span> <span class="kwrd">void</span> Main()
        {
            XmlConfigurationSource source = <span class="kwrd">new</span> XmlConfigurationSource(<span class="str">"appconfig.xml"</span>);
            
            ActiveRecordStarter.Initialize( source, <span class="kwrd">typeof</span>(Blog), <span class="kwrd">typeof</span>(Post), <span class="kwrd">typeof</span>(User) );
        }
    }
}</pre>
  <p>
	At this point we are ready to use our type (as long as the configuration is
	right and the database exists).
	</p>  <h1>Creating the tables</h1>
<p>
	You may let ActiveRecord create the tables if you have not created it:
	</p>    <pre class="csharpcode">

<span class="kwrd">public</span> <span class="kwrd">class</span> App
{
    <span class="kwrd">public</span> <span class="kwrd">static</span> <span class="kwrd">void</span> Main()
    {
        XmlConfigurationSource source = <span class="kwrd">new</span> XmlConfigurationSource(<span class="str">"appconfig.xml"</span>);
        
        ActiveRecordStarter.Initialize( source, <span class="kwrd">typeof</span>(Blog), <span class="kwrd">typeof</span>(Post), <span class="kwrd">typeof</span>(User) );

        <span class="kwrd">if</span> (MessageBox.Show(<span class="str">"Do you want to let ActiveRecord create the database tables?"</span>, 
                              <span class="str">"Schema"</span>, MessageBoxButtons.YesNo, MessageBoxIcon.Question) == DialogResult.Yes)
        {
            ActiveRecordStarter.CreateSchema();
        }
    }
}
</pre>
  <p>
Now that our hands are partially dirty, we can start our real code
that use our classes. We can include more methods
on our classes to perform more database related operations.
</p><p>
Proceed with <a href="usingit.html" >using the classes</a>.
</p>		<!-- end content -->
		
	<div id="footer">
<script type="text/javascript"><!--
google_ad_client = "pub-2091974950947714";
/* 728x90, created 2/13/08 */
google_ad_slot = "5378217716";
google_ad_width = 728;
google_ad_height = 90;
//-->
</script>
<script type="text/javascript"
src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
	
	<br/>
	Found an error? Something inaccurate? 
	<a href="../../community/getinvolved.html">Help us improve the documentation</a> <br/>
	Generated by <a href="../../others/anakia/index.html">Castle Anakia</a>. 
	
	<p>&nbsp;</p>
	
	<p>
	Sponsored by <img src="../../images/logothumb.gif" /> <a href="http://www.castlestronghold.com">Castle Stronghold</a>.
	</p>
	
	</div>

	<!-- Search Google -->
<center>
<FORM method=GET action="http://www.google.com/custom">
<TABLE bgcolor="#FFFFFF" cellspacing="4" border="0" style="border: solid 1px gray;" align="center">
<tr valign=top><td>
<A HREF="http://www.google.com/search">
<IMG SRC="http://www.google.com/logos/Logo_40wht.gif" border=0 ALT=Google align=middle></A>
</td>
<td>
<INPUT TYPE=text name=q size=31 maxlength=255 value="">
<INPUT type=submit name=sa VALUE="Google Search">
<INPUT type=hidden name=cof VALUE="S:http://www.castlestronghold.com;GL:1;VLC:#373737;AH:center;LH:63;LC:#0A50A1;GFNT:#5B5B5B;L:http://www.castleproject.org/images/castle-logo.gif;ALC:#0A50A1;BIMG:http://www.castleproject.org/images/bg.png;LW:280;T:#5B5B5B;AWFID:3d565acacdd9f388;">
<input type=hidden name=domains value="castleproject.org"><br><input type=radio name=sitesearch value=""> Search WWW <input type=radio name=sitesearch value="castleproject.org" checked> Search castleproject.org
</td></tr></TABLE>
</FORM>
<!-- Search Google -->
</center>
	&nbsp;
	<br/>

		</div> <!-- end of content -->
  </div><!-- end of page -->
  


	<script type="text/javascript">_uacct = "UA-1190612-1";urchinTracker();</script>
	</body>
</html>
