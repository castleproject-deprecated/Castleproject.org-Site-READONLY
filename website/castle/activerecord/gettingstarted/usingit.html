<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">









<html>
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1"/>
		<title>Using the classes :: Castle Project</title>
		<link rel="stylesheet" href="../../base.css" />
		<link rel="stylesheet" href="../../front.css" />
		<link rel="stylesheet" href="../../elem.css" />
		<link rel="stylesheet" href="../../csharp.css" />
		<link rel="stylesheet" href="../../TAB_styles.css" />
		<script type="text/javascript" src="../../mktree.js"></script>
		<script type="text/javascript" src="../../TAB_Function_Lib.js"></script>
		<script src="http://www.google-analytics.com/urchin.js" type="text/javascript"></script>
	</head>

	<body>
<div id="topheader">
  <div id="maintitle">
	<h1> <a href="../../index.html" title="Castle Project Home" accesskey="1">Home</a> </h1>
	<h2> <a href="http://www.castlestronghold.com" title="Castle Stronghold: support, consulting and development">Castle Stronghold</a> </h2>
  </div>
  <div id="mainbar">
	<ul id="toplinks">
		<li>&nbsp;</li>
		<li><a style="_width: 70px;" href="../../index.html">Home</a></li>
		<li><a style="_width: 70px;" href="../../castle/projects.html">Projects</a></li>
		<li><a style="_width: 70px;" href="../../castle/download.html">Downloads</a></li>
		<li><a style="_width: 110px;" href="http://api.castleproject.org">API Doc</a></li>
		<li><a style="_width: 50px;" href="http://using.castleproject.org">Using</a></li>
		<li><a style="_width: 60px;" href="../../community/mailinglists.html">Mailing Lists</a></li>
		<li><a style="_width: 120px;" href="../../issuetracker.html">Issue Tracker</a></li>
		<li><a style="_width: 110px;" href="http://builds.castleproject.org">Builds</a></li>
	</ul>
  </div>
</div>



<div id="coolpage">

	<div id="sidebar" >
		
  <div class="lightmenu">
    <div class="lightmenucontent">
<span class="menutitle">
<a href="./../../activerecord/gettingstarted/index.html">Introduction</a>
</span>
  <ul>
<li>
<a href="./../../activerecord/gettingstarted/requirements.html">Requirements</a>
</li>
<li>
<a href="./../../activerecord/gettingstarted/creatingdb.html">Creating the database and tables</a>
</li>
<li>
<a href="./../../activerecord/gettingstarted/classes.html">Creating the classes</a>
</li>
<li>
<a href="./../../activerecord/gettingstarted/relations.html">Adding the relationships</a>
</li>
<li>
<a href="./../../activerecord/gettingstarted/initandtest.html">Initializing the framework</a>
</li>
<li>
<a href="./../../activerecord/gettingstarted/usingit.html">Using the classes</a>
</li>
<li>
<a href="./../../activerecord/gettingstarted/more.html">Getting more</a>
</li>
  </ul>
    </div>
  </div>
  <br/>
  <div class="darkmenu">
    <div class="darkmenucontent">
<span class="menutitle">
Navigation
</span>
  <ul>
<li>
<a href="./../../activerecord/documentation/index.html">ActiveRecord Documentation</a>
</li>
<li>
<a href="./../../activerecord/index.html">Back to ActiveRecord</a>
</li>
<li>
<a href="./../../index.html">Back to Main Page</a>
</li>
  </ul>
    </div>
  </div>
  <br/>
	<br/>
	
	</div>
		
	<div id="content">
	
		<div class="callout-pic">
		<img src="../../images/ar_rawlogo.gif" />

<!-- Begin Table of contents -->
<div id="toc">
<h2>Table of contents</h2>
<ul>
<li class='toclevel-1'><span class="tocnumber">1</span> <span class="toctext">Creating the first user</span>
</li>
<li class='toclevel-1'><span class="tocnumber">2</span> <span class="toctext">The login form</span>
</li>
<li class='toclevel-1'><span class="tocnumber">3</span> <span class="toctext">The blog management</span>
</li>
<li class='toclevel-1'><span class="tocnumber">4</span> <span class="toctext">The posts management</span>
</li>
</ul>
</div>
<!-- End Table of contents -->
		</div>

		<h1 class="firstHeading">
		    Using the classes
		</h1> 
	
<div class="breadcrumbs">
&raquo;
	<a href="./../../index.html">Home</a> 
&raquo;
	<a href="./../../activerecord/index.html">ActiveRecord</a> 
&raquo;
	<a href="./../../activerecord/gettingstarted/index.html">Getting started with ActiveRecord</a> 
&raquo;
<u>Using the classes</u>
</div>

		<!-- start content -->
<p>
You are now acquainted with most parts of ActiveRecord. We just need
to start using the classes we have created. You will note that it couldn't get more
natural.
</p>  <h1>Creating the first user</h1>
<p>
	Our application has a login form. You must inform a correct 
	login and password in order to get access to the rest of the application.
	But the database was just created. What about adding the first user?
	</p><p>
	The following code creates an user, it should be added 
	to the main class just below the initialization.
	</p>    <pre class="csharpcode">

User user = <span class="kwrd">new</span> User(<span class="str">"admin"</span>, <span class="str">"123"</span>);

user.Create();</pre>
  <p>
	What if you run the application multiples times?
	A good solution would be to create the user only
	if no user is found on the database. We could count 
	the existing users and if it is zero, we create the admin:
	</p>    <pre class="csharpcode">

<span class="kwrd">if</span> (User.GetUsersCount() == 0)
{
    User user = <span class="kwrd">new</span> User(<span class="str">"admin"</span>, <span class="str">"123"</span>);

    user.Create();
}</pre>
  <p>
	Obviously we need to add the method <tt>GetUsersCount</tt>
	to the User class:
	</p>    <pre class="csharpcode">

[ActiveRecord(<span class="str">"[User]"</span>)]
<span class="kwrd">public</span> <span class="kwrd">class</span> User : ActiveRecordBase&lt;User&gt;
{
    ...
    
    <span class="kwrd">public</span> <span class="kwrd">static</span> <span class="kwrd">int</span> GetUsersCount()
    {
        <span class="kwrd">return</span> Count();
    }
}</pre>
    <h1>The login form</h1>
<p>
	This window ask for a login:
	</p><p><img src="./../../images/activerecord/gt_3.png" ></img></p><p>
	The code is very simple, and makes uses of a search method that 
	so far does not exists:
	</p>    <pre class="csharpcode">

<span class="kwrd">private</span> <span class="kwrd">void</span> logInButton_Click(<span class="kwrd">object</span> sender, System.EventArgs e)
{
    User user = User.FindByUserName(loginText.Text);

    <span class="kwrd">if</span> (user == <span class="kwrd">null</span>)
    {
        MessageBox.Show(<span class="kwrd">this</span>, <span class="str">"User not found"</span>, <span class="str">"Error"</span>, MessageBoxButtons.OK, MessageBoxIcon.Error);
        <span class="kwrd">return</span>;
    }

    <span class="kwrd">if</span> (user.Password != passwordText.Text)
    {
        MessageBox.Show(<span class="kwrd">this</span>, <span class="str">"Wrong password"</span>, <span class="str">"Error"</span>, MessageBoxButtons.OK, MessageBoxIcon.Error);
        <span class="kwrd">return</span>;
    }

    DialogResult = DialogResult.OK;
    Hide();
}</pre>
  <p>
	To make this work we need to include the method <tt>FindByUserName</tt>.
	As usual it is not difficult at all:
	</p>    <pre class="csharpcode">

<span class="kwrd">using</span> NHibernate.Criterion;

[ActiveRecord(<span class="str">"[User]"</span>)]
<span class="kwrd">public</span> <span class="kwrd">class</span> User : ActiveRecordBase&lt;User&gt;
{
    ...
    
    <span class="kwrd">public</span> <span class="kwrd">static</span> User FindByUserName(<span class="kwrd">string</span> userName)
    {
        <span class="rem">// Note that we use the property name, _not_ the column name</span>
        <span class="kwrd">return</span> FindOne(Expression.Eq(<span class="str">"Username"</span>, userName));
    }
}</pre>
    <h1>The blog management</h1>
<p>
	This window allows one to add, edit and delete a blog. It also brings
	another window to manage the posts that belongs to the selected blog.
	</p><p><img src="./../../images/activerecord/gt_2.png" ></img></p><p>
	When you click <tt>Add...</tt> or select an existing
	blog, another window will show.
	</p><p><img src="./../../images/activerecord/gt_1.png" ></img></p><p>
	To populate the blog list we select all existing blogs:
	</p>    <pre class="csharpcode">

<span class="kwrd">private</span> <span class="kwrd">void</span> PopulateBlogList()
{
    blogsList.Items.Clear();

    <span class="kwrd">foreach</span>(Blog blog <span class="kwrd">in</span> Blog.FindAll())
    {
        ListViewItem item = blogsList.Items.Add(blog.Id.ToString());

        item.Tag = blog;

        item.SubItems.Add(blog.Name);
        item.SubItems.Add(blog.Author);
    }
}</pre>
  <p>
	To create a new blog on the database all we need to do is
	</p>    <pre class="csharpcode">

Blog blog = <span class="kwrd">new</span> Blog();
blog.Name = <span class="str">"My blog"</span>;
blog.Author = <span class="str">"hammett"</span>;
blog.Create();
    </pre>
  <p>
	Suppose that you don't have
	an blog instance, but you know the id. Let's change a blog instance then:
	</p>    <pre class="csharpcode">

Blog blog = Blog.Find(100); <span class="rem">// Id that we know exists</span>
blog.Name = <span class="str">"Different name"</span>;
blog.Author = <span class="str">"Different author"</span>;
blog.Update();
    </pre>
  <p>
	To remove an instance, just call the <tt>Delete</tt> method.
	</p>  <h1>The posts management</h1>
<p>
	With the posts we just cannot forget to relate the
	blog instance with the post we are creating:
	</p>    <pre class="csharpcode">

currentPost.Blog = parentBlog;

currentPost.Title = titleText.Text;
currentPost.Contents = contentsText.Text;
currentPost.Category = categoryText.Text;
currentPost.Created = createdDtTime.Value;
currentPost.Published = publishedCheck.Checked;

currentPost.Save();</pre>
  <p>
Proceed with <a href="more.html" >Getting more</a>.
</p>		<!-- end content -->
		
	<div id="footer">
<script type="text/javascript"><!--
google_ad_client = "pub-2091974950947714";
/* 728x90, created 2/13/08 */
google_ad_slot = "5378217716";
google_ad_width = 728;
google_ad_height = 90;
//-->
</script>
<script type="text/javascript"
src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
	
	<br/>
	Found an error? Something inaccurate? 
	<a href="../../community/getinvolved.html">Help us improve the documentation</a> <br/>
	Generated by <a href="../../others/anakia/index.html">Castle Anakia</a>. 
	
	<p>&nbsp;</p>
	
	<p>
	Sponsored by <img src="../../images/logothumb.gif" /> <a href="http://www.castlestronghold.com">Castle Stronghold</a>.
	</p>
	
	</div>

	<!-- Search Google -->
<center>
<FORM method=GET action="http://www.google.com/custom">
<TABLE bgcolor="#FFFFFF" cellspacing="4" border="0" style="border: solid 1px gray;" align="center">
<tr valign=top><td>
<A HREF="http://www.google.com/search">
<IMG SRC="http://www.google.com/logos/Logo_40wht.gif" border=0 ALT=Google align=middle></A>
</td>
<td>
<INPUT TYPE=text name=q size=31 maxlength=255 value="">
<INPUT type=submit name=sa VALUE="Google Search">
<INPUT type=hidden name=cof VALUE="S:http://www.castlestronghold.com;GL:1;VLC:#373737;AH:center;LH:63;LC:#0A50A1;GFNT:#5B5B5B;L:http://www.castleproject.org/images/castle-logo.gif;ALC:#0A50A1;BIMG:http://www.castleproject.org/images/bg.png;LW:280;T:#5B5B5B;AWFID:3d565acacdd9f388;">
<input type=hidden name=domains value="castleproject.org"><br><input type=radio name=sitesearch value=""> Search WWW <input type=radio name=sitesearch value="castleproject.org" checked> Search castleproject.org
</td></tr></TABLE>
</FORM>
<!-- Search Google -->
</center>
	&nbsp;
	<br/>

		</div> <!-- end of content -->
  </div><!-- end of page -->
  


	<script type="text/javascript">_uacct = "UA-1190612-1";urchinTracker();</script>
	</body>
</html>
