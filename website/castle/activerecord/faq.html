<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">









<html>
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1"/>
		<title>FAQ :: Castle Project</title>
		<link rel="stylesheet" href="../base.css" />
		<link rel="stylesheet" href="../front.css" />
		<link rel="stylesheet" href="../elem.css" />
		<link rel="stylesheet" href="../csharp.css" />
		<link rel="stylesheet" href="../TAB_styles.css" />
		<script type="text/javascript" src="../mktree.js"></script>
		<script type="text/javascript" src="../TAB_Function_Lib.js"></script>
		<script src="http://www.google-analytics.com/urchin.js" type="text/javascript"></script>
	</head>

	<body>
<div id="topheader">
  <div id="maintitle">
	<h1> <a href="../index.html" title="Castle Project Home" accesskey="1">Home</a> </h1>
	<h2> <a href="http://www.castlestronghold.com" title="Castle Stronghold: support, consulting and development">Castle Stronghold</a> </h2>
  </div>
  <div id="mainbar">
	<ul id="toplinks">
		<li>&nbsp;</li>
		<li><a style="_width: 70px;" href="../index.html">Home</a></li>
		<li><a style="_width: 70px;" href="../castle/projects.html">Projects</a></li>
		<li><a style="_width: 70px;" href="../castle/download.html">Downloads</a></li>
		<li><a style="_width: 110px;" href="http://api.castleproject.org">API Doc</a></li>
		<li><a style="_width: 50px;" href="http://using.castleproject.org">Using</a></li>
		<li><a style="_width: 60px;" href="../community/mailinglists.html">Mailing Lists</a></li>
		<li><a style="_width: 120px;" href="../issuetracker.html">Issue Tracker</a></li>
		<li><a style="_width: 110px;" href="http://builds.castleproject.org">Builds</a></li>
	</ul>
  </div>
</div>



<div id="coolpage">

	<div id="sidebar" >
		
  <div class="lightmenu">
    <div class="lightmenucontent">
<span class="menutitle">
<a href="./../activerecord/index.html">ActiveRecord</a>
</span>
  <ul>
<li>
<a href="./../activerecord/gettingstarted/index.html">Getting started</a>
</li>
<li>
<a href="./../activerecord/documentation/index.html">Documentation</a>
</li>
<li>
<a href="./../activerecord/faq.html">FAQ</a>
</li>
<li>
<a href="./../activerecord/recipes/index.html">Recipes</a>
</li>
<li>
<a href="./../activerecord/externalarticles.html">External Articles</a>
</li>
<li>
<a href="./../activerecord/roadmap.html">Roadmap</a>
</li>
  </ul>
    </div>
  </div>
  <br/>
  <div class="darkmenu">
    <div class="darkmenucontent">
<span class="menutitle">
Navigation
</span>
  <ul>
<li>
<a href="./../index.html">Back to Main Page</a>
</li>
  </ul>
    </div>
  </div>
  <br/>
	<br/>
	
	</div>
		
	<div id="content">
	
		<div class="callout-pic">
		<img src="../images/ar_rawlogo.gif" />

<!-- Begin Table of contents -->
<div id="toc">
<h2>Table of contents</h2>
<ul>
<li class='toclevel-1'><a href="#general"><span class="tocnumber">1</span> <span class="toctext">General questions</span></a>
<ul>
	<li class='toclevel-1'><span class="tocnumber">1.1</span> <span class="toctext">What is ActiveRecord?</span>
</li>
	<li class='toclevel-1'><span class="tocnumber">1.2</span> <span class="toctext">What is Castle ActiveRecord?</span>
</li>
	<li class='toclevel-1'><span class="tocnumber">1.3</span> <span class="toctext">How does it differ from pure NHibernate usage?</span>
</li>
	<li class='toclevel-1'><a href="#nhlongtextcolumns"><span class="tocnumber">1.4</span> <span class="toctext">My text columns are being truncated</span></a>
</li>
	<li class='toclevel-1'><span class="tocnumber">1.5</span> <span class="toctext">My property name is a reserved word in my database</span>
</li>
	<li class='toclevel-1'><span class="tocnumber">1.6</span> <span class="toctext">
	ActiveRecord throws an exception saying: Ambiguous column name 'Status'
	</span>
</li>
</ul>
</li>
<li class='toclevel-1'><a href="#dbrelated"><span class="tocnumber">2</span> <span class="toctext">Database related</span></a>
<ul>
	<li class='toclevel-1'><span class="tocnumber">2.1</span> <span class="toctext">Gaining access to the underlying database connection</span>
</li>
</ul>
</li>
<li class='toclevel-1'><a href="#lazyloading"><span class="tocnumber">3</span> <span class="toctext">Lazy loading</span></a>
<ul>
	<li class='toclevel-1'><span class="tocnumber">3.1</span> <span class="toctext">How to enable lazy loading</span>
</li>
	<li class='toclevel-1'><span class="tocnumber">3.2</span> <span class="toctext">What 'Failed to lazily initialize a collection - no session' error means?</span>
</li>
	<li class='toclevel-1'><span class="tocnumber">3.3</span> <span class="toctext">Lazy loading in web applications</span>
</li>
	<li class='toclevel-1'><span class="tocnumber">3.4</span> <span class="toctext">Lazy loading in desktop/winforms applications</span>
</li>
</ul>
</li>
<li class='toclevel-1'><a href="#nhflushing"><span class="tocnumber">4</span> <span class="toctext">Changes to objects are persisted without an explicit call to the Save() method</span></a>
</li>
</ul>
</div>
<!-- End Table of contents -->
		</div>

		<h1 class="firstHeading">
		    FAQ
		</h1> 
	
<div class="breadcrumbs">
&raquo;
	<a href="./../index.html">Home</a> 
&raquo;
	<a href="./../activerecord/index.html">ActiveRecord</a> 
&raquo;
<u>FAQ</u>
</div>

		<!-- start content -->
<p>
This page has a list of frequently asked questions.
</p><a name="general"></a>
  <h1>General questions</h1>
  <h2>What is ActiveRecord?</h2>
<p>
	ActiveRecord is a well-known pattern described in 
	<a href="http://www.amazon.com/exec/obidos/tg/detail/-/0321127420/qid=1119217017/sr=8-1/ref=sr_8_xs_ap_i1_xgl14/103-5320883-5187853" >Patterns of Enterprise Application Architecture</a>. 
	Basically all static methods act on the whole set of records, while instances represents each row.
	</p><p>
	Read more about the pattern:
	<ul><li><a href="http://www.martinfowler.com/eaaCatalog/activeRecord.html" >Patterns of Enterprise Application Architecture Catalog - Active Record pattern</a></li><li><a href="http://en.wikipedia.org/wiki/Active_record" >Wikipedia Active Record article</a></li></ul></p>  <h2>What is Castle ActiveRecord?</h2>
<p>
	Castle ActiveRecord is an implementation of the ActiveRecord Pattern inspired by <a href="http://api.rubyonrails.com/?u=ar.rubyonrails.com" >Rails' ActiveRecord</a>, which relies on NHibernate to perform the actual mapping (as you see we don't suffer from Not-invented-here anti-pattern).
	</p>  <h2>How does it differ from pure NHibernate usage?</h2>
<p>
	Castle ActiveRecord was built on top of NHibernate. It offers:
	</p><p><ul><li>Fast development (it handles the mapping and infers as much as it can so you don't have to dig into documentation or deal with tons of xml files every time something changes on your schema)</li><li>Predefined common methods like <tt>Create</tt>, <tt>Update</tt>, <tt>Save</tt>, <tt>Delete</tt></li><li>Easy to implement method like <tt>Find</tt>, <tt>FindAll</tt>, <tt>FindByName</tt>. (Predefined if you use <tt>ActiveRecordBase<T></tt>) </li><li>Session and transaction scopes that abstracts the <tt>ISession</tt> offering a more natural idiom</li></ul></p><p>
By using pure NHibernate, you have more control over more complex mappings. However, using Castle ActiveRecord is a guarantee to boost your productivity.
	</p><a name="nhlongtextcolumns"></a>
  <h2>My text columns are being truncated</h2>
<p>
	Add <tt>ColumnType="StringClob"</tt> parameter to your <tt>Property</tt> attribute. For example:
	</p>    <pre class="csharpcode">

[Property(ColumnType=<span class="str">"StringClob"</span>)]
<span class="kwrd">public</span> String Contents
{
    get { <span class="kwrd">return</span> _contents; }
    set { _contents = <span class="kwrd">value</span>; }
}
</pre>
  <p>
This tells NHibernate to map the string to a Text type rather than a nvarchar(4000) type.
</p>  <h2>My property name is a reserved word in my database</h2>
<p>
	Add explicit column name parameter to your <tt>Property</tt> attribute and quote it with backticks. For example:
	</p>    <pre class="csharpcode">

[Property(<span class="str">"`User`"</span>)]
<span class="kwrd">public</span> String User
{
    get { <span class="kwrd">return</span> _user; }
    set { _user = <span class="kwrd">value</span>; }
}
</pre>
  <p>
This tells NHibernate to quote the column name when querying the database.
</p>  <h2>
	ActiveRecord throws an exception saying: Ambiguous column name 'Status'
	</h2>
<p>
	A column named <tt>Status</tt> is returned internally by 
	NHibernate. Try renaming your column in the database.
	</p><a name="dbrelated"></a>
  <h1>Database related</h1>
  <h2>Gaining access to the underlying database connection</h2>
<p>
	This is possible using the session holder:
	</p>    <pre class="csharpcode">

<span class="kwrd">using</span> Castle.ActiveRecord;

...

<span class="rem">// Expects a root type</span>
ISession sess = ActiveRecordMediator.GetSessionFactoryHolder().
    CreateSession(<span class="kwrd">typeof</span>(ActiveRecordBase));
    
<span class="rem">// Now you can use sess.DbConnection</span>

ActiveRecordMediator.GetSessionFactoryHolder().ReleaseSession(sess);
    </pre>
  <p>
	Try to use a finally block to release the session. Do not invoke
	<tt>ISession.Close</tt> or <tt>ISession.Dispose</tt></p><a name="lazyloading"></a>
  <h1>Lazy loading</h1>
  <h2>How to enable lazy loading</h2>
<p>
	Check the documentation (<a href="documentation/trunk/usersguide/lazy.html" >trunk</a> or <a href="documentation/v1rc1/usersguide/lazy.html" >v1rc1</a>) on lazy load.
	</p>  <h2>What 'Failed to lazily initialize a collection - no session' error means?</h2>
<p>
	Means that there is no session available. 
	Check the documentation on lazy load in order to know how to make it work properly.
	</p>  <h2>Lazy loading in web applications</h2>
<p>
	Check the documentation on ActiveRecord in web applications.
	</p>  <h2>Lazy loading in desktop/winforms applications</h2>
<p>
	Start the ActiveRecord during application start up. You can create a 
	readonly 
	<tt>SessionScope</tt> and flush it in appropriate moments using 
	<tt>SessionScope.Current.Flush</tt>. Check the manual for further reference.
	</p><a name="nhflushing"></a>
  <h1>Changes to objects are persisted without an explicit call to the Save() method</h1>
<p>
	This commonly happens if you are using SessionScope per request pattern. 
	Basically this is an expected NHibernate 
	behavior, although the first time you experience it,
	it can seem very confusing. 
		</p><p>
From: <a href="http://www.hibernate.org/359.html#A7" >NHibernate Users FAQ</a></p><p><i>
"When an object is loaded by NHibernate the ISession keeps a snapshot of the state of your object. When you Flush() the ISession NHibernate compares that snapshot to the current state of the object. The appropriate changes are written to the database."
		</i></p><p>
So when the Session is Flush()ed any changes to an objects state are written to the database. The next question is when does a Flush() occur? Well according to <a href="http://www.tobinharris.com/2007/2/3/nhibernate-faq" >Tobins' NHibernate FAQ</a>
 it can occur at a number of different (and possibly unexpected) places. 
		</p><p>
		If this is really bothering you, you can create a readonly 
		<tt>SessionScope</tt>. 
		In this case it is up to you to Flush it. You can read more about 
		the SessionScope on ActiveRecord documentation.		
		</p>		<!-- end content -->
		
	<div id="footer">
<script type="text/javascript"><!--
google_ad_client = "pub-2091974950947714";
/* 728x90, created 2/13/08 */
google_ad_slot = "5378217716";
google_ad_width = 728;
google_ad_height = 90;
//-->
</script>
<script type="text/javascript"
src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
	
	<br/>
	Found an error? Something inaccurate? 
	<a href="../community/getinvolved.html">Help us improve the documentation</a> <br/>
	Generated by <a href="../others/anakia/index.html">Castle Anakia</a>. 
	
	<p>&nbsp;</p>
	
	<p>
	Sponsored by <img src="../images/logothumb.gif" /> <a href="http://www.castlestronghold.com">Castle Stronghold</a>.
	</p>
	
	</div>

	<!-- Search Google -->
<center>
<FORM method=GET action="http://www.google.com/custom">
<TABLE bgcolor="#FFFFFF" cellspacing="4" border="0" style="border: solid 1px gray;" align="center">
<tr valign=top><td>
<A HREF="http://www.google.com/search">
<IMG SRC="http://www.google.com/logos/Logo_40wht.gif" border=0 ALT=Google align=middle></A>
</td>
<td>
<INPUT TYPE=text name=q size=31 maxlength=255 value="">
<INPUT type=submit name=sa VALUE="Google Search">
<INPUT type=hidden name=cof VALUE="S:http://www.castlestronghold.com;GL:1;VLC:#373737;AH:center;LH:63;LC:#0A50A1;GFNT:#5B5B5B;L:http://www.castleproject.org/images/castle-logo.gif;ALC:#0A50A1;BIMG:http://www.castleproject.org/images/bg.png;LW:280;T:#5B5B5B;AWFID:3d565acacdd9f388;">
<input type=hidden name=domains value="castleproject.org"><br><input type=radio name=sitesearch value=""> Search WWW <input type=radio name=sitesearch value="castleproject.org" checked> Search castleproject.org
</td></tr></TABLE>
</FORM>
<!-- Search Google -->
</center>
	&nbsp;
	<br/>

		</div> <!-- end of content -->
  </div><!-- end of page -->
  


	<script type="text/javascript">_uacct = "UA-1190612-1";urchinTracker();</script>
	</body>
</html>
