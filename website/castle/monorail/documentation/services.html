<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">








<html>
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1"/>
		<title>MonoRail Services Architecture :: Castle Project</title>
		<link rel="stylesheet" href="../../base.css" />
		<link rel="stylesheet" href="../../elem.css" />
		<link rel="stylesheet" href="../../csharp.css" />
	</head>

	<body>

<div id="container">

  <div id="topbuttonscontainer"></div>

  <div id="maintitle">
    <h1> <a href="/" title="Home" accesskey="1">Home</a> </h1>
  </div>

  <div id="mainbar">
    <div id="mainbarleft"><div id="mainbarright"></div></div>
  </div>
  
  <div id="page">
		<div id="sidebar" >
  <div class="darkmenu">
    <div class="darkmenucontent">
<span class="menutitle">
<a href="">Table of Contents</a>
</span>
  <ul>
<li>
<a href="">Why would I use it</a>
</li>
<li>
<a href="">Why would I not use it</a>
</li>
  </ul>
    </div>
  </div>
  <br/>
  <div class="lightmenu">
    <div class="lightmenucontent">
<span class="menutitle">
<a href="">Navigation</a>
</span>
  <ul>
<li>
<a href="">Docs for version Beta 4</a>
</li>
<li>
<a href="">Docs for version Release Candidate 1 </a>
</li>
  </ul>
    </div>
  </div>
  <br/>
			<br/>
		</div>
		
		<div id="content">

		<h1 class="firstHeading">
		    MonoRail Services Architecture
		</h1> 
	
<div class="breadcrumbs">
&raquo;
	<a href="./../../index.html">Main Page</a> 
&raquo;
	<a href="./../../monorail/index.html">MonoRail Index</a> 
&raquo;
	<a href="./../../monorail/documentation/index.html">Documentation Index</a> 
&raquo;
<u>MonoRail Services Architecture</u>
</div>

		<!-- start content -->

  <p>
MonoRail uses a set of services to handle specific tasks. The framework
is responsible for defining the default implementations, instantiate,
start and configure them. The services are made available through a combination
of lifecycle interfaces and an implementation of <tt>IServiceProvider</tt></p>
		
<a name="StatingTheProblem"></a>
  <h1>Stating the problem</h1>
  <p>
It's impossible to come up with a sophisticated software
where the default behavior pleases everyone and integrates with everything.
The usual solution is making the software rely on contracts and
having the core code as just a coordination of invocations on the contracts
implementation. An user is thus capable of replacing one or more
contract implementation.
</p>
  <p>
The challenging is implementing an architecture where 
the parts are easily replaced, configurable and can rely (depend) on 
other parts.
</p>
<a name="AnApproachToThisProblem"></a>
  <h1>How MonoRail tackles this problem</h1>
  <p>
The most usual solution to this problem is to use an Inversion of
Control container. However, things have to be balanced. For MonoRail, 
an IoC container would introduce dependencies on assemblies
and an longer initialization. In the end, we wouldn't benefit from
all IoC container features, so it could be considered too much for our problem.
</p>
  <p>
Instead, we combined what is already on the .Net library
and some creative solution. 
</p>
  <p>
Basically we create two levels of services registries, per application and per request,
and a simple interfaces that defines lifecycles that services optionally implement.
This allow the service to start its work when it is supposed to and to 
gather reference to other services.
</p>
<a name="Flow"></a>
  <h1>How it works</h1>
  <p>
When the web application is started, the ASP.Net modules are initialized. 
MonoRail has a <tt>EngineContextModule</tt> which is in charge of 
</p>
  <p>
Services implementation can be defined in the configuration section. 
After reading the configuration section MonoRail checks for missing definition
and register the missing services using the default implementation.
</p>
  <p>
After that it instantiates every service and runs the lifecycle. If everything
went well, the framework is properly initialized. All services are registered in 
the application level container, which happens to be implemented by 
the <tt>EngineContextModule</tt> class. We call this the parent container.
</p>
  <p>
When a request starts, MonoRail creates a <tt>DefaultRailsEngineContext</tt> 
instance, which also is a container for services. MonoRail sets the parent 
container on it. This allow the user to override services per request, and 
resolution of services in the parent.
</p>
<a name="Flow"></a>
  <h1>The initialization flow</h1>
  <p><img src="../images/monorail/mr_services_1.png" /></p>
  <p><ol><li>The configuration is read into the <tt>MonoRailConfiguration</tt>. It's also registered as a service</li><li>The services collected are instantiated and registered</li><li>The lifecycle is executed</li></ol></p>
<a name="Lifecycle"></a>
  <h1>Lifecycle interfaces</h1>
  <p>
A service might implement a few interfaces to expose to MonoRail
that it behaves in a specific way or that it needs something 
from the framework.
</p>
  <h2>ISupportInitialize (from System.ComponentModel)</h2>
  <p>This interface can be implemented if a service wants performs some initialization.</p>
  <h2>IInitializable (from Castle.Core)</h2>
  <p>This interface can be implemented if a service wants performs some initialization.</p>
  <h2>IServiceEnabledComponent (from Castle.Core)</h2>
  <p>This interface can be implemented if a service uses other services.</p>
  <h2>Invocation order</h2>
  <p><tt>IServiceEnabledComponent</tt> is the first one to be invoked. This gives a 
chance to services gather all services references it wants. Then the initialization 
interface's methods are invoked.
</p>
  <h2>The expected (good) behavior from a service implementation</h2>
  <p>
For service that uses <tt>IServiceEnabledComponent</tt> lifecycle, the implementor
should keep in mind that the initialization lifecycle has not run for any
service, so it might not be safe to use other services as they might not be properly
initialized at the moment.
</p>
  <p>
The order of service registration and instantiation is not guaranted. So the 
implementor should not make any assumption regarding that.
</p>
<a name="Services"></a>
  <h1>Built-in services</h1>
  <p>
The following is a succint list of services and their roles. You can
refer to this list to learn more about MonoRail inner workings
or to use them when developing extensions and new services.
</p>
  <h2>MonoRailConfiguration</h2>
  <p>Pendent</p>
  <h2>ExtensionManager</h2>
  <p>Pendent</p>
  <h2>IViewSourceLoader</h2>
  <p>Pendent</p>
  <h2>IViewEngine</h2>
  <p>Pendent</p>
  <h2>IScaffoldingSupport</h2>
  <p>Pendent</p>
  <h2>IControllerFactory</h2>
  <p>Pendent</p>
  <h2>IViewComponentFactory</h2>
  <p>Pendent</p>
  <h2>IFilterFactory</h2>
  <p>Pendent</p>
  <h2>IResourceFactory</h2>
  <p>Pendent</p>
  <h2>IEmailSender</h2>
  <p>Pendent</p>
  <h2>IEmailTemplateService</h2>
  <p>Pendent</p>
  <h2>IControllerDescriptorProvider</h2>
  <p>Pendent</p>
  <h2>IResourceDescriptorProvider</h2>
  <p>Pendent</p>
  <h2>IRescueDescriptorProvider</h2>
  <p>Pendent</p>
  <h2>ILayoutDescriptorProvider</h2>
  <p>Pendent</p>
  <h2>IHelperDescriptorProvider</h2>
  <p>Pendent</p>
  <h2>IFilterDescriptorProvider</h2>
  <p>Pendent</p>
  <h2>IControllerTree</h2>
  <p>Pendent</p>
  <h2>ICacheProvider</h2>
  <p>Pendent</p>
  <h1>Registering services</h1>
  <p>
The ..
</p>
		
		<!-- end content -->
		
	<div id="footer">

	Found an error? Something inaccurate? <a href="">Help us improve the documentation</a> <br/>
	Generated by <a href="">Castle Anakia</a>

	</div>

	&nbsp;
	<br/>

		</div> <!-- end of content -->
  </div><!-- end of page -->
  
</div>

	</body>
</html>
