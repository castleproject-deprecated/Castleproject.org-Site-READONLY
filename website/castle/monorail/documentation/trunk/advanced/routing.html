<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">









<html>
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1"/>
		<title>Routing :: Castle Project</title>
		<link rel="stylesheet" href="../../../../base.css" />
		<link rel="stylesheet" href="../../../../front.css" />
		<link rel="stylesheet" href="../../../../elem.css" />
		<link rel="stylesheet" href="../../../../csharp.css" />
		<link rel="stylesheet" href="../../../../TAB_styles.css" />
		<script type="text/javascript" src="../../../../mktree.js"></script>
		<script type="text/javascript" src="../../../../TAB_Function_Lib.js"></script>
		<script src="http://www.google-analytics.com/urchin.js" type="text/javascript"></script>
	</head>

	<body>
<div id="topheader">
  <div id="maintitle">
	<h1> <a href="../../../../index.html" title="Castle Project Home" accesskey="1">Home</a> </h1>
	<h2> <a href="http://www.castlestronghold.com" title="Castle Stronghold: support, consulting and development">Castle Stronghold</a> </h2>
  </div>
  <div id="mainbar">
	<ul id="toplinks">
		<li>&nbsp;</li>
		<li><a style="_width: 70px;" href="../../../../index.html">Home</a></li>
		<li><a style="_width: 70px;" href="../../../../castle/projects.html">Projects</a></li>
		<li><a style="_width: 70px;" href="../../../../castle/download.html">Downloads</a></li>
		<li><a href="#" onclick="UserVoice.Popin.show(); return false;" title="Uservoice Feedback">Feedback</a></li>
		<li><a style="_width: 110px;" href="http://api.castleproject.org">API Doc</a></li>
		<li><a style="_width: 50px;" href="http://using.castleproject.org">Using</a></li>
		<li><a style="_width: 60px;" href="../../../../community/mailinglists.html">Mailing Lists</a></li>
		<li><a style="_width: 120px;" href="../../../../issuetracker.html">Issue Tracker</a></li>
		<li><a style="_width: 110px;" href="http://builds.castleproject.org">Builds</a></li>
	</ul>
  </div>
</div>



<div id="coolpage">

	<div id="sidebar" >
		
  <div class="lightmenu">
    <div class="lightmenucontent">
<span class="menutitle">
<a href="./../../../../monorail/index.html">MonoRail</a>
</span>
  <ul>
<li>
<a href="./../../../../monorail/gettingstarted/index.html">Getting started</a>
</li>
<li>
<a href="./../../../../monorail/faq.html">FAQ</a>
</li>
<li>
<a href="./../../../../monorail/recipes/index.html">Recipes</a>
</li>
<li>
<a href="./../../../../monorail/externalarticles.html">External Articles</a>
</li>
  </ul>
    </div>
  </div>
  <br/>
  <div class="lightmenu">
    <div class="lightmenucontent">
<span class="menutitle">
<a href="./../../../../monorail/documentation/trunk/index.html">Documentation</a>
</span>
  <ul>
<li>
<a href="./../../../../monorail/documentation/trunk/releasenotes/index.html">Release notes</a>
</li>
<li>
<a href="./../../../../monorail/documentation/trunk/manual/index.html">Reference Manual</a>
</li>
<li>
<a href="./../../../../monorail/documentation/trunk/usersguide/index.html">User's Guide</a>
</li>
<li>
<a href="./../../../../monorail/documentation/trunk/advanced/index.html">Advanced usage</a>
</li>
  </ul>
    </div>
  </div>
  <br/>
  <div class="darkmenu">
    <div class="darkmenucontent">
<span class="menutitle">
Navigation
</span>
  <ul>
<li>
<a href="./../../../../index.html">Back to Main Page</a>
</li>
  </ul>
    </div>
  </div>
  <br/>
	<br/>
	
	</div>
		
	<div id="content">
	
		<div class="callout-pic">

<!-- Begin Table of contents -->
<div id="toc">
<h2>Table of contents</h2>
<ul>
<li class='toclevel-1'><a href="#configuration"><span class="tocnumber">1</span> <span class="toctext">Configuration</span></a>
</li>
<li class='toclevel-1'><a href="#registeringRoute"><span class="tocnumber">2</span> <span class="toctext">Registering a Route</span></a>
<ul>
	<li class='toclevel-1'><a href="#restrictions"><span class="tocnumber">2.1</span> <span class="toctext">Restrictions</span></a>
</li>
</ul>
</li>
<li class='toclevel-1'><a href="#namedRoutes"><span class="tocnumber">3</span> <span class="toctext">Named Routes</span></a>
</li>
<li class='toclevel-1'><a href="#GeneratingURLs"><span class="tocnumber">4</span> <span class="toctext">Generating URLs</span></a>
</li>
<li class='toclevel-1'><a href="#OtherIntegration"><span class="tocnumber">5</span> <span class="toctext">Other Integration</span></a>
</li>
<li class='toclevel-1'><a href="#Gotchas"><span class="tocnumber">6</span> <span class="toctext">Gotchas</span></a>
<ul>
	<li class='toclevel-1'><a href="#ReservedExtensions"><span class="tocnumber">6.1</span> <span class="toctext">Reserved Extensions</span></a>
</li>
</ul>
</li>
<li class='toclevel-1'><a href="#AdvancedFeatures"><span class="tocnumber">7</span> <span class="toctext">Advanced Features</span></a>
</li>
<li class='toclevel-1'><a href="#UnitTestingRoutes"><span class="tocnumber">8</span> <span class="toctext">Unit Testing Routes</span></a>
</li>
<li class='toclevel-1'><a href="#KnownLimitations"><span class="tocnumber">9</span> <span class="toctext">Known Limitations</span></a>
<ul>
	<li class='toclevel-1'><a href="#DotsCouldbepresentinurlparts"><span class="tocnumber">9.1</span> <span class="toctext">Dots Could be present in url parts</span></a>
</li>
</ul>
</li>
</ul>
</div>
<!-- End Table of contents -->
		</div>

		<h1 class="firstHeading">
		    Routing
		</h1> 
	
<div class="breadcrumbs">
&raquo;
	<a href="./../../../../index.html">Home</a> 
&raquo;
	<a href="./../../../../monorail/index.html">MonoRail</a> 
&raquo;
	<a href="./../../../../monorail/documentation/index.html">Documentation</a> 
&raquo;
	<a href="./../../../../monorail/documentation/trunk/index.html">MonoRail trunk Documentation</a> 
&raquo;
	<a href="./../../../../monorail/documentation/trunk/advanced/index.html">Advanced usage</a> 
&raquo;
<u>Routing</u>
</div>

		<!-- start content -->
The new Routing engine provides a method of mapping arbitrary URLs to specified area/controller/action combinations. Parameters can be matched based on regular expressions, text or numerical values and a fluent API is provided for creating routing rules.<a name="configuration"></a>
  <h1>Configuration</h1>
<p>Simply add the following to your HttpModules section in web.config:</p>    <pre class="csharpcode">

<span class="kwrd">&lt;</span><span class="html">add</span> <span class="attr">name</span><span class="kwrd">="routing"</span> <span class="attr">type</span><span class="kwrd">="Castle.MonoRail.Framework.Routing.RoutingModuleEx, Castle.MonoRail.Framework"</span> <span class="kwrd">/&gt;</span>
</pre>
  <a name="registeringRoute"></a>
  <h1>Registering a Route</h1>
<p>RoutingModuleEx is the static class used for registering a route. Generally you'll want to set up your route in the Global.asax Application_Start, and here's an example of that to get us started:</p>    <pre class="csharpcode">

<span class="kwrd">public</span> <span class="kwrd">class</span> Global : HttpApplication
{
    <span class="kwrd">public</span> <span class="kwrd">void</span> Application_OnStart()
    {
        RoutingModuleEx.Engine.Add(
            <span class="kwrd">new</span> PatternRoute(<span class="str">"/&lt;controller&gt;/&lt;id&gt;/view.aspx"</span>)
                .DefaultForAction().Is(<span class="str">"view"</span>)
        );
    }
}
</pre>
  <p>In this case we are handling URLs which take the form /category/5/view.aspx or /product/2/view.aspx. The <controller> part of the PatternRoute constructor parameter indicates that we wish to capture that part of the URL and use it as the controller name. Similarly, the <id> part indicates that we want to capture a parameter called "id". We then register the action for this particular URL, in order to tell the routing engine which URL should be used as the default. Without this last step, it will not know which action to use.</p><a name="restrictions"></a>
  <h2>Restrictions</h2>
<p>In the above example, we're using integers for our ids. We can express this in the route:</p>    <pre class="csharpcode">

RoutingModuleEx.Engine.Add(
    <span class="kwrd">new</span> PatternRoute(<span class="str">"/&lt;controller&gt;/&lt;id&gt;/view.aspx"</span>)
        .DefaultForAction().Is(<span class="str">"view"</span>)
        .Restrict(<span class="str">"id"</span>).ValidInteger
);
</pre>
  <p>We've used the Restrict() method with the "id" parameter name and specified that only valid integers can be used here.</p><a name="namedRoutes"></a>
  <h1>Named Routes</h1>
<p>In previous examples we have accessed routes by supplying controller, action and parameter data to trigger a match with a registered route. There is a shortcut to this: named routes. By registering a route with an identifier, we can refer to it more easily:</p>    <pre class="csharpcode">

RoutingModuleEx.Engine.Add(<span class="str">"adminhome"</span>,
    <span class="kwrd">new</span> PatternRoute(<span class="str">"/admin/home/index.aspx"</span>)
        .DefaultForAction().Is(<span class="str">"view"</span>)
);
</pre>
  <p>And here's a before and after look at how we refer to this route:</p>    <pre class="csharpcode">

$Url.Link('Admin Home', "%{area='admin', controller='home', action='index'}")
    ...
$Url.Link('Admin Home', "%{named='adminhome'}")
</pre>
  <p>This is a little more concise and it also enables a URL shorthand for template developers.</p><a name="GeneratingURLs"></a>
  <h1>Generating URLs</h1>
<p>The default URL building services within Monorail are fully routing aware. Given the rule:</p>    <pre class="csharpcode">
RoutingModuleEx.Engine.Add(
    <span class="kwrd">new</span> PatternRoute(<span class="str">"/&lt;controller&gt;/&lt;id&gt;/view.aspx"</span>)
        .DefaultForAction().Is(<span class="str">"view"</span>)
);
</pre>
  <p>We can use the following NVelocity template code to generate a URL:</p>    <pre class="csharpcode">
$Url.Link('Product Name', "%{controller='product', action='list', params={id=15}}")</pre>
  <p>This will produce:</p>    <pre class="csharpcode">
/product/15/list.aspx</pre>
  <p>We can add further parameters into the URL:</p>    <pre class="csharpcode">

RoutingModuleEx.Engine.Add(
    <span class="kwrd">new</span> PatternRoute(<span class="str">"/&lt;controller&gt;/&lt;name&gt;/&lt;id&gt;/view.aspx"</span>)
        .DefaultForAction().Is(<span class="str">"view"</span>)
        .Restrict(<span class="str">"id"</span>).ValidInteger
);
</pre>
  <p>Now template code like this:</p>    <pre class="csharpcode">

$Url.Link('Product Name', "%{controller='product', action='view', params={id=15, name='ProductName'}}")
</pre>
  <p>This will produce:</p>    <pre class="csharpcode">

/product/ProductName/15/list.aspx
</pre>
  <a name="OtherIntegration"></a>
  <h1>Other Integration</h1>
<p>Any part of Monorail which uses the DefaultUrlBulder service will automatically be aware of your routes - so helpers and redirections will work as expected with no adjustments:</p>    <pre class="csharpcode">

$Form.FormTag("%{named='login'}") ## generate an opening form tag with the action attribute populated with the URL for the "login" named route
...
RedirectUsingNamedRoute("adminhome") // Redirect to the URL for the named route "adminhome"
</pre>
  <a name="Gotchas"></a>
  <h1>Gotchas</h1>
<p>There are a couple of scenarios in which solutions aren't immediately clear:</p><a name="ReservedExtensions"></a>
  <h2>Reserved Extensions</h2>
<ul><li>On Windows, if the extension is equal to a DOS 1.0 legacy reserved filename (aux, con, com, lpt, etc) it will not match</li><li>If the extension is equal to an asp.net forbidden extension (.cs, .java, .asax, etc ) it will not match</li></ul><a name="AdvancedFeatures"></a>
  <h1>Advanced Features</h1>
<p>ForDomain and ForSubDomain are methods on RoutingEngine which are yet to be implemented but should provide support for per-domain and per-subdomain routes. This may be useful in multi-tenanted applications. AddFirst is available on RoutingEngine and allows a routing rule to be inserted as the first rule to be considered. Due to the way in which ordering of rules is important within the routing system, this can be used to "prioritize" particular rules.</p><a name="UnitTestingRoutes"></a>
  <h1>Unit Testing Routes</h1>
<p>The routing engine can be isolated and tested stand-alone by using the RouteMatch class:</p>    <pre class="csharpcode">

[Test]
<span class="kwrd">public</span> <span class="kwrd">void</span> CatchAllRouteTest() {
    PatternRoute route = <span class="kwrd">new</span> PatternRoute(<span class="str">"/&lt;controller&gt;/&lt;id&gt;/&lt;action&gt;.aspx"</span>);

    RouteMatch match = <span class="kwrd">new</span> RouteMatch();

    Assert.IsTrue(route.Matches(<span class="str">"/product/123/index.aspx"</span>, <span class="kwrd">new</span> RouteContext(<span class="kwrd">new</span> StubRequest(<span class="str">"GET"</span>), <span class="kwrd">null</span>, <span class="str">"/"</span>, <span class="kwrd">new</span> Hashtable(), match) &gt; 0);
    Assert.AreEqual(<span class="str">"product"</span>, match.Parameters[<span class="str">"controller"</span>]);
    Assert.AreEqual(<span class="str">"123"</span>, match.Parameters[<span class="str">"id"</span>]);
    Assert.AreEqual(<span class="str">"index"</span>, match.Parameters[<span class="str">"action"</span>]);
}
</pre>
  <a name="KnownLimitations"></a>
  <h1>Known Limitations</h1>
<p>We are aware of a few situations in which the behavior of the routing engine is non-optimal.</p><a name="DotsCouldbepresentinurlparts"></a>
  <h2>Dots Could be present in url parts</h2>
<p>But a work-around has to be implemented, see <a href="http://using.castleproject.org/display/MR/Routing+tips" title="Routing tips" >Routing tips</a> for a working solution</p>		<!-- end content -->
		
	<div id="footer">
<script type="text/javascript"><!--
google_ad_client = "pub-2091974950947714";
/* 728x90, created 2/13/08 */
google_ad_slot = "5378217716";
google_ad_width = 728;
google_ad_height = 90;
//-->
</script>
<script type="text/javascript"
src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
	
	<br/>
	Found an error? Something inaccurate? 
	<a href="../../../../community/getinvolved.html">Help us improve the documentation</a> <br/>
	Generated by <a href="../../../../others/anakia/index.html">Castle Anakia</a>. 
	
	<p>&nbsp;</p>
	
	<p>
	Sponsored by <img src="../../../../images/logothumb.gif" /> <a href="http://www.castlestronghold.com">Castle Stronghold</a>.
	</p>
	
	</div>

	<!-- Search Google -->
<center>
<FORM method=GET action="http://www.google.com/custom">
<TABLE bgcolor="#FFFFFF" cellspacing="4" border="0" style="border: solid 1px gray;" align="center">
<tr valign=top><td>
<A HREF="http://www.google.com/search">
<IMG SRC="http://www.google.com/logos/Logo_40wht.gif" border=0 ALT=Google align=middle></A>
</td>
<td>
<INPUT TYPE=text name=q size=31 maxlength=255 value="">
<INPUT type=submit name=sa VALUE="Google Search">
<INPUT type=hidden name=cof VALUE="S:http://www.castlestronghold.com;GL:1;VLC:#373737;AH:center;LH:63;LC:#0A50A1;GFNT:#5B5B5B;L:http://www.castleproject.org/images/castle-logo.gif;ALC:#0A50A1;BIMG:http://www.castleproject.org/images/bg.png;LW:280;T:#5B5B5B;AWFID:3d565acacdd9f388;">
<input type=hidden name=domains value="castleproject.org"><br><input type=radio name=sitesearch value=""> Search WWW <input type=radio name=sitesearch value="castleproject.org" checked> Search castleproject.org
</td></tr></TABLE>
</FORM>
<!-- Search Google -->
</center>
	&nbsp;
	<br/>

		</div> <!-- end of content -->
  </div><!-- end of page -->
  


	<script type="text/javascript">_uacct = "UA-1190612-1";urchinTracker();</script>
	<script type="text/javascript">
		var uservoiceJsHost = ("https:" == document.location.protocol) ? "https://uservoice.com" : "http://cdn.uservoice.com";
		document.write(unescape("%3Cscript src='" + uservoiceJsHost + "/javascripts/widgets/tab.js' type='text/javascript'%3E%3C/script%3E"))
	</script>
	<script type="text/javascript">
		UserVoice.Popin.setup({ 
			key: 'castle',
			alignment: 'right',
			host: 'castle.uservoice.com', 
			forum: 'general', 
			lang: 'en'
		})
	</script>
	</body>
</html>
