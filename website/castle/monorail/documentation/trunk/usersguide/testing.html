<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">









<html>
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1"/>
		<title>Unit testing :: Castle Project</title>
		<link rel="stylesheet" href="../../../../base.css" />
		<link rel="stylesheet" href="../../../../elem.css" />
		<link rel="stylesheet" href="../../../../csharp.css" />
		<link rel="stylesheet" href="../../../../TAB_styles.css" />
		<script language="javascript" src="../../../../mktree.js"></script>
		<script type="text/javascript" src="../../../../TAB_Function_Lib.js"></script>
	</head>

	<body>

<div id="container">

  <div id="topbuttonscontainer"></div>

  <div id="maintitle">
    <h1> <a href="/" title="Home" accesskey="1">Home</a> </h1>
  </div>

  <div id="mainbar">
    <div id="mainbarleft"><div id="mainbarright"></div></div>
  </div>
  
  <div id="page">
		<div id="sidebar" >
  <div class="lightmenu">
    <div class="lightmenucontent">
<span class="menutitle">
<a href="./../../../../monorail/index.html">MonoRail</a>
</span>
  <ul>
<li>
<a href="./../../../../monorail/gettingstarted/index.html">Getting started</a>
</li>
<li>
<a href="./../../../../monorail/faq.html">FAQ</a>
</li>
<li>
<a href="./../../../../monorail/recipes/index.html">Recipes</a>
</li>
<li>
<a href="./../../../../monorail/externalarticles.html">External Articles</a>
</li>
  </ul>
    </div>
  </div>
  <br/>
  <div class="lightmenu">
    <div class="lightmenucontent">
<span class="menutitle">
<a href="./../../../../monorail/documentation/trunk/index.html">Documentation</a>
</span>
  <ul>
<li>
<a href="./../../../../monorail/documentation/trunk/releasenotes/index.html">Release notes</a>
</li>
<li>
<a href="./../../../../monorail/documentation/trunk/manual/index.html">Reference Manual</a>
</li>
<li>
<a href="./../../../../monorail/documentation/trunk/usersguide/index.html">User's Guide</a>
</li>
<li>
<a href="./../../../../monorail/documentation/trunk/advanced/index.html">Advanced usage</a>
</li>
  </ul>
    </div>
  </div>
  <br/>
  <div class="darkmenu">
    <div class="darkmenucontent">
<span class="menutitle">
Navigation
</span>
  <ul>
<li>
<a href="./../../../../index.html">Back to Main Page</a>
</li>
  </ul>
    </div>
  </div>
  <br/>
			<br/>
		</div>
		
		<div id="content">
		<div class="callout-pic">

<!-- Begin Table of contents -->
<!-- End Table of contents -->
		
		</div>

		<h1 class="firstHeading">
		    Unit testing
		</h1> 
	
<div class="breadcrumbs">
&raquo;
	<a href="./../../../../index.html">Main Page</a> 
&raquo;
	<a href="./../../../../monorail/index.html">MonoRail</a> 
&raquo;
	<a href="./../../../../monorail/documentation/index.html">Documentation</a> 
&raquo;
	<a href="./../../../../monorail/documentation/trunk/index.html">MonoRail RC2 Documentation</a> 
&raquo;
	<a href="./../../../../monorail/documentation/trunk/usersguide/index.html">User's Guide</a> 
&raquo;
<u>Unit testing</u>
</div>

		<!-- start content -->


TODO sample

= Introduction =

This How To explains how to write test cases with NUnit for a web project using MonoRail.

{{ToTopicPage|MonoRail}}
[[Category:MonoRail:Documentation:How to]]

= Castle.MonoRail.TestSupport =

Castle.MonoRail.TestSupport was created to enable easy testing of MonoRail projects. It uses the ASP.Net runtime to create mock requests and asserts the response. It also exposes the PropertyBag, Flash and Session dictionaries so you can assert their contents as well.

In order to use the ASP.Net runtime, '''the assembly Castle.MonoRail.TestSupport.dll must be registered in the GAC''':

  <pre class="commonpre">
&gt; gacutil /i Castle.MonoRail.TestSupport
</pre>


== Simple recipe ==

# Create a Class Library project (usually you're going to use the same solution of the web project)
# Add references to 
#* nunit.framework
#* Castle.MonoRail.Framework
#* Castle.MonoRail.TestSupport
# Create test cases class extending AbstractMRTestCase
# Then expose the web application folder to AbstractMRTestCase, you can do it in two ways
#* Create a configuration file to associate with the AppDomain, or
#* Simply override the method GetPhysicalDir (more about these later)
# Finally use the Assert family of methods exposed by AbstractMRTestCase

=== A simple example from MonoRail test case ===

The following class is a snippet of one of the MonoRail test cases:

  <pre class="commonpre"><nowiki>
[TestFixture]
public class BasicFunctionalityTestCase : AbstractMRTestCase
{
    [Test]
    public void SimpleControllerAction()
    {
        DoGet("home/index.rails");

        AssertSuccess();

        AssertReplyEqualsTo( "My View contents for Home\\Index" );
    }

    [Test]
    public void Flash()
    {
        DoGet("home/flash1.rails");

        AssertSuccess();

        AssertFlashEntryEquals("errormessage", "Some error");
    }

    [Test]
    public void Redirect()
    {
        DoGet("home/redirectAction.rails");

        AssertSuccess();

        AssertRedirectedTo( "/home/index.rails" );
    }

    [Test]
    public void PropertyBag()
    {
        DoGet("home/bag.rails");

        AssertSuccess();

        AssertPropertyBagContains( "CustomerName" );
        AssertPropertyBagEntryEquals( "CustomerName", "hammett" );
        AssertReplyEqualsTo( "\r\nCustomer is hammett\r\n<br />\r\n123" );
    }

    [Test]
    public void CreateCookie()
    {
        DoGet("cookies/addcookie.rails");

        AssertSuccess();

        AssertReplyEqualsTo( @"My View contents for Cookies\Index" );

        Assert.AreEqual( 2, Response.Cookies.Count );

        AssertHasCookie( "cookiename" );
        AssertHasCookie( "cookiename2" );
        AssertCookieValueEqualsTo( "cookiename", "value" );
        AssertCookieValueEqualsTo( "cookiename2", "value2" );
    }

    [Test]
    public void CreateCookieExpiration()
    {
        DoGet("cookies/AddCookieExpiration.rails");

        AssertSuccess();

        AssertReplyEqualsTo(@"My View contents for Cookies\Index");

        DateTime twoWeeks = DateTime.Now.Add(new TimeSpan(14, 0, 0, 0));

        AssertCookieExpirationEqualsTo("cookiename2", twoWeeks);
        AssertCookieValueEqualsTo("cookiename2", "value");
    }
}
</nowiki></pre>


== Exposing the web site application directory ==

As we use the ASP.Net runtime to execute your application, we must know the full absolute path for the web application. In the case you're confused, web application is the one with the web.config and global.asax, not the bin directory.

=== Overriding GetPhysicalDir ===

When overriding the GetPhysicalDir you must return the path to the web application:

  <pre class="commonpre">
[TestFixture]
public class AccountControllerTestCase : AbstractMRTestCase
{
    ...

    protected override String GetPhysicalDir()
    {
        return "../mywebapp";
    }
}
</pre>


If you return a relative path, it is going to be converted based on the executing directory, i.e. the ApplicationBase.

=== External configuration ===

Another option is to create a configuration file to your test case project. The content might be something like the following:

'''App.config'''
  <pre class="commonpre"><![CDATA[
<?xml version="1.0" encoding="utf-8" ?>
<configuration>
    <appSettings>
        <add key="web.physical.dir" value="..\TestSite" />
        <add key="web.virtual.dir" value="/" />
    </appSettings>
</configuration>
]]></pre>


'''''You should not need to override the virtual directory setting in most circumstances.'''''

'''Visual Studio 2003 hint''': I usually create an App.config file and a post build event to create the right file:

  <pre class="commonpre">
Post build event command line: copy $(ProjectDir)\App.config $(TargetPath).config
</pre>


== AbstractMRTestCase Quick Reference ==

The AbstractMRTestCase class exposes properties and methods to easy the burden of writing test cases for web projects. The following sections depicts some of them.

=== Action methods ===

* '''DoGet(String path, params String[] queryStringParams)''' <br></br> Use DoGet to send a GET verb to your web application. For example: DoGet("home/index.rails")
  
* '''DoPost(String path, params String[] queryStringParams)''' <br></br> Use DoPost to send a POST verb to your web application. For example: DoPost("account/save.rails", "name=johndoe", "age=30")

=== Properties ===

* '''Request''' <br></br> Use the Request to add more information before invoking DoGet/DoPost

* '''Response''' <br></br> The Response is only available after a DoGet/DoPost, and you can use to gather details about the response.

=== Assertions ===

* '''AssertSuccess''' <br></br> Asserts the status code is less than 400

==== Returned content ====

The following methods can be used to assert the reply content:

* '''AssertReplyEqualsTo'''
* '''AssertReplyStartsWith'''
* '''AssertReplyEndsWith'''
* '''AssertReplyContains'''
* '''AssertReplyDoNotContain'''

==== Redirects ====

* '''AssertRedirectedTo'''

==== Headers ====

* '''AssertHasHeader'''
* '''AssertContentTypeEqualsTo'''
* '''AssertContentTypeStartsWith'''
* '''AssertContentTypeEndsWith'''

==== PropertyBag/Flash/Session ====

* '''AssertPropertyBagContains'''
* '''AssertPropertyBagEntryEquals'''
* '''AssertSessionContains'''
* '''AssertSessionEntryEquals'''
* '''AssertFlashContains'''
* '''AssertFlashEntryEquals'''

==== Cookies ====

* '''AssertHasCookie'''
* '''AssertCookieValueEqualsTo'''
* '''AssertCookieExpirationEqualsTo'''

__NOTOC__

		<!-- end content -->
		
	<div id="footer">

	Found an error? Something inaccurate? <a href="">Help us improve the documentation</a> <br/>
	Generated by <a href="">Castle Anakia</a>

	</div>

	&nbsp;
	<br/>

		</div> <!-- end of content -->
  </div><!-- end of page -->
  
</div>

	</body>
</html>
