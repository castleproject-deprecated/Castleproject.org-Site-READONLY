<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">









<html>
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1"/>
		<title>Filters :: Castle Project</title>
		<link rel="stylesheet" href="../../../../base.css" />
		<link rel="stylesheet" href="../../../../front.css" />
		<link rel="stylesheet" href="../../../../elem.css" />
		<link rel="stylesheet" href="../../../../csharp.css" />
		<link rel="stylesheet" href="../../../../TAB_styles.css" />
		<script type="text/javascript" src="../../../../mktree.js"></script>
		<script type="text/javascript" src="../../../../TAB_Function_Lib.js"></script>
		<script src="http://www.google-analytics.com/urchin.js" type="text/javascript"></script>
	</head>

	<body>
<div id="topheader">
  <div id="maintitle">
	<h1> <a href="../../../../index.html" title="Castle Project Home" accesskey="1">Home</a> </h1>
	<h2> <a href="http://www.castlestronghold.com" title="Castle Stronghold: support, consulting and development">Castle Stronghold</a> </h2>
  </div>
  <div id="mainbar">
	<ul id="toplinks">
		<li>&nbsp;</li>
		<li><a style="_width: 70px;" href="../../../../index.html">Home</a></li>
		<li><a style="_width: 70px;" href="../../../../castle/download.html">Download</a></li>
		<li><a style="_width: 110px;" href="http://api.castleproject.org">API Doc</a></li>
		<li><a style="_width: 50px;" href="http://using.castleproject.org">Using</a></li>
		<li><a style="_width: 60px;" href="../../../../community/forum.html">Forum</a></li>
		<li><a style="_width: 120px;" href="../../../../jira.html">Jira/Issue tracker</a></li>
		<li><a style="_width: 110px;" href="http://builds.castleproject.org">Builds</a></li>
	</ul>
  </div>
</div>



<div id="coolpage">

	<div id="sidebar" >
		
  <div class="lightmenu">
    <div class="lightmenucontent">
<span class="menutitle">
<a href="./../../../../monorail/index.html">MonoRail</a>
</span>
  <ul>
<li>
<a href="./../../../../monorail/gettingstarted/index.html">Getting started</a>
</li>
<li>
<a href="./../../../../monorail/faq.html">FAQ</a>
</li>
<li>
<a href="./../../../../monorail/recipes/index.html">Recipes</a>
</li>
<li>
<a href="./../../../../monorail/externalarticles.html">External Articles</a>
</li>
  </ul>
    </div>
  </div>
  <br/>
  <div class="lightmenu">
    <div class="lightmenucontent">
<span class="menutitle">
<a href="./../../../../monorail/documentation/trunk/index.html">Documentation</a>
</span>
  <ul>
<li>
<a href="./../../../../monorail/documentation/trunk/releasenotes/index.html">Release notes</a>
</li>
<li>
<a href="./../../../../monorail/documentation/trunk/manual/index.html">Reference Manual</a>
</li>
<li>
<a href="./../../../../monorail/documentation/trunk/usersguide/index.html">User's Guide</a>
</li>
<li>
<a href="./../../../../monorail/documentation/trunk/advanced/index.html">Advanced usage</a>
</li>
  </ul>
    </div>
  </div>
  <br/>
  <div class="darkmenu">
    <div class="darkmenucontent">
<span class="menutitle">
Navigation
</span>
  <ul>
<li>
<a href="./../../../../index.html">Back to Main Page</a>
</li>
  </ul>
    </div>
  </div>
  <br/>
	<br/>
	
	</div>
		
	<div id="content">
	
		<div class="callout-pic">

<!-- Begin Table of contents -->
<div id="toc">
<h2>Table of contents</h2>
<ul>
<li class='toclevel-1'><a href="#creating"><span class="tocnumber">1</span> <span class="toctext">Creating a filter</span></a>
</li>
<li class='toclevel-1'><a href="#ordering"><span class="tocnumber">2</span> <span class="toctext">Ordering</span></a>
</li>
<li class='toclevel-1'><a href="#skipping"><span class="tocnumber">3</span> <span class="toctext">Skipping filters</span></a>
</li>
<li class='toclevel-1'><a href="#accessingparams"><span class="tocnumber">4</span> <span class="toctext">Giving parameters to the filters</span></a>
</li>
</ul>
</div>
<!-- End Table of contents -->
		</div>

		<h1 class="firstHeading">
		    Filters
		</h1> 
	
<div class="breadcrumbs">
&raquo;
	<a href="./../../../../index.html">Home</a> 
&raquo;
	<a href="./../../../../monorail/index.html">MonoRail</a> 
&raquo;
	<a href="./../../../../monorail/documentation/index.html">Documentation</a> 
&raquo;
	<a href="./../../../../monorail/documentation/trunk/index.html">MonoRail trunk Documentation</a> 
&raquo;
	<a href="./../../../../monorail/documentation/trunk/usersguide/index.html">User's Guide</a> 
&raquo;
<u>Filters</u>
</div>

		<!-- start content -->
<p>
Filters are executed before and|or after your actions. 
It is useful for security, dynamic content and to keep away repetitive code.
</p><a name="creating"></a>
  <h1>Creating a filter</h1>
<p>
	To create a filter, create a class that implements the <tt>IFilter</tt> interface, 
	then associate the filter with your controller.
	</p>  <div class="note">
<div class="notetopbg">
<div class="noteborderleft">
<div class="noteborderright">
<div class="notetopleft">
<div class="notetopright">
<div class="notebottomleft">
<div class="notebottomright">
<div class="boxtitle">Quick Note</div>
<div class="innercontent">
<p>
	You can always create an abstract controller class and associate a filter with it and make your controllers extend it.
	</p>
</div></div></div></div></div></div></div></div></div>
    <pre class="csharpcode">

<span class="kwrd">using</span> Castle.MonoRail.Framework;

<span class="kwrd">public</span> <span class="kwrd">class</span> AuthenticationFilter : IFilter
{
    <span class="kwrd">public</span> <span class="kwrd">bool</span> Perform(ExecuteEnum exec, IRailsEngineContext context, Controller controller)
    {
        <span class="kwrd">if</span> (context.Session.Contains(<span class="str">"user"</span>))
        {
            <span class="kwrd">return</span> <span class="kwrd">true</span>;
        }
        <span class="kwrd">else</span>
        {
            context.Response.Redirect(<span class="str">"account"</span>, <span class="str">"login"</span>);
        }

        <span class="kwrd">return</span> <span class="kwrd">false</span>;
    }
}</pre>
  <p>
	The <tt>Perform</tt> return value indicates to the framework
	if the process should be ended. If you return <tt>false</tt> 
	no further process will happen for the current request.
	It is important that you take some action before, like in the 
	example above, issuing a redirect.
	</p><p>
	The <tt>ExecuteEnum</tt> parameter says to the filter 
	what is the context of the invocation. It is also used on the 
	<tt>FilterAttribute</tt> to define when you want to have 
	the filter executed. The possible values are listed on the table
	below.
	</p><p><table class="commontable" ><tr><th><tt>ExecuteEnum</tt> fields</th><th>Description</th></tr><tr><td><tt>BeforeAction</tt></td><td> The filter is invoked before the action.</td></tr><tr><td><tt>AfterAction</tt></td><td>The filter is invoked after the action.</td></tr><tr><td><tt>AfterRendering</tt></td><td>The filter is invoked after the rendering.</td></tr><tr><td><tt>Always</tt></td><td>The filter is invoked around all steps.</td></tr></table></p><p>
	To associate the filter with the controller, use the 
	<tt>FilterAttribute</tt>:
	</p>    <pre class="csharpcode">

<span class="kwrd">using</span> Castle.MonoRail.Framework;

[FilterAttribute(ExecuteEnum.BeforeAction, <span class="kwrd">typeof</span>(AuthenticationFilter))]
<span class="kwrd">public</span> <span class="kwrd">class</span> AdminController : Controller
{
    <span class="kwrd">public</span> <span class="kwrd">void</span> Index()
    {
    }
}</pre>
  <a name="ordering"></a>
  <h1>Ordering</h1>
<p>
	You can always associate more than one filter with a controller. 
	However the order of execution cannot be guaranted. If the order
	of execution is important, use the <tt>ExecutionOrder</tt> property.
	The lower the value, the higher is the priority. For example:
	</p>    <pre class="csharpcode">

<span class="kwrd">using</span> Castle.MonoRail.Framework;

[FilterAttribute(ExecuteEnum.BeforeAction, <span class="kwrd">typeof</span>(AuthenticationFilter), ExecutionOrder=0)]
[FilterAttribute(ExecuteEnum.BeforeAction, <span class="kwrd">typeof</span>(LocalizationFilter), ExecutionOrder=1)]
<span class="kwrd">public</span> <span class="kwrd">class</span> AdminController : Controller
{
    <span class="kwrd">public</span> <span class="kwrd">void</span> Index()
    {
    }
}</pre>
  <p>
	For the example above, <tt>AuthenticationFilter</tt> runs before the
	<tt>LocalizationFilter</tt>.
	</p><a name="skipping"></a>
  <h1>Skipping filters</h1>
<p>
	For some situation you may not want to execute a filter, or all filter, 
	for one or more actions. Use the <tt>SkipFilterAttribute</tt> for those cases.
	For example:
	</p>    <pre class="csharpcode">

<span class="kwrd">using</span> Castle.MonoRail.Framework;

[FilterAttribute(ExecuteEnum.BeforeAction, <span class="kwrd">typeof</span>(AuthenticationFilter), ExecutionOrder=0)]
[FilterAttribute(ExecuteEnum.BeforeAction, <span class="kwrd">typeof</span>(LocalizationFilter), ExecutionOrder=1)]
<span class="kwrd">public</span> <span class="kwrd">class</span> AdminController : Controller
{
    [SkipFilter]
    <span class="kwrd">public</span> <span class="kwrd">void</span> Index()
    {
    }

    [SkipFilter(<span class="kwrd">typeof</span>(LocalizationFilter))]
    <span class="kwrd">public</span> <span class="kwrd">void</span> Create()
    {
    }

    <span class="kwrd">public</span> <span class="kwrd">void</span> Update()
    {
    }
}</pre>
  <p>
	For the example above we have defined that:
	<ul><li>No filters will be executed on the <tt>Index</tt> action</li><li>The <tt>LocalizationFilter</tt> will not be executed on the <tt>Create</tt> action</li><li>All filters will run on the <tt>Update</tt> action</li></ul></p><a name="accessingparams"></a>
  <h1>Giving parameters to the filters</h1>
<p>
	More advanced scenarios might arise where you parameterize a filter.
	For example, you can create a filter that is able to load text files 
	and add each line of text to the <tt>PropertyBag</tt>. The file name
	is not fixed. 
	</p><p>
	The first thing to do is to create a new attribute that extends
	<tt>FilterAttribute</tt>:
	</p>    <pre class="csharpcode">

<span class="kwrd">using</span> Castle.MonoRail.Framework;

[AttributeUsage(AttributeTargets.Class, AllowMultiple=<span class="kwrd">false</span>, Inherited=<span class="kwrd">true</span>), Serializable]
<span class="kwrd">public</span> <span class="kwrd">class</span> MyCoolFilterAttribute : FilterAttribute
{
    <span class="kwrd">private</span> <span class="kwrd">readonly</span> <span class="kwrd">string</span> fileName;

    <span class="kwrd">public</span> MyCoolFilterAttribute(String fileName) : <span class="kwrd">base</span>(ExecuteEnum.BeforeAction, <span class="kwrd">typeof</span>(CoolFilterImpl))
    {
        <span class="kwrd">this</span>.fileName = fileName;
    }
    
    <span class="kwrd">public</span> <span class="kwrd">string</span> FileName
    {
        get { <span class="kwrd">return</span> fileName; }
    }
}</pre>
  <p>
	As you can see, the custom attribute inherits from <tt>FilterAttribute</tt>
	and configures the filter on the user's behalf.
	</p><p>
	Now we just need to implement the filter itselt. We also 
	need to signalize to the framework that we are interested in
	gaining access to the attribute instance as we will extract information
	from it.
	This is done using the <tt>IFilterAttributeAware</tt> interface.
	</p>    <pre class="csharpcode">

<span class="kwrd">using</span> Castle.MonoRail.Framework;

<span class="kwrd">public</span> <span class="kwrd">class</span> CoolFilterImpl : IFilter, IFilterAttributeAware
{
    <span class="kwrd">private</span> MyCoolFilterAttribute attribute;

    <span class="rem">// Implementation of IFilterAttributeAware</span>
    <span class="kwrd">public</span> FilterAttribute Filter 
    { 
        set { attribute = (MyCoolFilterAttribute) <span class="kwrd">value</span>; } 
    }
    
    <span class="rem">// Implementation of IFilter</span>
    <span class="kwrd">public</span> <span class="kwrd">bool</span> Perform(ExecuteEnum exec, IRailsEngineContext context, Controller controller)
    {
        <span class="rem">// Now you can access the parameters:</span>
        String fileName = attribute.FileName; 
        
        <span class="rem">// Work</span>
        
        <span class="rem">// Allow the process to go on</span>
        <span class="kwrd">return</span> <span class="kwrd">true</span>;
    }
}</pre>
  <p>
	Now using the filter is very simple:
	</p>    <pre class="csharpcode">

<span class="kwrd">using</span> Castle.MonoRail.Framework;

[MyCoolFilterAttribute(<span class="str">"customer_messages.txt"</span>)]
<span class="kwrd">public</span> <span class="kwrd">class</span> CustomerController : Controller
{
    <span class="kwrd">public</span> <span class="kwrd">void</span> Index()
    {
    }
}</pre>
  		<!-- end content -->

<script type="text/javascript"><!--
google_ad_client = "pub-2091974950947714";
/* 728x90, created 2/13/08 */
google_ad_slot = "5378217716";
google_ad_width = 728;
google_ad_height = 90;
//-->
</script>
<script type="text/javascript"
src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
		
	<div id="footer">
	Found an error? Something inaccurate? 
	<a href="../../../../community/getinvolved.html">Help us improve the documentation</a> <br/>
	Generated by <a href="../../../../others/anakia/index.html">Castle Anakia</a>. 
	
	<p>&nbsp;</p>
	
	<p>
	Sponsored by <img src="../../../../images/logothumb.gif" /> <a href="http://www.castlestronghold.com">Castle Stronghold</a>.
	</p>
	
	</div>

	<!-- Search Google -->
<center>
<FORM method=GET action="http://www.google.com/custom">
<TABLE bgcolor="#FFFFFF" cellspacing="4" border="0" style="border: solid 1px gray;" align="center">
<tr valign=top><td>
<A HREF="http://www.google.com/search">
<IMG SRC="http://www.google.com/logos/Logo_40wht.gif" border=0 ALT=Google align=middle></A>
</td>
<td>
<INPUT TYPE=text name=q size=31 maxlength=255 value="">
<INPUT type=submit name=sa VALUE="Google Search">
<INPUT type=hidden name=cof VALUE="S:http://www.castlestronghold.com;GL:1;VLC:#373737;AH:center;LH:63;LC:#0A50A1;GFNT:#5B5B5B;L:http://www.castleproject.org/images/castle-logo.gif;ALC:#0A50A1;BIMG:http://www.castleproject.org/images/bg.png;LW:280;T:#5B5B5B;AWFID:3d565acacdd9f388;">
<input type=hidden name=domains value="castleproject.org"><br><input type=radio name=sitesearch value=""> Search WWW <input type=radio name=sitesearch value="castleproject.org" checked> Search castleproject.org
</td></tr></TABLE>
</FORM>
<!-- Search Google -->
</center>
	&nbsp;
	<br/>

		</div> <!-- end of content -->
  </div><!-- end of page -->
  


	<script type="text/javascript">_uacct = "UA-1190612-1";urchinTracker();</script>
	</body>
</html>
