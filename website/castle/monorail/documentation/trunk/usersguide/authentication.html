<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">









<html>
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1"/>
		<title>Authentication and Authorization :: Castle Project</title>
		<link rel="stylesheet" href="../../../../base.css" />
		<link rel="stylesheet" href="../../../../front.css" />
		<link rel="stylesheet" href="../../../../elem.css" />
		<link rel="stylesheet" href="../../../../csharp.css" />
		<link rel="stylesheet" href="../../../../TAB_styles.css" />
		<script type="text/javascript" src="../../../../mktree.js"></script>
		<script type="text/javascript" src="../../../../TAB_Function_Lib.js"></script>
		<script src="http://www.google-analytics.com/urchin.js" type="text/javascript"></script>
	</head>

	<body>
<div id="topheader">
  <div id="maintitle">
	<h1> <a href="../../../../index.html" title="Castle Project Home" accesskey="1">Home</a> </h1>
	<h2> <a href="http://www.castlestronghold.com" title="Castle Stronghold: support, consulting and development">Castle Stronghold</a> </h2>
  </div>
  <div id="mainbar">
	<ul id="toplinks">
		<li>&nbsp;</li>
		<li><a style="_width: 70px;" href="../../../../index.html">Home</a></li>
		<li><a style="_width: 70px;" href="../../../../castle/projects.html">Projects</a></li>
		<li><a style="_width: 70px;" href="../../../../castle/download.html">Downloads</a></li>
		<li><a href="#" onclick="UserVoice.Popin.show(); return false;" title="Uservoice Feedback">Feedback</a></li>
		<li><a style="_width: 110px;" href="http://api.castleproject.org">API Doc</a></li>
		<li><a style="_width: 50px;" href="http://using.castleproject.org">Using</a></li>
		<li><a style="_width: 60px;" href="../../../../community/mailinglists.html">Mailing Lists</a></li>
		<li><a style="_width: 120px;" href="../../../../issuetracker.html">Issue Tracker</a></li>
		<li><a style="_width: 110px;" href="http://builds.castleproject.org">Builds</a></li>
	</ul>
  </div>
</div>



<div id="coolpage">

	<div id="sidebar" >
		
  <div class="lightmenu">
    <div class="lightmenucontent">
<span class="menutitle">
<a href="./../../../../monorail/index.html">MonoRail</a>
</span>
  <ul>
<li>
<a href="./../../../../monorail/gettingstarted/index.html">Getting started</a>
</li>
<li>
<a href="./../../../../monorail/faq.html">FAQ</a>
</li>
<li>
<a href="./../../../../monorail/recipes/index.html">Recipes</a>
</li>
<li>
<a href="./../../../../monorail/externalarticles.html">External Articles</a>
</li>
  </ul>
    </div>
  </div>
  <br/>
  <div class="lightmenu">
    <div class="lightmenucontent">
<span class="menutitle">
<a href="./../../../../monorail/documentation/trunk/index.html">Documentation</a>
</span>
  <ul>
<li>
<a href="./../../../../monorail/documentation/trunk/releasenotes/index.html">Release notes</a>
</li>
<li>
<a href="./../../../../monorail/documentation/trunk/manual/index.html">Reference Manual</a>
</li>
<li>
<a href="./../../../../monorail/documentation/trunk/usersguide/index.html">User's Guide</a>
</li>
<li>
<a href="./../../../../monorail/documentation/trunk/advanced/index.html">Advanced usage</a>
</li>
  </ul>
    </div>
  </div>
  <br/>
  <div class="darkmenu">
    <div class="darkmenucontent">
<span class="menutitle">
Navigation
</span>
  <ul>
<li>
<a href="./../../../../index.html">Back to Main Page</a>
</li>
  </ul>
    </div>
  </div>
  <br/>
	<br/>
	
	</div>
		
	<div id="content">
	
		<div class="callout-pic">

<!-- Begin Table of contents -->
<div id="toc">
<h2>Table of contents</h2>
<ul>
<li class='toclevel-1'><a href="#formsauthentication"><span class="tocnumber">1</span> <span class="toctext">Using FormsAuthentication</span></a>
</li>
<li class='toclevel-1'><a href="#usingfilters"><span class="tocnumber">2</span> <span class="toctext">Using Filters</span></a>
</li>
<li class='toclevel-1'><a href="#PrincipalPermission"><span class="tocnumber">3</span> <span class="toctext">PrincipalPermission</span></a>
</li>
<li class='toclevel-1'><a href="#SecurityComponent"><span class="tocnumber">4</span> <span class="toctext">The Security ViewComponent</span></a>
</li>
</ul>
</div>
<!-- End Table of contents -->
		</div>

		<h1 class="firstHeading">
		    Authentication and Authorization
		</h1> 
	
<div class="breadcrumbs">
&raquo;
	<a href="./../../../../index.html">Home</a> 
&raquo;
	<a href="./../../../../monorail/index.html">MonoRail</a> 
&raquo;
	<a href="./../../../../monorail/documentation/index.html">Documentation</a> 
&raquo;
	<a href="./../../../../monorail/documentation/trunk/index.html">MonoRail trunk Documentation</a> 
&raquo;
	<a href="./../../../../monorail/documentation/trunk/usersguide/index.html">User's Guide</a> 
&raquo;
<u>Authentication and Authorization</u>
</div>

		<!-- start content -->
<p>
MonoRail does not provide a standard way to accomplish authentication
nor authorization. This is intentional as MonoRail runs on 
top of the Asp.Net infrastructure
which provides standard way to handle both, like the 
<tt>FormsAuthentication</tt> and the <authorization> configuration element.
</p><p>
That being said, you can also use <a href="filters.html" >Filters</a>
to implement authentication if you want. All you have to do is
associate an authentication filter with the controllers
that can only be accessed by authenticated users.
</p><a name="formsauthentication"></a>
  <h1>Using FormsAuthentication</h1>
  <div class="download">
<div class="downloadborderleft">
<div class="downloadborderright">
<div class="filename">
<a href="./../../../../download/monorail/trunk/MonoRail.AuthenticationUsingForms.zip">MonoRail.AuthenticationUsingForms.zip</a> (7.45k)
</div>
</div></div></div>
<p>
	When you use FormsAuthentication you leverage Asp.Net 
	to handle the authentication, or the cookie and principal implementation
	or both.
	</p><p>
	If you want to use FormsAuthentication, the first thing to do is indicate which resources 
	can only be accessed by authenticated users. Note that 
	from Asp.Net point of view, a controller is also a resource.
	</p><p>
	To configure this, use the <authorization> configuration element
	in the web.config (we are using it on web.config on the root folder).
	</p>    <pre class="csharpcode">

<span class="kwrd">&lt;?</span><span class="html">xml</span> <span class="attr">version</span><span class="kwrd">="1.0"</span> <span class="attr">encoding</span><span class="kwrd">="utf-8"</span>?<span class="kwrd">&gt;</span>
<span class="kwrd">&lt;</span><span class="html">configuration</span><span class="kwrd">&gt;</span>

    <span class="kwrd">&lt;</span><span class="html">location</span> <span class="attr">path</span><span class="kwrd">="home"</span><span class="kwrd">&gt;</span>
        <span class="kwrd">&lt;</span><span class="html">system.web</span><span class="kwrd">&gt;</span>
            <span class="kwrd">&lt;</span><span class="html">authorization</span><span class="kwrd">&gt;</span>
                <span class="kwrd">&lt;</span><span class="html">deny</span> <span class="attr">users</span><span class="kwrd">="?"</span><span class="kwrd">/&gt;</span>
            <span class="kwrd">&lt;/</span><span class="html">authorization</span><span class="kwrd">&gt;</span>
        <span class="kwrd">&lt;/</span><span class="html">system.web</span><span class="kwrd">&gt;</span>
    <span class="kwrd">&lt;/</span><span class="html">location</span><span class="kwrd">&gt;</span>

    ...

</pre>
  <p>
	With the configuration above we are saying that the controller <tt>Home</tt>
	cannot be reached by anonymous users.
	</p><p>
	Now that the resources are protected we can configure the <tt>FormsAuthentication</tt>
	support. In order to be really simple, we even manage the usernames and passwords 
	allowed on the configuration file too:
	</p>    <pre class="csharpcode">

<span class="kwrd">&lt;?</span><span class="html">xml</span> <span class="attr">version</span><span class="kwrd">="1.0"</span> <span class="attr">encoding</span><span class="kwrd">="utf-8"</span>?<span class="kwrd">&gt;</span>
<span class="kwrd">&lt;</span><span class="html">configuration</span><span class="kwrd">&gt;</span>
    
    ...

    <span class="kwrd">&lt;</span><span class="html">system.web</span><span class="kwrd">&gt;</span>
        <span class="kwrd">&lt;</span><span class="html">authentication</span> <span class="attr">mode</span><span class="kwrd">="Forms"</span><span class="kwrd">&gt;</span>
            <span class="kwrd">&lt;</span><span class="html">forms</span> <span class="attr">name</span><span class="kwrd">="auth"</span> <span class="attr">loginUrl</span><span class="kwrd">="login/index.rails"</span><span class="kwrd">&gt;</span>
                <span class="kwrd">&lt;</span><span class="html">credentials</span> <span class="attr">passwordFormat</span><span class="kwrd">="Clear"</span><span class="kwrd">&gt;</span>
                    <span class="kwrd">&lt;</span><span class="html">user</span> <span class="attr">name</span><span class="kwrd">="admin"</span> <span class="attr">password</span><span class="kwrd">="admin"</span> <span class="kwrd">/&gt;</span>
                    <span class="kwrd">&lt;</span><span class="html">user</span> <span class="attr">name</span><span class="kwrd">="user"</span> <span class="attr">password</span><span class="kwrd">="user"</span> <span class="kwrd">/&gt;</span>
                <span class="kwrd">&lt;/</span><span class="html">credentials</span><span class="kwrd">&gt;</span>
            <span class="kwrd">&lt;/</span><span class="html">forms</span><span class="kwrd">&gt;</span>
        <span class="kwrd">&lt;/</span><span class="html">authentication</span><span class="kwrd">&gt;</span>

        ...

</pre>
  <p>
	The configuration defines that in the event that authentication is needed,
	Asp.Net should redirect the user to <tt>login/index.rails</tt> which
	is our <tt>LoginController</tt>, action <tt>index</tt>. There we 
	present our login form:
	</p><p><img src="./../../../../images/monorail/auth_login.png" ></img></p><p>
	The authentication code relies on the <tt>FormsAuthentication</tt>: 
	</p>    <pre class="csharpcode">

<span class="kwrd">using</span> System.Web.Security;

<span class="kwrd">using</span> Castle.MonoRail.Framework;

[Layout(<span class="str">"default"</span>)]
<span class="kwrd">public</span> <span class="kwrd">class</span> LoginController : SmartDispatcherController
{
    <span class="kwrd">public</span> <span class="kwrd">void</span> Index()
    {
    }
    
    <span class="kwrd">public</span> <span class="kwrd">void</span> LogIn(String username, String password, <span class="kwrd">bool</span> rememberme, <span class="kwrd">string</span> ReturnUrl)
    {
        <span class="kwrd">if</span> (FormsAuthentication.Authenticate(username, password))
        {
            CancelView();
            
            FormsAuthentication.RedirectFromLoginPage(
                username, rememberme, Context.ApplicationPath);
        }
        <span class="kwrd">else</span>
        {
            <span class="rem">// If we got here then something </span>
            <span class="rem">// is wrong with the supplied username/password</span>
            
            Flash[<span class="str">"error"</span>] = <span class="str">"Invalid user name or password. Try again."</span>;
            RedirectToAction(<span class="str">"Index"</span>, <span class="str">"ReturnUrl="</span> + ReturnUrl);
        }
    }
}</pre>
  <p>
	Once authenticated, we can navigate to the protected resource:
	</p><p><img src="./../../../../images/monorail/auth_logged.png" ></img></p><a name="usingfilters"></a>
  <h1>Using Filters</h1>
  <div class="download">
<div class="downloadborderleft">
<div class="downloadborderright">
<div class="filename">
<a href="./../../../../download/monorail/trunk/MonoRail.AuthenticationUsingFilters.zip">MonoRail.AuthenticationUsingFilters.zip</a> (9.17k)
</div>
</div></div></div>
<p>
	When using filters the options are wide. You can rely on
	the session, you can rely on cookies or you may 
	want to provide an implementation of <tt>IPrincipal</tt>
	and supply the roles yourself to have a more fine-grained 
	permission control.
	</p><p>
	The approach demonstrated here uses a custom implementation of <tt>IPrincipal</tt>
	on the <tt>User</tt> class and uses the session to persist the authentication
	among requests. Implementing a "remember me" feature would require a cookie.
	The cookie approach was not implemented here in order to keep the example as simple as possible.
	</p><p>
	Authentication control with filter is just a matter of associating
	an authentication filter with the controllers you do not want to be 
	accessed by anonymous users. This only restricts access to the controller's actions.
	If you want to protect files, you might use a mix of 
	filters and <tt>FormsAuthentication</tt> or implemet the <tt>Authenticate_Request</tt>
	event.
	</p><p>
	In our example we want to prevent access to the <tt>HomeController</tt>.
	We associate a <tt>BeforeAction</tt> filter with the controller:
	</p>    <pre class="csharpcode">

<span class="kwrd">using</span> AuthenticationUsingFilters.Filters;
<span class="kwrd">using</span> Castle.MonoRail.Framework;

[Layout(<span class="str">"default"</span>)]
[Filter(ExecuteEnum.BeforeAction, <span class="kwrd">typeof</span>(AuthenticationFilter))]
<span class="kwrd">public</span> <span class="kwrd">class</span> HomeController : SmartDispatcherController
{
    <span class="kwrd">public</span> <span class="kwrd">void</span> Index()
    {
    }
}</pre>
  <p>
	The filter implementation can do a number of things 
	to check if the current user is authenticated. We
	decided to check if an existing object exists in the
	session. The object implements <tt>IPrincipal</tt> but
	this is not required. The implementation will vary depending
	on the requirements and how you plan to handle authorization.
	</p>    <pre class="csharpcode">

<span class="kwrd">using</span> System.Collections.Specialized;
<span class="kwrd">using</span> AuthenticationUsingFilters.Model;
<span class="kwrd">using</span> Castle.MonoRail.Framework;

<span class="kwrd">public</span> <span class="kwrd">class</span> AuthenticationFilter : IFilter
{
    <span class="kwrd">public</span> <span class="kwrd">bool</span> Perform(ExecuteEnum exec, IRailsEngineContext context, Controller controller)
    {
        <span class="rem">// Read previous authenticated principal from session </span>
        <span class="rem">// (could be from cookie although with more work)</span>
        
        User user = (User) context.Session[<span class="str">"user"</span>];
        
        <span class="rem">// Sets the principal as the current user</span>
        context.CurrentUser = user;
        
        <span class="rem">// Checks if it is OK</span>
        <span class="kwrd">if</span> (context.CurrentUser == <span class="kwrd">null</span> || 
            !context.CurrentUser.Identity.IsAuthenticated)
        {
            <span class="rem">// Not authenticated, redirect to login</span>
            NameValueCollection parameters = <span class="kwrd">new</span> NameValueCollection();
            parameters.Add(<span class="str">"ReturnUrl"</span>, context.Url);
            controller.Redirect(<span class="str">"login"</span>, <span class="str">"index"</span>, parameters);
            
            <span class="rem">// Prevent request from continue</span>
            <span class="kwrd">return</span> <span class="kwrd">false</span>;
        }
        
        <span class="rem">// Everything is ok</span>
        <span class="kwrd">return</span> <span class="kwrd">true</span>;
    }
}</pre>
  <p>
	The <tt>LoginController</tt> will not be much different
	from the previous example:
	</p>    <pre class="csharpcode">

<span class="kwrd">using</span> AuthenticationUsingFilters.Model;
<span class="kwrd">using</span> Castle.MonoRail.Framework;

[Layout(<span class="str">"default"</span>)]
<span class="kwrd">public</span> <span class="kwrd">class</span> LoginController : SmartDispatcherController
{
    <span class="kwrd">public</span> <span class="kwrd">void</span> Index()
    {
    }
    
    <span class="kwrd">public</span> <span class="kwrd">void</span> LogIn(String username, String password, <span class="kwrd">bool</span> rememberme, <span class="kwrd">string</span> ReturnUrl)
    {
        <span class="rem">// We should authenticate against a database table or something similar</span>
        <span class="rem">// but here, everything is ok as long as the </span>
        <span class="rem">// password and username are non-empty</span>
        
        <span class="kwrd">if</span> (IsValid(username, password))
        {
            CancelView();
            
            <span class="rem">// Ideally we would look up an user from the database</span>
            <span class="rem">// The domain model that represents the user</span>
            <span class="rem">// could implement IPrincipal or we could use an adapter</span>
            
            User user = <span class="kwrd">new</span> User(username, <span class="kwrd">new</span> <span class="kwrd">string</span>[0]);
            
            Session[<span class="str">"user"</span>] = user;
            
            Redirect(ReturnUrl);
        }
        <span class="kwrd">else</span>
        {
            <span class="rem">// If we got here then something is wrong </span>
            <span class="rem">// with the supplied username/password</span>
        
            Flash[<span class="str">"error"</span>] = <span class="str">"Invalid user name or password. Try again."</span>;
            RedirectToAction(<span class="str">"Index"</span>, <span class="str">"ReturnUrl="</span> + ReturnUrl);
        }
    }

    <span class="kwrd">private</span> <span class="kwrd">bool</span> IsValid(<span class="kwrd">string</span> username, <span class="kwrd">string</span> password)
    {
        <span class="kwrd">return</span> username != <span class="kwrd">null</span> &amp;&amp; password != <span class="kwrd">null</span>;
    }
}</pre>
  <p>
	If the authentication passes we just create the <tt>User</tt>
	and add it to the session, allowing the filter to get it for 
	the subsequent requests.
	</p><p>
	The <tt>User</tt> class is just a simple implementation of <tt>IPrincipal</tt>.
	Real applications will use an adapter or change an existing class that 
	represents a logged-in user, or a system user to implement it as well.
	</p>    <pre class="csharpcode">

<span class="kwrd">public</span> <span class="kwrd">class</span> User : IPrincipal
{
    <span class="kwrd">private</span> <span class="kwrd">string</span>[] roles;
    <span class="kwrd">private</span> IIdentity identity;

    <span class="kwrd">public</span> User(String name, String[] roles)
    {
        identity = <span class="kwrd">new</span> GenericIdentity(name, <span class="str">"Custom MonoRail authentication"</span>);
        <span class="kwrd">this</span>.roles = roles;
    }

    <span class="kwrd">public</span> <span class="kwrd">bool</span> IsInRole(<span class="kwrd">string</span> role)
    {
        <span class="kwrd">return</span> Array.IndexOf(roles, role) &gt;= 0;
    }

    <span class="kwrd">public</span> IIdentity Identity
    {
        get { <span class="kwrd">return</span> identity; }
    }
}</pre>
  <p>
	Compared with the previous example, the data output 
	is a little bit different:
	</p><p><img src="./../../../../images/monorail/auth_logged2.png" ></img></p><a name="PrincipalPermission"></a>
  <h1>PrincipalPermission</h1>
<p>
	If you have a custom implementation of <tt>IPrincipal</tt>
	or even if you use the <tt>GenericPrincipal</tt> but supply the roles,
	you would be able to use <tt>PrincipalPermission</tt> to prevent users from 
	invoking methods or code branches.
	</p>  <div class="note">
<div class="notetopbg">
<div class="noteborderleft">
<div class="noteborderright">
<div class="notetopleft">
<div class="notetopright">
<div class="notebottomleft">
<div class="notebottomright">
<div class="boxtitle">Quick Note</div>
<div class="innercontent">
<p>
	In addition to setting the principal implementation on 
	the <tt>HttpRequest</tt> (which is what <tt>context.CurrentUser</tt> does)
	you must also set the principal on the current thread by using 
	<tt>System.Threading.Thread.CurrentPrincipal</tt>.
	</p>
</div></div></div></div></div></div></div></div></div>
<p>
	The <tt>PrincipalPermission</tt> and <tt>PrincipalPermissionAttribute</tt>
	belong to the .Net security infrastructure and demands that the executing
	principal have a specific role. This can be used as the last resource to 
	secure your application. 
	</p><p>
	For example, suppose your application is clever enough to not offer
	buttons or links to resources/actions the users do not have access 
	to. However, this is commonly refered to as security by obscurity, as
	any user that knows how to get to the resource will be able to access them. 
	To secure the application from this kind of access you might use
	the <tt>PrincipalPermission</tt>. For example:
	</p>    <pre class="csharpcode">

<span class="kwrd">using</span> System.Security;
<span class="kwrd">using</span> Castle.MonoRail.Framework;

<span class="kwrd">public</span> <span class="kwrd">class</span> OrderController : SmartDispatcherController
{
    [PrincipalPermission(SecurityAction.Demand, Role=<span class="str">"Administrator"</span>)]
    <span class="kwrd">public</span> <span class="kwrd">void</span> DeleteOrder(<span class="kwrd">int</span> orderid)
    {
        ...
    }
}</pre>
  <p>
	If the current user does not have the role <tt>Administrator</tt>
	a <tt>SecurityException</tt> will be thrown.
	</p><a name="SecurityComponent"></a>
  <h1>The Security ViewComponent</h1>
<p>
	MonoRail comes with a ViewComponent called <tt>SecurityComponent</tt>
	which can be used on views to prevent rendering of content based on the roles
	the current user (principal) has. For example:
	</p>  <div class="tabWrapper" id="tabcontent1">
<ul class="tabbedNavOff" id="tabcontent1_tabs">
	<li><a class="" id="tabtabcontent1_1" href="#tabcontent1-1" onclick="return tabcontent1Tab.switchTab(this.id,false)"><span><span>With NVelocity View Engine</span></span></a></li>
	<li><a class="" id="tabtabcontent1_2" href="#tabcontent1-2" onclick="return tabcontent1Tab.switchTab(this.id,false)"><span><span>With Brail</span></span></a></li>
</ul>
<div class="tabSpacerOff" id="tabcontent1_spacer">&nbsp;</div>
	<div class="tabBox" id="tabcontent1-1">
<div class="tabBoxGutter">
    <pre class="csharpcode">

#blockcomponent(SecurityComponent with "role=Administrator")

This content can only be seen by administrators

#end
</pre>
  </div>
</div>
	<div class="tabBox" id="tabcontent1-2">
<div class="tabBoxGutter">
    <pre class="csharpcode">

TODO
</pre>
  </div>
</div>
</div>
<script type="text/javascript">
 //<![CDATA[
 
 // Declare a new instance of the TAB class
 var tabcontent1Tab = new TAB();
 
 tabcontent1Tab.name         = "tabcontent1";
 tabcontent1Tab.tabSpacerID  = "tabcontent1_spacer";
 tabcontent1Tab.tabOptionsID = "tabcontent1_options";
 tabcontent1Tab.tabRootID    = "tabcontent1_tabs";
 
 // IDs of the tabs themselves
 tabcontent1Tab.tabIDs[0] = "tabtabcontent1_1";
 tabcontent1Tab.tabIDs[1] = "tabtabcontent1_2";
 
 // IDs of the tab boxes
 tabcontent1Tab.boxIDs[0] = "tabcontent1-1";
 tabcontent1Tab.boxIDs[1] = "tabcontent1-2";
 
 // Initialize the tabs
 tabcontent1Tab.initialize();
 
 // ]]>
</script>

<p>
	For more information on ViewComponents see the 
	<a href="viewcomponents.html" >Reusing UI portions (ViewComponents)</a> document.
	</p>		<!-- end content -->
		
	<div id="footer">
<script type="text/javascript"><!--
google_ad_client = "pub-2091974950947714";
/* 728x90, created 2/13/08 */
google_ad_slot = "5378217716";
google_ad_width = 728;
google_ad_height = 90;
//-->
</script>
<script type="text/javascript"
src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
	
	<br/>
	Found an error? Something inaccurate? 
	<a href="../../../../community/getinvolved.html">Help us improve the documentation</a> <br/>
	Generated by <a href="../../../../others/anakia/index.html">Castle Anakia</a>. 
	
	<p>&nbsp;</p>
	
	<p>
	Sponsored by <img src="../../../../images/logothumb.gif" /> <a href="http://www.castlestronghold.com">Castle Stronghold</a>.
	</p>
	
	</div>

	<!-- Search Google -->
<center>
<FORM method=GET action="http://www.google.com/custom">
<TABLE bgcolor="#FFFFFF" cellspacing="4" border="0" style="border: solid 1px gray;" align="center">
<tr valign=top><td>
<A HREF="http://www.google.com/search">
<IMG SRC="http://www.google.com/logos/Logo_40wht.gif" border=0 ALT=Google align=middle></A>
</td>
<td>
<INPUT TYPE=text name=q size=31 maxlength=255 value="">
<INPUT type=submit name=sa VALUE="Google Search">
<INPUT type=hidden name=cof VALUE="S:http://www.castlestronghold.com;GL:1;VLC:#373737;AH:center;LH:63;LC:#0A50A1;GFNT:#5B5B5B;L:http://www.castleproject.org/images/castle-logo.gif;ALC:#0A50A1;BIMG:http://www.castleproject.org/images/bg.png;LW:280;T:#5B5B5B;AWFID:3d565acacdd9f388;">
<input type=hidden name=domains value="castleproject.org"><br><input type=radio name=sitesearch value=""> Search WWW <input type=radio name=sitesearch value="castleproject.org" checked> Search castleproject.org
</td></tr></TABLE>
</FORM>
<!-- Search Google -->
</center>
	&nbsp;
	<br/>

		</div> <!-- end of content -->
  </div><!-- end of page -->
  


	<script type="text/javascript">_uacct = "UA-1190612-1";urchinTracker();</script>
	<script type="text/javascript">
		var uservoiceJsHost = ("https:" == document.location.protocol) ? "https://uservoice.com" : "http://cdn.uservoice.com";
		document.write(unescape("%3Cscript src='" + uservoiceJsHost + "/javascripts/widgets/tab.js' type='text/javascript'%3E%3C/script%3E"))
	</script>
	<script type="text/javascript">
		UserVoice.Popin.setup({ 
			key: 'castle',
			alignment: 'right',
			host: 'castle.uservoice.com', 
			forum: 'general', 
			lang: 'en'
		})
	</script>
	</body>
</html>
