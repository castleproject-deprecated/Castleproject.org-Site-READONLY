<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">









<html>
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1"/>
		<title>Creating a CRUD page with DataBinder :: Castle Project</title>
		<link rel="stylesheet" href="../../base.css" />
		<link rel="stylesheet" href="../../front.css" />
		<link rel="stylesheet" href="../../elem.css" />
		<link rel="stylesheet" href="../../csharp.css" />
		<link rel="stylesheet" href="../../TAB_styles.css" />
		<script type="text/javascript" src="../../mktree.js"></script>
		<script type="text/javascript" src="../../TAB_Function_Lib.js"></script>
		<script src="http://www.google-analytics.com/urchin.js" type="text/javascript"></script>
	</head>

	<body>
<div id="topheader">
  <div id="maintitle">
	<h1> <a href="../../index.html" title="Castle Project Home" accesskey="1">Home</a> </h1>
	<h2> <a href="http://www.castlestronghold.com" title="Castle Stronghold: support, consulting and development">Castle Stronghold</a> </h2>
  </div>
  <div id="mainbar">
	<ul id="toplinks">
		<li>&nbsp;</li>
		<li><a style="_width: 70px;" href="../../index.html">Home</a></li>
		<li><a style="_width: 70px;" href="../../castle/projects.html">Projects</a></li>
		<li><a style="_width: 70px;" href="../../castle/download.html">Downloads</a></li>
		<li><a href="#" onclick="UserVoice.Popin.show(); return false;" title="Uservoice Feedback">Feedback</a></li>
		<li><a style="_width: 110px;" href="http://api.castleproject.org">API Doc</a></li>
		<li><a style="_width: 50px;" href="http://using.castleproject.org">Using</a></li>
		<li><a style="_width: 60px;" href="../../community/mailinglists.html">Mailing Lists</a></li>
		<li><a style="_width: 120px;" href="../../issuetracker.html">Issue Tracker</a></li>
		<li><a style="_width: 110px;" href="http://builds.castleproject.org">Builds</a></li>
	</ul>
  </div>
</div>



<div id="coolpage">

	<div id="sidebar" >
		
  <div class="lightmenu">
    <div class="lightmenucontent">
<span class="menutitle">
<a href="./../../monorail/gettingstarted/index.html">Introduction</a>
</span>
  <ul>
<li>
<a href="./../../monorail/gettingstarted/requirements.html">Requirements</a>
</li>
<li>
<a href="./../../monorail/gettingstarted/creatingproject.html">Creating the project skeleton</a>
</li>
<li>
<a href="./../../monorail/gettingstarted/firstcontroller.html">Your first controller and view</a>
</li>
<li>
<a href="./../../monorail/gettingstarted/smartdispatcher.html">Using the SmartDispatcherController</a>
</li>
<li>
<a href="./../../monorail/gettingstarted/ar.html">Bringing ActiveRecord to the party</a>
</li>
<li>
<a href="./../../monorail/gettingstarted/scaffolding.html">Using ActiveRecord Scaffolding</a>
</li>
<li>
<a href="./../../monorail/gettingstarted/crud.html">Creating a CRUD page with DataBinder</a>
</li>
<li>
<a href="./../../monorail/gettingstarted/more.html">Getting more</a>
</li>
  </ul>
    </div>
  </div>
  <br/>
  <div class="darkmenu">
    <div class="darkmenucontent">
<span class="menutitle">
Navigation
</span>
  <ul>
<li>
<a href="./../../monorail/documentation/index.html">MonoRail Documentation</a>
</li>
<li>
<a href="./../../monorail/index.html">Back to MonoRail</a>
</li>
<li>
<a href="./../../index.html">Back to Main Page</a>
</li>
  </ul>
    </div>
  </div>
  <br/>
	<br/>
	
	</div>
		
	<div id="content">
	
		<div class="callout-pic">
		<img src="../../images/mr_rawlogo.gif" />

<!-- Begin Table of contents -->
<div id="toc">
<h2>Table of contents</h2>
<ul>
<li class='toclevel-1'><span class="tocnumber">1</span> <span class="toctext">Listing</span>
</li>
<li class='toclevel-1'><span class="tocnumber">2</span> <span class="toctext">Creating</span>
</li>
<li class='toclevel-1'><span class="tocnumber">3</span> <span class="toctext">Updating</span>
</li>
<li class='toclevel-1'><span class="tocnumber">4</span> <span class="toctext">Deleting</span>
</li>
</ul>
</div>
<!-- End Table of contents -->
		</div>

		<h1 class="firstHeading">
		    Creating a CRUD page with DataBinder
		</h1> 
	
<div class="breadcrumbs">
&raquo;
	<a href="./../../index.html">Home</a> 
&raquo;
	<a href="./../../monorail/index.html">MonoRail</a> 
&raquo;
	<a href="./../../monorail/gettingstarted/index.html">Getting started with MonoRail</a> 
&raquo;
<u>Creating a CRUD page with DataBinder</u>
</div>

		<!-- start content -->
<p>
CRUD stands for Create, Retrieve, Update and Delete. 
Most applications have some kind of CRUD funcionality, 
and we can assume that every programmer had to deal with 
CRUD at some point.
</p><p>
As you remember, we have created a <tt>Supplier</tt>
and <tt>Product</tt> classes. We used scaffolding to create the
crud for the <tt>Supplier</tt> class. Now let's code 
the CRUD for the <tt>Product</tt> class manually. You'll see 
that it is also something really simple.
</p><p>
The first thing you must do is create the 
<tt>ProductController</tt>:
</p>    <pre class="csharpcode">

<span class="kwrd">namespace</span> GettingStartedSample.Controllers
{
    <span class="kwrd">using</span> System;
    <span class="kwrd">using</span> Castle.MonoRail.Framework;
    <span class="kwrd">using</span> GettingStartedSample.Models;

    [Layout(<span class="str">"default"</span>), Rescue(<span class="str">"generalerror"</span>)]
    <span class="kwrd">public</span> <span class="kwrd">class</span> ProductController : SmartDispatcherController
    {
    }
}</pre>
  <p>
Now we are ready.
</p>  <h1>Listing</h1>
<p>
Create a <tt>List</tt> action on the controller:
</p>    <pre class="csharpcode">

<span class="kwrd">public</span> <span class="kwrd">void</span> List()
{
    PropertyBag[<span class="str">"products"</span>] = Product.FindAll();
}</pre>
  <p>
This code makes all products available to the view. Now
create the <tt>list.vm</tt>:
</p>    <pre class="csharpcode">

<span class="kwrd">&lt;</span><span class="html">h3</span><span class="kwrd">&gt;</span>Product list<span class="kwrd">&lt;/</span><span class="html">h3</span><span class="kwrd">&gt;</span>

<span class="kwrd">&lt;</span><span class="html">p</span><span class="kwrd">&gt;</span>
<span class="kwrd">&lt;</span><span class="html">a</span> <span class="attr">href</span><span class="kwrd">="new.rails"</span><span class="kwrd">&gt;</span>Create new Product<span class="kwrd">&lt;/</span><span class="html">a</span><span class="kwrd">&gt;</span>
<span class="kwrd">&lt;/</span><span class="html">p</span><span class="kwrd">&gt;</span>

<span class="kwrd">&lt;</span><span class="html">table</span> <span class="attr">width</span><span class="kwrd">="100%"</span> <span class="attr">border</span><span class="kwrd">="1"</span> <span class="attr">cellpadding</span><span class="kwrd">="2"</span> <span class="attr">cellspacing</span><span class="kwrd">="0"</span><span class="kwrd">&gt;</span>
<span class="kwrd">&lt;</span><span class="html">tr</span><span class="kwrd">&gt;</span>
    <span class="kwrd">&lt;</span><span class="html">th</span><span class="kwrd">&gt;</span>Id<span class="kwrd">&lt;/</span><span class="html">th</span><span class="kwrd">&gt;</span>
    <span class="kwrd">&lt;</span><span class="html">th</span><span class="kwrd">&gt;</span>Name<span class="kwrd">&lt;/</span><span class="html">th</span><span class="kwrd">&gt;</span>
    <span class="kwrd">&lt;</span><span class="html">th</span><span class="kwrd">&gt;</span>Supplier<span class="kwrd">&lt;/</span><span class="html">th</span><span class="kwrd">&gt;</span>
    <span class="kwrd">&lt;</span><span class="html">th</span><span class="kwrd">&gt;</span><span class="attr">&amp;nbsp;</span><span class="kwrd">&lt;/</span><span class="html">th</span><span class="kwrd">&gt;</span>
<span class="kwrd">&lt;/</span><span class="html">tr</span><span class="kwrd">&gt;</span>
#foreach($product in $products)
<span class="kwrd">&lt;</span><span class="html">tr</span><span class="kwrd">&gt;</span>
    <span class="kwrd">&lt;</span><span class="html">td</span> <span class="attr">align</span><span class="kwrd">="center"</span><span class="kwrd">&gt;</span>$product.Id<span class="kwrd">&lt;/</span><span class="html">td</span><span class="kwrd">&gt;</span>
    <span class="kwrd">&lt;</span><span class="html">td</span> <span class="attr">align</span><span class="kwrd">="center"</span><span class="kwrd">&gt;</span>$product.Name<span class="kwrd">&lt;/</span><span class="html">td</span><span class="kwrd">&gt;</span>
    <span class="kwrd">&lt;</span><span class="html">td</span> <span class="attr">align</span><span class="kwrd">="center"</span><span class="kwrd">&gt;</span>$product.Supplier.Name<span class="kwrd">&lt;/</span><span class="html">td</span><span class="kwrd">&gt;</span>
    <span class="kwrd">&lt;</span><span class="html">td</span> <span class="attr">align</span><span class="kwrd">="center"</span><span class="kwrd">&gt;</span>
        <span class="kwrd">&lt;</span><span class="html">a</span> <span class="attr">href</span><span class="kwrd">="edit.rails?id=${product.Id}"</span><span class="kwrd">&gt;</span>Edit<span class="kwrd">&lt;/</span><span class="html">a</span><span class="kwrd">&gt;</span> | 
        <span class="kwrd">&lt;</span><span class="html">a</span> <span class="attr">href</span><span class="kwrd">="delete.rails?id=${product.Id}"</span><span class="kwrd">&gt;</span>Delete<span class="kwrd">&lt;/</span><span class="html">a</span><span class="kwrd">&gt;</span>
    <span class="kwrd">&lt;/</span><span class="html">td</span><span class="kwrd">&gt;</span>
<span class="kwrd">&lt;/</span><span class="html">tr</span><span class="kwrd">&gt;</span>
#end
<span class="kwrd">&lt;/</span><span class="html">table</span><span class="kwrd">&gt;</span></pre>
  <p>
	Test your working accessing <tt>/product/list.rails</tt></p><p><img src="./../../images/monorail/gs_crud_2.png" ></img></p>  <h1>Creating</h1>
<p>
To insert a new product we will use two actions:
<ul><li>New: which will present the form</li><li>Create: which uses the data supplied on the form to create the Product on the database</li></ul></p>    <pre class="csharpcode">

<span class="kwrd">public</span> <span class="kwrd">void</span> New()
{
    PropertyBag[<span class="str">"suppliers"</span>] = Supplier.FindAll();
}

<span class="kwrd">public</span> <span class="kwrd">void</span> Create([DataBind(<span class="str">"product"</span>)] Product prod)
{
    <span class="kwrd">try</span>
    {
        prod.Create();
    
        RedirectToAction(<span class="str">"list"</span>);
    }
    <span class="kwrd">catch</span>(Exception ex)
    {
        Flash[<span class="str">"error"</span>] = ex.Message;
        Flash[<span class="str">"product"</span>] = prod;
        
        RedirectToAction(<span class="str">"new"</span>);
    }
}</pre>
  <p>
The <tt>New</tt> action makes all suppliers available to
the view. This is required to populate a select element with all suppliers available.
</p><p>
The <tt>new.vm</tt> view follows:
</p>    <pre class="csharpcode">

<span class="kwrd">&lt;</span><span class="html">h3</span><span class="kwrd">&gt;</span>New Product<span class="kwrd">&lt;/</span><span class="html">h3</span><span class="kwrd">&gt;</span>

#if($Flash.error)
<span class="kwrd">&lt;</span><span class="html">p</span> <span class="attr">style</span><span class="kwrd">="color: red; font-weight: bold;"</span><span class="kwrd">&gt;</span>
    $Flash.error
<span class="kwrd">&lt;/</span><span class="html">p</span><span class="kwrd">&gt;</span>
#end

<span class="kwrd">&lt;</span><span class="html">form</span> <span class="attr">action</span><span class="kwrd">="create.rails"</span> <span class="attr">method</span><span class="kwrd">="post"</span><span class="kwrd">&gt;</span>

    <span class="kwrd">&lt;</span><span class="html">p</span><span class="kwrd">&gt;</span>
    Name: $FormHelper.TextField("product.name")
    <span class="kwrd">&lt;/</span><span class="html">p</span><span class="kwrd">&gt;</span>

    <span class="kwrd">&lt;</span><span class="html">p</span><span class="kwrd">&gt;</span>
    Price: $FormHelper.TextFieldFormat("product.price", "000.00")
    <span class="kwrd">&lt;/</span><span class="html">p</span><span class="kwrd">&gt;</span>

    <span class="kwrd">&lt;</span><span class="html">p</span><span class="kwrd">&gt;</span>
    Supplier: $FormHelper.Select("product.supplier.id", $suppliers, "%{value='Id', text='Name'}")
    <span class="kwrd">&lt;/</span><span class="html">p</span><span class="kwrd">&gt;</span>

    <span class="kwrd">&lt;</span><span class="html">hr</span><span class="kwrd">/&gt;</span>

    <span class="kwrd">&lt;</span><span class="html">p</span><span class="kwrd">&gt;</span>
    <span class="kwrd">&lt;</span><span class="html">input</span> <span class="attr">type</span><span class="kwrd">="submit"</span> <span class="attr">value</span><span class="kwrd">="Create"</span> <span class="kwrd">/&gt;</span>
    <span class="kwrd">&lt;/</span><span class="html">p</span><span class="kwrd">&gt;</span>

<span class="kwrd">&lt;/</span><span class="html">form</span><span class="kwrd">&gt;</span></pre>
  <p>
	Test your working accessing <tt>/product/new.rails</tt></p><p><img src="./../../images/monorail/gs_crud_1.png" ></img></p>  <h1>Updating</h1>
<p>
	Updating is not very different from creating. 
	First create two actions: <tt>Edit</tt> and <tt>Update</tt>.
	</p>    <pre class="csharpcode">

<span class="kwrd">public</span> <span class="kwrd">void</span> Edit(<span class="kwrd">int</span> id)
{
    PropertyBag[<span class="str">"product"</span>] = Product.FindById(id);
    PropertyBag[<span class="str">"suppliers"</span>] = Supplier.FindAll();
}

<span class="kwrd">public</span> <span class="kwrd">void</span> Update([DataBind(<span class="str">"product"</span>)] Product prod)
{
    <span class="kwrd">try</span>
    {
        prod.Update();
    
        RedirectToAction(<span class="str">"list"</span>);
    }
    <span class="kwrd">catch</span>(Exception ex)
    {
        Flash[<span class="str">"error"</span>] = ex.Message;
        Flash[<span class="str">"product"</span>] = prod;
        
        RedirectToAction(<span class="str">"edit"</span>, <span class="str">"id="</span> + prod.Id);
    }
}</pre>
  <p>
We can also use a different <tt>Edit</tt> overload
that will be used when the Update catch block redirects
it back to the <tt>Edit</tt>:
</p>    <pre class="csharpcode">

<span class="kwrd">public</span> <span class="kwrd">void</span> Edit(<span class="kwrd">int</span> id, [FlashBinder] Product product)
{
    PropertyBag[<span class="str">"suppliers"</span>] = Supplier.FindAll();
}</pre>
  <p>
The <tt>edit.vm</tt> view is pratically the same as the <tt>new.vm</tt>.
The <tt>FormHelper</tt> is clever enough to populate the fields and 
select the correct item on the <tt>select</tt> element.
</p>    <pre class="csharpcode">

<span class="kwrd">&lt;</span><span class="html">h3</span><span class="kwrd">&gt;</span>Edit Product<span class="kwrd">&lt;/</span><span class="html">h3</span><span class="kwrd">&gt;</span>

#if($Flash.error)
<span class="kwrd">&lt;</span><span class="html">p</span> <span class="attr">style</span><span class="kwrd">="color: red; font-weight: bold;"</span><span class="kwrd">&gt;</span>
    $Flash.error
<span class="kwrd">&lt;/</span><span class="html">p</span><span class="kwrd">&gt;</span>
#end

<span class="kwrd">&lt;</span><span class="html">form</span> <span class="attr">action</span><span class="kwrd">="update.rails"</span> <span class="attr">method</span><span class="kwrd">="post"</span><span class="kwrd">&gt;</span>

$FormHelper.HiddenField("product.id")

    <span class="kwrd">&lt;</span><span class="html">p</span><span class="kwrd">&gt;</span>
    Name: $FormHelper.TextField("product.name")
    <span class="kwrd">&lt;/</span><span class="html">p</span><span class="kwrd">&gt;</span>

    <span class="kwrd">&lt;</span><span class="html">p</span><span class="kwrd">&gt;</span>
    Price: $FormHelper.TextFieldFormat("product.price", "000.00")
    <span class="kwrd">&lt;/</span><span class="html">p</span><span class="kwrd">&gt;</span>

    <span class="kwrd">&lt;</span><span class="html">p</span><span class="kwrd">&gt;</span>
    Supplier: $FormHelper.Select("product.supplier.id", $suppliers, "%{value='Id', text='Name'}")
    <span class="kwrd">&lt;/</span><span class="html">p</span><span class="kwrd">&gt;</span>

    <span class="kwrd">&lt;</span><span class="html">hr</span><span class="kwrd">/&gt;</span>

    <span class="kwrd">&lt;</span><span class="html">p</span><span class="kwrd">&gt;</span>
    <span class="kwrd">&lt;</span><span class="html">input</span> <span class="attr">type</span><span class="kwrd">="submit"</span> <span class="attr">value</span><span class="kwrd">="Update"</span> <span class="kwrd">/&gt;</span>
    <span class="kwrd">&lt;/</span><span class="html">p</span><span class="kwrd">&gt;</span>

<span class="kwrd">&lt;/</span><span class="html">form</span><span class="kwrd">&gt;</span></pre>
    <h1>Deleting</h1>
<p>
	Deleting is the easiest one. Add the <tt>Delete</tt>
	action:
	</p>    <pre class="csharpcode">

<span class="kwrd">public</span> <span class="kwrd">void</span> Delete(<span class="kwrd">int</span> id)
{
    Product product = Product.FindById(id);
    
    product.Delete();
    
    RedirectToAction(<span class="str">"list"</span>);
}
</pre>
  <p>
	So, do you miss WebForms at all?
	</p><p>
	Proceed with <a href="more.html" >Getting more</a>.
	</p>		<!-- end content -->
		
	<div id="footer">
<script type="text/javascript"><!--
google_ad_client = "pub-2091974950947714";
/* 728x90, created 2/13/08 */
google_ad_slot = "5378217716";
google_ad_width = 728;
google_ad_height = 90;
//-->
</script>
<script type="text/javascript"
src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
	
	<br/>
	Found an error? Something inaccurate? 
	<a href="../../community/getinvolved.html">Help us improve the documentation</a> <br/>
	Generated by <a href="../../others/anakia/index.html">Castle Anakia</a>. 
	
	<p>&nbsp;</p>
	
	<p>
	Sponsored by <img src="../../images/logothumb.gif" /> <a href="http://www.castlestronghold.com">Castle Stronghold</a>.
	</p>
	
	</div>

	<!-- Search Google -->
<center>
<FORM method=GET action="http://www.google.com/custom">
<TABLE bgcolor="#FFFFFF" cellspacing="4" border="0" style="border: solid 1px gray;" align="center">
<tr valign=top><td>
<A HREF="http://www.google.com/search">
<IMG SRC="http://www.google.com/logos/Logo_40wht.gif" border=0 ALT=Google align=middle></A>
</td>
<td>
<INPUT TYPE=text name=q size=31 maxlength=255 value="">
<INPUT type=submit name=sa VALUE="Google Search">
<INPUT type=hidden name=cof VALUE="S:http://www.castlestronghold.com;GL:1;VLC:#373737;AH:center;LH:63;LC:#0A50A1;GFNT:#5B5B5B;L:http://www.castleproject.org/images/castle-logo.gif;ALC:#0A50A1;BIMG:http://www.castleproject.org/images/bg.png;LW:280;T:#5B5B5B;AWFID:3d565acacdd9f388;">
<input type=hidden name=domains value="castleproject.org"><br><input type=radio name=sitesearch value=""> Search WWW <input type=radio name=sitesearch value="castleproject.org" checked> Search castleproject.org
</td></tr></TABLE>
</FORM>
<!-- Search Google -->
</center>
	&nbsp;
	<br/>

		</div> <!-- end of content -->
  </div><!-- end of page -->
  


	<script type="text/javascript">_uacct = "UA-1190612-1";urchinTracker();</script>
	<script type="text/javascript">
		var uservoiceJsHost = ("https:" == document.location.protocol) ? "https://uservoice.com" : "http://cdn.uservoice.com";
		document.write(unescape("%3Cscript src='" + uservoiceJsHost + "/javascripts/widgets/tab.js' type='text/javascript'%3E%3C/script%3E"))
	</script>
	<script type="text/javascript">
		UserVoice.Popin.setup({ 
			key: 'castle',
			alignment: 'right',
			host: 'castle.uservoice.com', 
			forum: 'general', 
			lang: 'en'
		})
	</script>
	</body>
</html>
