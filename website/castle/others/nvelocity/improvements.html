<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">









<html>
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1"/>
		<title>NVelocity Improvements :: Castle Project</title>
		<link rel="stylesheet" href="../../base.css" />
		<link rel="stylesheet" href="../../front.css" />
		<link rel="stylesheet" href="../../elem.css" />
		<link rel="stylesheet" href="../../csharp.css" />
		<link rel="stylesheet" href="../../TAB_styles.css" />
		<script type="text/javascript" src="../../mktree.js"></script>
		<script type="text/javascript" src="../../TAB_Function_Lib.js"></script>
	</head>

	<body>
<div id="topheader">
  <div id="maintitle">
	<h1> <a href="../../index.html" title="Castle Project Home" accesskey="1">Home</a> </h1>
	<h2> <a href="http://www.castlestronghold.com" title="Castle Stronghold: support, consulting and development">Castle Stronghold</a> </h2>
  </div>
  <div id="mainbar">
	<ul id="toplinks">
		<li>&nbsp;</li>
		<li><a style="_width: 70px;" href="../../index.html">Home</a></li>
		<li><a style="_width: 70px;" href="../../castle/download.html">Download</a></li>
		<li><a style="_width: 50px;" href="http://wiki.castleproject.org">Wiki</a></li>
		<li><a style="_width: 60px;" href="../../community/forum.html">Forum</a></li>
		<li><a style="_width: 100px;" href="../../jira.html">Issue Tracker</a></li>
		<li><a style="_width: 80px;" href="../../irc.html">IRC Channel</a></li>
		<li><a style="_width: 80px;" href="http://builds.castleproject.org">Build Server</a></li>
	</ul>
  </div>
</div>



<div id="coolpage">

	<div id="sidebar" >
		
  <div class="lightmenu">
    <div class="lightmenucontent">
<span class="menutitle">
<a href="./../../others/nvelocity/index.html">NVelocity</a>
</span>
  <ul>
<li>
<a href="./../../others/nvelocity/improvements.html">Improvements</a>
</li>
<li>
<a href="./../../others/nvelocity/usingit.html">Using it</a>
</li>
<li>
<a href="./../../others/nvelocity/problems.html">Caveats and Problems</a>
</li>
  </ul>
    </div>
  </div>
  <br/>
  <div class="darkmenu">
    <div class="darkmenucontent">
<span class="menutitle">
Navigation
</span>
  <ul>
<li>
<a href="./../../index.html">Back to Main Page</a>
</li>
  </ul>
    </div>
  </div>
  <br/>
	<br/>
	
	</div>
		
	<div id="content">
	
		<div class="callout-pic">

<!-- Begin Table of contents -->
<div id="toc">
<h2>Table of contents</h2>
<ul>
<li class='toclevel-1'><a href="#params"><span class="tocnumber">1</span> <span class="toctext">ParamArray methods</span></a>
</li>
<li class='toclevel-1'><a href="#dicts"><span class="tocnumber">2</span> <span class="toctext">Built-in support for dictionaries</span></a>
</li>
<li class='toclevel-1'><a href="#fancyloops"><span class="tocnumber">3</span> <span class="toctext">Fancy foreach loops</span></a>
</li>
<li class='toclevel-1'><a href="#enums"><span class="tocnumber">4</span> <span class="toctext">Binary expressions with enum types</span></a>
</li>
<li class='toclevel-1'><span class="tocnumber">5</span> <span class="toctext">Unreleased features</span>
<ul>
	<li class='toclevel-1'><span class="tocnumber">5.1</span> <span class="toctext">Dictionary support improved</span>
</li>
</ul>
</li>
</ul>
</div>
<!-- End Table of contents -->
		</div>

		<h1 class="firstHeading">
		    NVelocity Improvements
		</h1> 
	
<div class="breadcrumbs">
&raquo;
	<a href="./../../index.html">Home</a> 
&raquo;
	<a href="./../../others/index.html">Other projects</a> 
&raquo;
	<a href="./../../others/nvelocity/index.html">NVelocity</a> 
&raquo;
<u>NVelocity Improvements</u>
</div>

		<!-- start content -->
<p>
Here is a list of improvements made to the original NVelocity code. 
If you download the code from our code repository make sure you check the <tt>Changes.txt</tt>
as we log all changes on it.
</p><a name="params"></a>
  <h1>ParamArray methods</h1>
<p>
	Methods that use the <tt>ParamArray</tt> attribute (in C# the <tt>params</tt> keyword 
	defines the attribute) 
	allows the compilers (participants) to define a better syntax for invocation. In fact
	the compiler is in charge of creating the array on the programmers behalf.
	</p><p>
	NVelocity is able to make such invocations also creating the correct array for you. 
	For example:
	</p>    <pre class="csharpcode">

<span class="kwrd">public</span> <span class="kwrd">static</span> <span class="kwrd">string</span> SomeMethod(<span class="kwrd">params</span> String[] args)
{
    <span class="kwrd">return</span> String.Join(<span class="str">'-'</span>, args);
}</pre>
      <pre class="csharpcode">

$instance.SomeMethod('arg1', 'arg2')    </pre>
  <p>Which will output</p>  <pre class="commonpre">
arg1-arg2</pre>
<p>
	The arguments are evaluated normally, so you are free to use references or
	string interpolation as you wish.
	</p><a name="dicts"></a>
  <h1>Built-in support for dictionaries</h1>
<p>
	Dictionaries, if supported natively by a compiler, can make the code 
	more self documented than anything else. Due to the usage
	on MonoRail, dictionary support was introduced to NVelocity.
	</p><p>
	All you have to to is construct a string using a special content. 
	It will be matched using a regular expression and the dictionary will be 
	constructed, populated and passed as a parameter for the method instead
	of the string. For example:
	</p>    <pre class="csharpcode">

$HtmlHelper.LabelFor('elementid', 'Name:', "%{class='required', accessKey='N'}")</pre>
  <p>
	The code above will construct a dictionary and 
	add the entries <tt>class</tt> and <tt>accessKey</tt>.
	</p><a name="fancyloops"></a>
  <h1>Fancy foreach loops</h1>
<p>
	Inspired on <a href="http://www.fogcreek.com/CityDesk/2.0/help/Scripting_With_CityScript/FancyLoops.html" >
	FogCreek's CityDesk language</a>, the following type of <tt>foreach</tt>
	is supported.
	</p>    <pre class="csharpcode">

#foreach($i in $items)
#each (this is optional since its the default section)
       text which appears for each item
#before
       text which appears before each item
#after
       text which appears after each item
#between
       text which appears between each two items
#odd
       text which appears for every other item, including the first
#even
       text which appears for every other item, starting with the second
#nodata
       Content rendered if $items evaluated to null or empty
#beforeall
       text which appears before the loop, only if there are items
       matching condition
#afterall
       text which appears after the loop, only of there are items
       matching condition
#end</pre>
  <p>
	All inner sections are optional, and they can appear in any order 
	multiple times (sections with same name will have their content appended)
	</p><p>
	So for example you can use it to create a table contents with alternating styles: 
	</p>    <pre class="csharpcode">

#foreach($person in $people)
#beforeall
       <span class="kwrd">&lt;</span><span class="html">table</span><span class="kwrd">&gt;</span>
               <span class="kwrd">&lt;</span><span class="html">tr</span><span class="kwrd">&gt;</span>
               <span class="kwrd">&lt;</span><span class="html">th</span><span class="kwrd">&gt;</span>Name<span class="kwrd">&lt;/</span><span class="html">th</span><span class="kwrd">&gt;</span>
               <span class="kwrd">&lt;</span><span class="html">th</span><span class="kwrd">&gt;</span>Age<span class="kwrd">&lt;/</span><span class="html">th</span><span class="kwrd">&gt;</span>
               <span class="kwrd">&lt;/</span><span class="html">tr</span><span class="kwrd">&gt;</span>
#before
       <span class="kwrd">&lt;</span><span class="html">tr</span>
#<span class="attr">odd</span>
       <span class="attr">Style</span><span class="kwrd">='color:gray'</span><span class="kwrd">&gt;</span>
#even
       Style='color:white'<span class="kwrd">&gt;</span>

#each
       <span class="kwrd">&lt;</span><span class="html">td</span><span class="kwrd">&gt;</span>$person.Name<span class="kwrd">&lt;/</span><span class="html">td</span><span class="kwrd">&gt;</span>
       <span class="kwrd">&lt;</span><span class="html">td</span><span class="kwrd">&gt;</span>$person.Age<span class="kwrd">&lt;/</span><span class="html">td</span><span class="kwrd">&gt;</span>

#after
       <span class="kwrd">&lt;/</span><span class="html">tr</span><span class="kwrd">&gt;</span>

#between
       <span class="kwrd">&lt;</span><span class="html">tr</span><span class="kwrd">&gt;&lt;</span><span class="html">td</span> <span class="attr">colspan</span><span class="kwrd">='2'</span><span class="kwrd">&gt;</span>$person.bio<span class="kwrd">&lt;/</span><span class="html">td</span><span class="kwrd">&gt;&lt;/</span><span class="html">tr</span><span class="kwrd">&gt;</span>

#afterall
       <span class="kwrd">&lt;/</span><span class="html">table</span><span class="kwrd">&gt;</span>

#nodata
       Sorry No Person Found
#end
</pre>
  <p>Which will output something like:</p>    <pre class="csharpcode">

<span class="kwrd">&lt;</span><span class="html">table</span><span class="kwrd">&gt;</span>
       <span class="kwrd">&lt;</span><span class="html">tr</span><span class="kwrd">&gt;</span>
       <span class="kwrd">&lt;</span><span class="html">th</span><span class="kwrd">&gt;</span>Name<span class="kwrd">&lt;/</span><span class="html">th</span><span class="kwrd">&gt;</span>
       <span class="kwrd">&lt;</span><span class="html">th</span><span class="kwrd">&gt;</span>Age<span class="kwrd">&lt;/</span><span class="html">th</span><span class="kwrd">&gt;</span>
       <span class="kwrd">&lt;/</span><span class="html">tr</span><span class="kwrd">&gt;</span>
       <span class="kwrd">&lt;</span><span class="html">tr</span> <span class="attr">style</span><span class="kwrd">='color:white'</span><span class="kwrd">&gt;</span>
               <span class="kwrd">&lt;</span><span class="html">td</span><span class="kwrd">&gt;</span>John<span class="kwrd">&lt;/</span><span class="html">td</span><span class="kwrd">&gt;</span>
               <span class="kwrd">&lt;</span><span class="html">td</span><span class="kwrd">&gt;</span>32<span class="kwrd">&lt;/</span><span class="html">td</span><span class="kwrd">&gt;</span>
       <span class="kwrd">&lt;/</span><span class="html">tr</span><span class="kwrd">&gt;</span>
       <span class="kwrd">&lt;</span><span class="html">tr</span><span class="kwrd">&gt;&lt;</span><span class="html">td</span> <span class="attr">colspan</span><span class="kwrd">='2'</span><span class="kwrd">&gt;</span>Monorail programmer<span class="kwrd">&lt;/</span><span class="html">td</span><span class="kwrd">&gt;&lt;/</span><span class="html">tr</span><span class="kwrd">&gt;</span>
       <span class="kwrd">&lt;</span><span class="html">tr</span> <span class="attr">style</span><span class="kwrd">='color:gray'</span><span class="kwrd">&gt;</span>
               <span class="kwrd">&lt;</span><span class="html">td</span><span class="kwrd">&gt;</span>Jin<span class="kwrd">&lt;/</span><span class="html">td</span><span class="kwrd">&gt;</span>
               <span class="kwrd">&lt;</span><span class="html">td</span><span class="kwrd">&gt;</span>12<span class="kwrd">&lt;/</span><span class="html">td</span><span class="kwrd">&gt;</span>
       <span class="kwrd">&lt;/</span><span class="html">tr</span><span class="kwrd">&gt;</span>
       <span class="kwrd">&lt;</span><span class="html">tr</span><span class="kwrd">&gt;&lt;</span><span class="html">td</span> <span class="attr">colspan</span><span class="kwrd">='2'</span><span class="kwrd">&gt;</span>Castle guru<span class="kwrd">&lt;/</span><span class="html">td</span><span class="kwrd">&gt;&lt;/</span><span class="html">tr</span><span class="kwrd">&gt;</span>
<span class="kwrd">&lt;/</span><span class="html">table</span><span class="kwrd">&gt;</span>
</pre>
  <p>If the <tt>$people</tt> variable was null the output would be:</p>    <pre class="csharpcode">

Sorry No Person Found
</pre>
  <a name="enums"></a>
  <h1>Binary expressions with enum types</h1>
<p>
	In the old version of NVelocity, enums could only be
	compared if we put the elements on the template context. 
	That was very odd to say the least. 
	</p><p>
	To solve the problem and at the same time
	make the code readable, binary expressions were changed to compare
	enums with their textual representation. For example:
	</p>    <pre class="csharpcode">

<span class="kwrd">public</span> <span class="kwrd">enum</span> OrderStatus
{
  Undefined,
  Created,
  Dispatched
}</pre>
  <p>You can use it in the following way</p>    <pre class="csharpcode">

#if($order.Status == "Undefined")
  Sorry, but we don't know this order.
#elseif($order.Status == "Created")
  Your order is being processed. Hold on!
#elseif($order.Status == "Dispatched")
  Your order has been dispatched through UPS. Cross your fingers!
#end
</pre>
    <h1>Unreleased features</h1>
<p>
	These should be available on Castle Project 1.0 RC 3.
	</p>  <h2>Dictionary support improved</h2>
<p>
	Now it supports string interpolation anywhere and integers and singles:
	</p><p><table class="commontable" ><tr><th>Usage</th><th>Behavior</th></tr><tr><td><tt></tt></td><td></td></tr><tr><td><tt>key='value'</tt></td><td>value is treated as String</td></tr><tr><td><tt>key=1</tt></td><td>value is converted to int</td></tr><tr><td><tt>key=1.2</tt></td><td>value is converted to single</td></tr><tr><td><tt>key='1'</tt></td><td>value is treated as String</td></tr><tr><td><tt>$key='value'</tt></td><td>$key will be evaluated (cannot be evaluated to null)</td></tr><tr><td><tt>key=$value</tt></td><td>value is evaluated and the object is added (not converted to string)</td></tr><tr><td><tt>key='some$value'</tt></td><td>value is evaluated and concatenated with the literal value</td></tr></table></p>		<!-- end content -->
		
	<div id="footer">
	Found an error? Something inaccurate? 
	<a href="../../community/getinvolved.html">Help us improve the documentation</a> <br/>
	Generated by <a href="../../others/anakia/index.html">Castle Anakia</a>. 
	
	<p>&nbsp;</p>
	
	<p>
	Sponsored by <img src="../../images/logothumb.gif" /> <a href="http://www.castlestronghold.com">Castle Stronghold</a>.
	</p>
	
	</div>

	&nbsp;
	<br/>

		</div> <!-- end of content -->
  </div><!-- end of page -->
  


	</body>
</html>
